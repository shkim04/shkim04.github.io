{"componentChunkName":"component---src-templates-blog-post-js","path":"/en/how-i-used-crontab-to-schedule-jobs-for-my-work/","result":{"data":{"site":{"siteMetadata":{"title":"Seunghyun's Blog"}},"markdownRemark":{"id":"2a966f0e-13c4-52dc-840d-7ffe5a014c53","excerpt":"Linux users who set up and maintain software environment use  to schedule jobs. It is the most suitable for repetitive tasks. Among a few of servers I have…","html":"<p><span\n      class=\"gatsby-resp-image-wrapper\"\n      style=\"position: relative; display: block; margin-left: auto; margin-right: auto; max-width: 630px; \"\n    >\n      <a\n    class=\"gatsby-resp-image-link\"\n    href=\"/static/7d7247e597f450c75a85c382daee063e/d4c13/crontab-edit.png\"\n    style=\"display: block\"\n    target=\"_blank\"\n    rel=\"noopener\"\n  >\n    <span\n    class=\"gatsby-resp-image-background-image\"\n    style=\"padding-bottom: 54.43037974683544%; position: relative; bottom: 0; left: 0; background-image: url('data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABQAAAALCAYAAAB/Ca1DAAAACXBIWXMAAAsTAAALEwEAmpwYAAABlklEQVR42n1R207CQBBdfPASRGiR0lLw1nYvWFDAP1ISE/XBKKKgId71q4+ZWSkq6sPJmcnsnDkzK8anY4yPh7g7GeHhfIK34TNehs94vXrC6/DJ8hSDR7wPHnF/doubo0uM+pe4PrzAqD/gfHIygvBWtuEvhIyq8OGJAN5CCC9Xs6A8F1gWAXzhoiYchKI8h5pwIdTGAdRGD6rRhWr0oOtd6LDDTDUd7MFU2zBeC8a3nBYSpPkIaT6eg0i8FpJKimR9lyFdA1luIik3EVdbkI6GLGnLjoZe3oZZ3GTmeGkLhvgTIqp3ENf2Eftty8GejattFozqXURhh0F1GkQDpmKZcCYYdpBUdrmZnRI865jEya1aTaAKCdRqDFlUHJvFrZnDLy4FNznGruqabPVMuEJ5E6qo2B3DS1n8V4ckaB22v7lj0HokQLd1TDaIV85Hvwvy45Kac8Zuy9YZiamizAR4xT8+RlAj34gaSxpqTTL4DPSzbpMH0u0o5lrJDtErO7MhmSAduSjtDSlek+yMHk8d/Iefgh+tiD2HVnYZeAAAAABJRU5ErkJggg=='); background-size: cover; display: block;\"\n  ></span>\n  <img\n        class=\"gatsby-resp-image-image\"\n        alt=\"crontab-edit\"\n        title=\"\"\n        src=\"/static/7d7247e597f450c75a85c382daee063e/f058b/crontab-edit.png\"\n        srcset=\"/static/7d7247e597f450c75a85c382daee063e/c26ae/crontab-edit.png 158w,\n/static/7d7247e597f450c75a85c382daee063e/6bdcf/crontab-edit.png 315w,\n/static/7d7247e597f450c75a85c382daee063e/f058b/crontab-edit.png 630w,\n/static/7d7247e597f450c75a85c382daee063e/d4c13/crontab-edit.png 825w\"\n        sizes=\"(max-width: 630px) 100vw, 630px\"\n        style=\"width:100%;height:100%;margin:0;vertical-align:middle;position:absolute;top:0;left:0;\"\n        loading=\"lazy\"\n        decoding=\"async\"\n      />\n  </a>\n    </span></p>\n<p>Linux users who set up and maintain software environment use <code class=\"language-text\">cron</code> to schedule jobs. It is the most suitable for repetitive tasks.</p>\n<p>Among a few of servers I have developed and maintained, there is an application server that is run on a virtual machine and it is required to always listen on a port. However, the server is sometimes terminated for some reason. Thanks to <code class=\"language-text\">cron</code>, I did not have to manually restart it when it was off. So, I will share how to fix the problem by using <code class=\"language-text\">cron</code> in this post.</p>\n<h2>Prerequisite</h2>\n<ul>\n<li>Linux environment — <em>I will use Ubuntu here</em></li>\n<li>A bit of knowledge about Linux — <em>simple commands or such</em></li>\n<li>A bit of knowledge about bash script</li>\n</ul>\n<h2>Real World Experience</h2>\n<p>One of my jobs at work is to develop and maintain the pipeline that has been automated to collect lots of data and process them as desired for my company's app service.</p>\n<p>For that task, we have a software product that crawls websites on a daily basis. Since its crawling jobs are a lot and very intense, it is often shut down in the middle of getting requests. So, we did not get enough data to present on our app. We had to find a way to fix this problem to get as much data as we want. </p>\n<p>The solution is <em><strong>sikulix</strong></em> that can detect graphic images on a screen and make us able to do stuff with them such as click. Put it in a nutshell, it will open the crawling software if it is shut down and get it ready to get requests again.</p>\n<p>We ran the sikulix server on a port. For the first few days, it worked as charm. It detected when the crawling software was shutdown and opened it automatically. </p>\n<p>But, the sikulix server itself was shutdown for some reason so, I had to find a way to automatically open the sikulix server if it was shutdown.</p>\n<p><em><strong>Very irritating, right?</strong></em></p>\n<p>Thankfully, we have <code class=\"language-text\">cron</code> and shell script that can solve problems. Now, I will talk about how I used those two utilities for the case.</p>\n<h2>Simple Examples</h2>\n<ol>\n<li><code class=\"language-text\">*/1 * * * * echo \"Hello, World\"</code></li>\n<li><code class=\"language-text\">50 1,2 * * * cd /home/cron_logs &amp; touch cron-`date +\\%F`.log</code></li>\n<li><code class=\"language-text\">0 0 1* * find /home/cron_logs -name \"*.log\" -type f -mtime +30 -delete</code></li>\n</ol>\n<p>Before telling you what I tried, it is probably good to know some basics. Let's look at these simple examples of scheduled jobs with <code class=\"language-text\">cron</code>. As you can see, one line is comprised of two parts. One is for time scheduling and the other is the command that you want to execute on the scheduled time.</p>\n<p>So, what happens here:</p>\n<ol>\n<li><em><strong>\"Hello, World\"</strong></em> will be printed out on logs every 1 minute</li>\n<li>A file named cron_[<em>date when the command is run</em>].log will be created under a folder named <strong>cron_logs</strong> in home directory at 1:50 and 2:50 a.m. everyday</li>\n<li>Files whose names have log in them, which are older than 30 days from now, under a folder named <strong>cron_logs</strong> will be removed at midnight every first day of a month</li>\n</ol>\n<h2>How To Fix</h2>\n<p>The approach I tried for the problem here is to check out if the <em><strong>sikulix</strong></em> server is run a few minutes before it does its job. If not, we would just run it again. Here is what I did to achieve the goal:</p>\n<ol>\n<li>Open the terminal and enter to edit cron job</li>\n</ol>\n<div class=\"gatsby-highlight\" data-language=\"bash\"><pre class=\"language-bash\"><code class=\"language-bash\"><span class=\"token function\">crontab</span> <span class=\"token parameter variable\">-e</span>\n// edit <span class=\"token function\">cron</span> <span class=\"token function\">jobs</span></code></pre></div>\n<ol start=\"2\">\n<li>Write the code in the editor when prompted</li>\n</ol>\n<div class=\"gatsby-highlight\" data-language=\"bash\"><pre class=\"language-bash\"><code class=\"language-bash\"><span class=\"token number\">50</span> <span class=\"token number\">2,5</span>,20,23 * * * /home/sikulix/handle_sikulix.sh <span class=\"token operator\">>></span> ~/cron_logs/cron-<span class=\"token variable\"><span class=\"token variable\">`</span><span class=\"token function\">date</span> +<span class=\"token punctuation\">\\</span>%F<span class=\"token variable\">`</span></span>.log <span class=\"token operator\"><span class=\"token file-descriptor important\">2</span>></span><span class=\"token file-descriptor important\">&amp;1</span></code></pre></div>\n<blockquote>\n<p>Notice that I used the absolute path of the shell script I wanted to execute. Cron does not know where a file is, if only the name of a file presented.</p>\n</blockquote>\n<p>To finish, press ctrl+x.</p>\n<ol start=\"3\">\n<li>Restart cron</li>\n</ol>\n<div class=\"gatsby-highlight\" data-language=\"bash\"><pre class=\"language-bash\"><code class=\"language-bash\"><span class=\"token function\">sudo</span> systemcrl restart <span class=\"token function\">cron</span></code></pre></div>\n<p>To make the cron job work out, we need to restart <code class=\"language-text\">cron</code> on a system level.</p>\n<ol start=\"4\">\n<li>Create handle_sikulix.sh</li>\n</ol>\n<div class=\"gatsby-highlight\" data-language=\"bash\"><pre class=\"language-bash\"><code class=\"language-bash\"><span class=\"token shebang important\">#!/bin/bash</span>\n\n<span class=\"token assign-left variable\">isRun</span><span class=\"token operator\">=</span><span class=\"token string\">\"YES\"</span>\n<span class=\"token variable\"><span class=\"token variable\">$(</span><span class=\"token function\">sudo</span> <span class=\"token function\">netstat</span> <span class=\"token parameter variable\">-tulpn</span> <span class=\"token operator\">|</span> <span class=\"token function\">grep</span> :<span class=\"token punctuation\">[</span>SIKULIX SERVER PORT<span class=\"token punctuation\">]</span> <span class=\"token operator\">></span> /dev/null<span class=\"token variable\">)</span></span> <span class=\"token operator\">||</span> <span class=\"token assign-left variable\">isRun</span><span class=\"token operator\">=</span><span class=\"token string\">\"\"</span>\n\n<span class=\"token keyword\">if</span> <span class=\"token punctuation\">[</span> <span class=\"token string\">\"<span class=\"token variable\">$isRun</span>\"</span> <span class=\"token operator\">=</span> <span class=\"token string\">\"YES\"</span> <span class=\"token punctuation\">]</span><span class=\"token punctuation\">;</span> <span class=\"token keyword\">then</span>\n    <span class=\"token builtin class-name\">echo</span> <span class=\"token string\">\"Autorun server is running\"</span>\n<span class=\"token keyword\">else</span>\n    <span class=\"token builtin class-name\">export</span> <span class=\"token assign-left variable\"><span class=\"token environment constant\">DISPLAY</span></span><span class=\"token operator\">=</span>:10.0\n    <span class=\"token builtin class-name\">cd</span> /home/sikulix\n    ./start_server.sh<span class=\"token punctuation\">;</span><span class=\"token function\">bash</span>\n<span class=\"token keyword\">fi</span></code></pre></div>\n<p>What this shell script does is that after checking out if the port the server is run on is being used or not.</p>\n<p>If used, it will just print out <em>\"<strong>Autorun server is running</strong>\"</em> in a log file under the folder named <strong>cron_logs</strong>. Or if not, it changes the directory of <em><strong>sikulix</strong></em> and runs the shell script named <code class=\"language-text\">start_server.sh</code>, which starts the skulix server.</p>\n<h2>Conclusion</h2>\n<p><em><strong>Cron</strong></em> is actually not difficult to understand. All you need to do is to learn how to schedule time by its rule and write commands you want to execute as you desire. Simply put, <code class=\"language-text\">cron</code> is just about how we can cleverly make a good use of it.</p>\n<p><em><strong>THANKS FOR READING. SEE YOU NEXT TIME!</strong></em></p>\n<p><em>This is originally posted on my <a href=\"https://medium.com/@shkim04/how-i-used-crontab-to-schedule-jobs-on-linux-for-my-work-1cb290847904\">Medium</a>.</em>\n<em>Let's connect!</em></p>","frontmatter":{"title":"How I Used Crontab To Schedule Jobs On Linux For My Work","date":"14 Feb, 2023","description":"","tag":["Linux"]},"fields":{"locale":"en"}},"previous":{"fields":{"slug":"/en/how-to-use-google-error-reporting-nodejs"},"frontmatter":{"title":"How To Use Google Error Reporting On Node.js"}},"next":{"fields":{"slug":"/en/how-to-detect-click-outside-react-component"},"frontmatter":{"title":"How To Detect Click Outside A React Component"}}},"pageContext":{"locale":"en","isDefaultLang":false,"slug":"/en/how-i-used-crontab-to-schedule-jobs-for-my-work","titleByLang":{"ko":"crontab-실무-적용-예시","en":"how-i-used-crontab-to-schedule-jobs-for-my-work"},"dateFormat":"DD MMM, YYYY","id":"2a966f0e-13c4-52dc-840d-7ffe5a014c53","previousPostId":"615b62c7-f876-58f1-b715-586122d27267","nextPostId":"00d7f6ce-312f-5737-b37f-918ff1acbdfc"}},"staticQueryHashes":[],"slicesMap":{}}