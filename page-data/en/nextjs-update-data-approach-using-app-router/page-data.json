{"componentChunkName":"component---src-templates-blog-post-js","path":"/en/nextjs-update-data-approach-using-app-router/","result":{"data":{"site":{"siteMetadata":{"title":"Seunghyun's Blog"}},"markdownRemark":{"id":"6d86c34b-9491-5605-b30a-2582117e26bc","excerpt":"Since we have been able to register a toilet by submitting its price, address and review, it is fair to say that we should be able to update the toilet…","html":"<p>Since we have been able to register a toilet by submitting its price, address and review, it is fair to say that we should be able to update the toilet, especially its reivew when a reviewer wants to update the review. A page where one specific toilet show up with its information is where the update should happen. Let's build the very page!</p>\n<blockquote>\n<p>For those who might read this article without reading the previous articles, I should mention the backend has been developed and interacted with this frontend work. You can find the backend code <a href=\"https://github.com/shkim04/find-your-wc\">here</a></p>\n</blockquote>\n<h2>Toilet page</h2>\n<p>We have used App router to get dynamic routes using names of country, city and street so far. By the same token, adding <code class=\"language-text\">[streetNumber]</code>, a specific toilet data matching the address will show up and it will look like:</p>\n<p><span\n      class=\"gatsby-resp-image-wrapper\"\n      style=\"position: relative; display: block; margin-left: auto; margin-right: auto; max-width: 630px; \"\n    >\n      <a\n    class=\"gatsby-resp-image-link\"\n    href=\"/static/f40c8aa7f209236ee0e87d2d51776927/adc48/get-a-toilet.png\"\n    style=\"display: block\"\n    target=\"_blank\"\n    rel=\"noopener\"\n  >\n    <span\n    class=\"gatsby-resp-image-background-image\"\n    style=\"padding-bottom: 87.9746835443038%; position: relative; bottom: 0; left: 0; background-image: url('data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABQAAAASCAYAAABb0P4QAAAACXBIWXMAABYlAAAWJQFJUiTwAAAB1UlEQVR42qVUiZKbMAz1//9h2oYkXDb4wuawOcLryKG77Uy63U3FaGSMeHp6MjBrPcpS4HotcTr9SJHuH96kmBccRcHTuuYSxvi/OjvfclzLEpUQKLlAXtco6gp5VR9e/enp+XPP8gLsW3ZBKQRE04KLFuu6gmzfd+wUj3Xao2t/7vf7HbeqejBspILrHLrOYd/veMUIlDpk57xAqzWWZU5VXjUCrEQDRvpJrcG5QFHxxPJVwLppwEh4ZQyaVqIoaxjbHQn3N30+CyikBCs4h+46zDHCOQfvPfq+T9F7l/Y+A0o5jVJg1Ld1Hv9rBCi1AeNti857zMuCECLmeXkZUFkLRjS1tciyG06n70nHR8LXAQmHtUrD98P7YT4O6fv6N/+gCuXazoEpYzFME5ZlwTm7ILvcoJSBth2MsWnqwzAihIAY41Ow7SBA0jGa8BhCYtVKBak0+n5MQHQmSdd/Hfhf3bi+B+ucxxQelbdtSy9TRVrvXxCSUvthBCPUMD8+O6UNtLYYhxFTCGniIUbEeU5MY5w/ZEjSsX4cMa8L1mXF+XLD5ZpDSg3Slv4+TatAXRDgum1PAdMQAUwxgo3HQIjzNIXEiJgRffJhnDAM05ssHxkN7SfE43j95XJiOgAAAABJRU5ErkJggg=='); background-size: cover; display: block;\"\n  ></span>\n  <img\n        class=\"gatsby-resp-image-image\"\n        alt=\"get-a-toilet\"\n        title=\"\"\n        src=\"/static/f40c8aa7f209236ee0e87d2d51776927/f058b/get-a-toilet.png\"\n        srcset=\"/static/f40c8aa7f209236ee0e87d2d51776927/c26ae/get-a-toilet.png 158w,\n/static/f40c8aa7f209236ee0e87d2d51776927/6bdcf/get-a-toilet.png 315w,\n/static/f40c8aa7f209236ee0e87d2d51776927/f058b/get-a-toilet.png 630w,\n/static/f40c8aa7f209236ee0e87d2d51776927/40601/get-a-toilet.png 945w,\n/static/f40c8aa7f209236ee0e87d2d51776927/adc48/get-a-toilet.png 979w\"\n        sizes=\"(max-width: 630px) 100vw, 630px\"\n        style=\"width:100%;height:100%;margin:0;vertical-align:middle;position:absolute;top:0;left:0;\"\n        loading=\"lazy\"\n        decoding=\"async\"\n      />\n  </a>\n    </span></p>\n<p>Here is the code:</p>\n<div class=\"gatsby-highlight\" data-language=\"js\"><pre class=\"language-js\"><code class=\"language-js\"><span class=\"token comment\">// ...</span>\n<span class=\"token keyword\">import</span> Review <span class=\"token keyword\">from</span> <span class=\"token string\">'./reviewCard'</span><span class=\"token punctuation\">;</span>\n\n<span class=\"token keyword\">async</span> <span class=\"token keyword\">function</span> <span class=\"token function\">getToilet</span><span class=\"token punctuation\">(</span><span class=\"token parameter\"><span class=\"token literal-property property\">address</span><span class=\"token operator\">:</span> AddressData</span><span class=\"token punctuation\">)</span><span class=\"token operator\">:</span> Promise<span class=\"token operator\">&lt;</span>\n  <span class=\"token operator\">|</span> <span class=\"token punctuation\">{</span>\n      <span class=\"token literal-property property\">toilet</span><span class=\"token operator\">:</span> ToiletData<span class=\"token punctuation\">;</span>\n    <span class=\"token punctuation\">}</span>\n  <span class=\"token operator\">|</span> <span class=\"token keyword\">undefined</span>\n<span class=\"token operator\">></span> <span class=\"token punctuation\">{</span>\n  <span class=\"token keyword\">try</span> <span class=\"token punctuation\">{</span>\n    <span class=\"token keyword\">const</span> <span class=\"token punctuation\">{</span> country<span class=\"token punctuation\">,</span> city<span class=\"token punctuation\">,</span> street<span class=\"token punctuation\">,</span> streetNumber <span class=\"token punctuation\">}</span> <span class=\"token operator\">=</span> address<span class=\"token punctuation\">;</span>\n    <span class=\"token keyword\">const</span> res <span class=\"token operator\">=</span> <span class=\"token keyword\">await</span> <span class=\"token function\">fetch</span><span class=\"token punctuation\">(</span><span class=\"token string\">'http://localhost:4000/graphql'</span><span class=\"token punctuation\">,</span> <span class=\"token punctuation\">{</span>\n      <span class=\"token literal-property property\">method</span><span class=\"token operator\">:</span> <span class=\"token string\">'POST'</span><span class=\"token punctuation\">,</span>\n      <span class=\"token literal-property property\">body</span><span class=\"token operator\">:</span> <span class=\"token constant\">JSON</span><span class=\"token punctuation\">.</span><span class=\"token function\">stringify</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">{</span>\n        <span class=\"token literal-property property\">query</span><span class=\"token operator\">:</span> <span class=\"token template-string\"><span class=\"token template-punctuation string\">`</span><span class=\"token string\">{ toilet(\n          country: \"</span><span class=\"token interpolation\"><span class=\"token interpolation-punctuation punctuation\">${</span>country<span class=\"token interpolation-punctuation punctuation\">}</span></span><span class=\"token string\">\", \n          city: \"</span><span class=\"token interpolation\"><span class=\"token interpolation-punctuation punctuation\">${</span>city<span class=\"token interpolation-punctuation punctuation\">}</span></span><span class=\"token string\">\", \n          street: \"</span><span class=\"token interpolation\"><span class=\"token interpolation-punctuation punctuation\">${</span>street<span class=\"token interpolation-punctuation punctuation\">}</span></span><span class=\"token string\">\", \n          streetNumber: \"</span><span class=\"token interpolation\"><span class=\"token interpolation-punctuation punctuation\">${</span>streetNumber<span class=\"token interpolation-punctuation punctuation\">}</span></span><span class=\"token string\">\"\n        ) {\n          id\n          price\n          isPaid\n          reviews {\n            id\n            contributedBy\n            cleanliness\n            performance\n            description\n            createdAt\n          }\n        }}</span><span class=\"token template-punctuation string\">`</span></span><span class=\"token punctuation\">,</span>\n      <span class=\"token punctuation\">}</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">,</span>\n      <span class=\"token literal-property property\">headers</span><span class=\"token operator\">:</span> <span class=\"token punctuation\">{</span>\n        <span class=\"token string-property property\">'Content-Type'</span><span class=\"token operator\">:</span> <span class=\"token string\">'application/json'</span><span class=\"token punctuation\">,</span>\n      <span class=\"token punctuation\">}</span><span class=\"token punctuation\">,</span>\n      <span class=\"token literal-property property\">next</span><span class=\"token operator\">:</span> <span class=\"token punctuation\">{</span> <span class=\"token literal-property property\">revalidate</span><span class=\"token operator\">:</span> <span class=\"token number\">10</span> <span class=\"token punctuation\">}</span><span class=\"token punctuation\">,</span>\n    <span class=\"token punctuation\">}</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n\n    <span class=\"token keyword\">if</span> <span class=\"token punctuation\">(</span><span class=\"token operator\">!</span>res<span class=\"token punctuation\">.</span>ok<span class=\"token punctuation\">)</span> <span class=\"token punctuation\">{</span>\n      <span class=\"token keyword\">throw</span> <span class=\"token keyword\">new</span> <span class=\"token class-name\">Error</span><span class=\"token punctuation\">(</span><span class=\"token string\">'Failed to fetch toilet data in StreetNumber'</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n    <span class=\"token punctuation\">}</span>\n\n    <span class=\"token keyword\">const</span> dataObj <span class=\"token operator\">=</span> <span class=\"token keyword\">await</span> res<span class=\"token punctuation\">.</span><span class=\"token function\">json</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n    <span class=\"token keyword\">return</span> dataObj<span class=\"token punctuation\">.</span>data<span class=\"token punctuation\">;</span>\n  <span class=\"token punctuation\">}</span> <span class=\"token keyword\">catch</span> <span class=\"token punctuation\">(</span>err<span class=\"token punctuation\">)</span> <span class=\"token punctuation\">{</span>\n    console<span class=\"token punctuation\">.</span><span class=\"token function\">log</span><span class=\"token punctuation\">(</span><span class=\"token string\">'Error getToilet func in StreetNumber'</span><span class=\"token punctuation\">,</span> err<span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n  <span class=\"token punctuation\">}</span>\n<span class=\"token punctuation\">}</span>\n\n<span class=\"token keyword\">export</span> <span class=\"token keyword\">default</span> <span class=\"token keyword\">async</span> <span class=\"token keyword\">function</span> <span class=\"token function\">StreetNumber</span><span class=\"token punctuation\">(</span><span class=\"token parameter\"><span class=\"token punctuation\">{</span>\n  params<span class=\"token punctuation\">,</span>\n<span class=\"token punctuation\">}</span><span class=\"token operator\">:</span> <span class=\"token punctuation\">{</span>\n  <span class=\"token literal-property property\">params</span><span class=\"token operator\">:</span> AddressData<span class=\"token punctuation\">;</span>\n<span class=\"token punctuation\">}</span></span><span class=\"token punctuation\">)</span> <span class=\"token punctuation\">{</span>\n  <span class=\"token keyword\">const</span> result <span class=\"token operator\">=</span> <span class=\"token keyword\">await</span> <span class=\"token function\">getToilet</span><span class=\"token punctuation\">(</span>params<span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n  <span class=\"token keyword\">if</span> <span class=\"token punctuation\">(</span><span class=\"token operator\">!</span>result<span class=\"token punctuation\">)</span> <span class=\"token keyword\">return</span> <span class=\"token operator\">&lt;</span>div<span class=\"token operator\">></span>There is no toilet registered on <span class=\"token keyword\">this</span> address<span class=\"token punctuation\">.</span><span class=\"token operator\">&lt;</span><span class=\"token operator\">/</span>div<span class=\"token operator\">></span><span class=\"token punctuation\">;</span>\n  <span class=\"token keyword\">const</span> toilet <span class=\"token operator\">=</span> result<span class=\"token operator\">!</span><span class=\"token punctuation\">.</span>toilet<span class=\"token punctuation\">;</span>\n  <span class=\"token keyword\">return</span> <span class=\"token punctuation\">(</span>\n    <span class=\"token operator\">&lt;</span>main className<span class=\"token operator\">=</span><span class=\"token string\">'flex min-h-screen flex-col items-center justify-between p-24'</span><span class=\"token operator\">></span>\n      <span class=\"token operator\">&lt;</span>div className<span class=\"token operator\">=</span><span class=\"token string\">'z-10 max-w-5xl flex-col w-full items-center justify-between font-mono text-sm lg:flex'</span><span class=\"token operator\">></span>\n        <span class=\"token punctuation\">{</span><span class=\"token comment\">/* ..more code on the repository written \n        at the bottom of this article.*/</span><span class=\"token punctuation\">}</span>  \n        <span class=\"token operator\">&lt;</span>section className<span class=\"token operator\">=</span><span class=\"token string\">'w-3/5 bg-white dark:bg-gray-900 py-8 lg:py-16 antialiased'</span><span class=\"token operator\">></span>\n          <span class=\"token operator\">&lt;</span>div className<span class=\"token operator\">=</span><span class=\"token string\">'max-w-2xl mx-auto px-4'</span><span class=\"token operator\">></span>\n            <span class=\"token operator\">&lt;</span>div className<span class=\"token operator\">=</span><span class=\"token string\">'flex justify-between items-center mb-6'</span><span class=\"token operator\">></span>\n              <span class=\"token operator\">&lt;</span>h2 className<span class=\"token operator\">=</span><span class=\"token string\">'text-lg lg:text-2xl font-bold text-gray-900 dark:text-white'</span><span class=\"token operator\">></span>\n                Reviews\n              <span class=\"token operator\">&lt;</span><span class=\"token operator\">/</span>h2<span class=\"token operator\">></span>\n            <span class=\"token operator\">&lt;</span><span class=\"token operator\">/</span>div<span class=\"token operator\">></span>\n            <span class=\"token punctuation\">{</span>toilet<span class=\"token punctuation\">.</span>reviews<span class=\"token punctuation\">.</span><span class=\"token function\">map</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">(</span><span class=\"token parameter\"><span class=\"token literal-property property\">review</span><span class=\"token operator\">:</span> ReviewData<span class=\"token punctuation\">,</span> <span class=\"token literal-property property\">index</span><span class=\"token operator\">:</span> number</span><span class=\"token punctuation\">)</span> <span class=\"token operator\">=></span> <span class=\"token punctuation\">{</span>\n              <span class=\"token keyword\">return</span> <span class=\"token operator\">&lt;</span>Review key<span class=\"token operator\">=</span><span class=\"token punctuation\">{</span>index<span class=\"token punctuation\">}</span> review<span class=\"token operator\">=</span><span class=\"token punctuation\">{</span>review<span class=\"token punctuation\">}</span> <span class=\"token operator\">/</span><span class=\"token operator\">></span><span class=\"token punctuation\">;</span>\n            <span class=\"token punctuation\">}</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">}</span>\n          <span class=\"token operator\">&lt;</span><span class=\"token operator\">/</span>div<span class=\"token operator\">></span>\n        <span class=\"token operator\">&lt;</span><span class=\"token operator\">/</span>section<span class=\"token operator\">></span>\n      <span class=\"token operator\">&lt;</span><span class=\"token operator\">/</span>div<span class=\"token operator\">></span>\n    <span class=\"token operator\">&lt;</span><span class=\"token operator\">/</span>main<span class=\"token operator\">></span>\n  <span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n<span class=\"token punctuation\">}</span></code></pre></div>\n<p>As we enter <strong>toilets/Korea/Jeonju/Baekje-daero/32</strong> which has been formed with an address stored in the database, this component will get <code class=\"language-text\">Korea</code>, <code class=\"language-text\">Jeonju</code>, <code class=\"language-text\">Baekje-daero</code>, and <code class=\"language-text\">32</code> as its parameter. And then it will make a request to our backend server so that it will get a toilet data corresponding the address. Finally, the component will show the toilet data which includes its reviews.</p>\n<h2>Review card component</h2>\n<p>The toilet has its reviews and it can be more than just one review. For various reaons, it is a good practice to create a component for the reviews and import it on its parent component to display them so we will do it.</p>\n<p>Here is the code:</p>\n<div class=\"gatsby-highlight\" data-language=\"js\"><pre class=\"language-js\"><code class=\"language-js\"><span class=\"token string\">'use client'</span><span class=\"token punctuation\">;</span>\n<span class=\"token comment\">// more code on the repository written at the bottom of this article.</span>\n\n<span class=\"token keyword\">export</span> <span class=\"token keyword\">default</span> <span class=\"token keyword\">function</span> <span class=\"token function\">ReviewCard</span><span class=\"token punctuation\">(</span><span class=\"token parameter\"><span class=\"token punctuation\">{</span> review <span class=\"token punctuation\">}</span><span class=\"token operator\">:</span> <span class=\"token punctuation\">{</span> <span class=\"token literal-property property\">review</span><span class=\"token operator\">:</span> any <span class=\"token punctuation\">}</span></span><span class=\"token punctuation\">)</span> <span class=\"token punctuation\">{</span>\n  <span class=\"token keyword\">const</span> <span class=\"token punctuation\">[</span>isOpenDropdown<span class=\"token punctuation\">,</span> setIsOpenDropdown<span class=\"token punctuation\">]</span> <span class=\"token operator\">=</span> <span class=\"token function\">useState</span><span class=\"token punctuation\">(</span><span class=\"token boolean\">false</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n  <span class=\"token keyword\">const</span> <span class=\"token punctuation\">[</span>willEdit<span class=\"token punctuation\">,</span> setWillEdit<span class=\"token punctuation\">]</span> <span class=\"token operator\">=</span> <span class=\"token function\">useState</span><span class=\"token punctuation\">(</span><span class=\"token boolean\">false</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n  <span class=\"token keyword\">const</span> <span class=\"token punctuation\">[</span>willRemove<span class=\"token punctuation\">,</span> setWillRemove<span class=\"token punctuation\">]</span> <span class=\"token operator\">=</span> <span class=\"token function\">useState</span><span class=\"token punctuation\">(</span><span class=\"token boolean\">false</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n\n  <span class=\"token function\">useEffect</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span> <span class=\"token operator\">=></span> <span class=\"token punctuation\">{</span>\n    <span class=\"token function\">setWillEdit</span><span class=\"token punctuation\">(</span><span class=\"token boolean\">false</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n    <span class=\"token function\">setWillRemove</span><span class=\"token punctuation\">(</span><span class=\"token boolean\">false</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n  <span class=\"token punctuation\">}</span><span class=\"token punctuation\">,</span> <span class=\"token punctuation\">[</span>review<span class=\"token punctuation\">]</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n\n  <span class=\"token keyword\">function</span> <span class=\"token function\">toggleDropdown</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span> <span class=\"token punctuation\">{</span>\n    <span class=\"token function\">setIsOpenDropdown</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">(</span><span class=\"token parameter\">prev</span><span class=\"token punctuation\">)</span> <span class=\"token operator\">=></span> <span class=\"token operator\">!</span>prev<span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n  <span class=\"token punctuation\">}</span>\n\n  <span class=\"token keyword\">return</span> <span class=\"token punctuation\">(</span>\n    <span class=\"token operator\">&lt;</span>article className<span class=\"token operator\">=</span><span class=\"token string\">'p-6 text-base bg-white rounded-lg dark:bg-gray-900'</span><span class=\"token operator\">></span>\n      <span class=\"token punctuation\">{</span>willEdit <span class=\"token operator\">&amp;&amp;</span> <span class=\"token punctuation\">(</span>\n        <span class=\"token operator\">&lt;</span><span class=\"token operator\">></span>\n          <span class=\"token operator\">&lt;</span>button\n            className<span class=\"token operator\">=</span><span class=\"token string\">'z-20 fixed top-0 right-0 bottom-0 left-0 w-full h-full bg-gray-200'</span>\n            onClick<span class=\"token operator\">=</span><span class=\"token punctuation\">{</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span> <span class=\"token operator\">=></span> <span class=\"token function\">setWillEdit</span><span class=\"token punctuation\">(</span><span class=\"token boolean\">false</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">}</span>\n          <span class=\"token operator\">/</span><span class=\"token operator\">></span>\n          <span class=\"token operator\">&lt;</span>UpdateReview review<span class=\"token operator\">=</span><span class=\"token punctuation\">{</span>review<span class=\"token punctuation\">}</span> <span class=\"token operator\">/</span><span class=\"token operator\">></span>\n        <span class=\"token operator\">&lt;</span><span class=\"token operator\">/</span><span class=\"token operator\">></span>\n      <span class=\"token punctuation\">)</span><span class=\"token punctuation\">}</span>\n      <span class=\"token punctuation\">{</span>willRemove <span class=\"token operator\">&amp;&amp;</span> <span class=\"token punctuation\">(</span>\n        <span class=\"token operator\">&lt;</span><span class=\"token operator\">></span>\n          <span class=\"token operator\">&lt;</span>button\n            className<span class=\"token operator\">=</span><span class=\"token string\">'z-20 fixed top-0 right-0 bottom-0 left-0 w-full h-full bg-gray-200'</span>\n            onClick<span class=\"token operator\">=</span><span class=\"token punctuation\">{</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span> <span class=\"token operator\">=></span> <span class=\"token function\">setWillRemove</span><span class=\"token punctuation\">(</span><span class=\"token boolean\">false</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">}</span>\n          <span class=\"token operator\">/</span><span class=\"token operator\">></span>\n          <span class=\"token operator\">&lt;</span>DeleteReview review<span class=\"token operator\">=</span><span class=\"token punctuation\">{</span>review<span class=\"token punctuation\">}</span> <span class=\"token operator\">/</span><span class=\"token operator\">></span>\n        <span class=\"token operator\">&lt;</span><span class=\"token operator\">/</span><span class=\"token operator\">></span>\n      <span class=\"token punctuation\">)</span><span class=\"token punctuation\">}</span>\n      <span class=\"token operator\">&lt;</span>footer className<span class=\"token operator\">=</span><span class=\"token string\">'flex justify-between items-center mb-2'</span><span class=\"token operator\">></span>\n        <span class=\"token punctuation\">{</span><span class=\"token comment\">/* ..more code on the repository written \n        at the bottom of this article.*/</span><span class=\"token punctuation\">}</span>  \n          <span class=\"token punctuation\">{</span>isOpenDropdown <span class=\"token operator\">&amp;&amp;</span> <span class=\"token punctuation\">(</span>\n            <span class=\"token operator\">&lt;</span><span class=\"token operator\">></span>\n              <span class=\"token operator\">&lt;</span>button\n                className<span class=\"token operator\">=</span><span class=\"token string\">'fixed top-0 right-0 bottom-0 left-0 w-full h-full'</span>\n                onClick<span class=\"token operator\">=</span><span class=\"token punctuation\">{</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span> <span class=\"token operator\">=></span> <span class=\"token function\">setIsOpenDropdown</span><span class=\"token punctuation\">(</span><span class=\"token boolean\">false</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">}</span>\n              <span class=\"token operator\">/</span><span class=\"token operator\">></span>\n              <span class=\"token operator\">&lt;</span>div\n                id<span class=\"token operator\">=</span><span class=\"token string\">'dropdownComment1'</span>\n                className<span class=\"token operator\">=</span><span class=\"token string\">'z-10 w-36 bg-white rounded divide-y divide-gray-100 shadow dark:bg-gray-700 dark:divide-gray-600 absolute right-0 mt-2'</span>\n                data<span class=\"token operator\">-</span>popper<span class=\"token operator\">-</span>placement<span class=\"token operator\">=</span><span class=\"token string\">'bottom'</span>\n              <span class=\"token operator\">></span>\n                <span class=\"token operator\">&lt;</span>ul\n                  className<span class=\"token operator\">=</span><span class=\"token string\">'py-1 text-sm text-gray-700 dark:text-gray-200'</span>\n                  aria<span class=\"token operator\">-</span>labelledby<span class=\"token operator\">=</span><span class=\"token string\">'dropdownMenuIconHorizontalButton'</span>\n                <span class=\"token operator\">></span>\n                  <span class=\"token operator\">&lt;</span>li className<span class=\"token operator\">=</span><span class=\"token string\">'block hover:bg-gray-100 dark:hover:bg-gray-600 dark:hover:text-white'</span><span class=\"token operator\">></span>\n                    <span class=\"token operator\">&lt;</span>button\n                      className<span class=\"token operator\">=</span><span class=\"token string\">'w-full py-2 px-4 text-start'</span>\n                      onClick<span class=\"token operator\">=</span><span class=\"token punctuation\">{</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span> <span class=\"token operator\">=></span> <span class=\"token punctuation\">{</span>\n                        <span class=\"token function\">setWillEdit</span><span class=\"token punctuation\">(</span><span class=\"token boolean\">true</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n                        <span class=\"token function\">setIsOpenDropdown</span><span class=\"token punctuation\">(</span><span class=\"token boolean\">false</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n                      <span class=\"token punctuation\">}</span><span class=\"token punctuation\">}</span>\n                    <span class=\"token operator\">></span>\n                      Edit\n                    <span class=\"token operator\">&lt;</span><span class=\"token operator\">/</span>button<span class=\"token operator\">></span>\n                  <span class=\"token operator\">&lt;</span><span class=\"token operator\">/</span>li<span class=\"token operator\">></span>\n                  <span class=\"token operator\">&lt;</span>li className<span class=\"token operator\">=</span><span class=\"token string\">'block hover:bg-gray-100 dark:hover:bg-gray-600 dark:hover:text-white'</span><span class=\"token operator\">></span>\n                    <span class=\"token operator\">&lt;</span>button\n                      className<span class=\"token operator\">=</span><span class=\"token string\">'w-full py-2 px-4 text-start'</span>\n                      onClick<span class=\"token operator\">=</span><span class=\"token punctuation\">{</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span> <span class=\"token operator\">=></span> <span class=\"token punctuation\">{</span>\n                        <span class=\"token function\">setWillRemove</span><span class=\"token punctuation\">(</span><span class=\"token boolean\">true</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n                        <span class=\"token function\">setIsOpenDropdown</span><span class=\"token punctuation\">(</span><span class=\"token boolean\">false</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n                      <span class=\"token punctuation\">}</span><span class=\"token punctuation\">}</span>\n                    <span class=\"token operator\">></span>\n                      Remove\n                    <span class=\"token operator\">&lt;</span><span class=\"token operator\">/</span>button<span class=\"token operator\">></span>\n                  <span class=\"token operator\">&lt;</span><span class=\"token operator\">/</span>li<span class=\"token operator\">></span>\n                <span class=\"token operator\">&lt;</span><span class=\"token operator\">/</span>ul<span class=\"token operator\">></span>\n              <span class=\"token operator\">&lt;</span><span class=\"token operator\">/</span>div<span class=\"token operator\">></span>\n            <span class=\"token operator\">&lt;</span><span class=\"token operator\">/</span><span class=\"token operator\">></span>\n          <span class=\"token punctuation\">)</span><span class=\"token punctuation\">}</span>\n        <span class=\"token operator\">&lt;</span><span class=\"token operator\">/</span>div<span class=\"token operator\">></span>\n      <span class=\"token operator\">&lt;</span><span class=\"token operator\">/</span>footer<span class=\"token operator\">></span>\n      <span class=\"token operator\">&lt;</span>p className<span class=\"token operator\">=</span><span class=\"token string\">'text-gray-500 dark:text-gray-400'</span><span class=\"token operator\">></span><span class=\"token punctuation\">{</span>review<span class=\"token punctuation\">.</span>description<span class=\"token punctuation\">}</span><span class=\"token operator\">&lt;</span><span class=\"token operator\">/</span>p<span class=\"token operator\">></span>\n    <span class=\"token operator\">&lt;</span><span class=\"token operator\">/</span>article<span class=\"token operator\">></span>\n  <span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n<span class=\"token punctuation\">}</span></code></pre></div>\n<blockquote>\n<p>Notice that there is <code class=\"language-text\">use client;</code> on the top of the code. If you do not put it up there, Nextjs will automatically take the script as a server script which means you cannot use any of client APIs such as <strong>useState</strong>, <strong>useEffect</strong> or <strong>useRef</strong>.</p>\n</blockquote>\n<h2>Update review component</h2>\n<p>To update a review, we will take the same approach as we did to register a toilet in the previous article, which is <strong>Server action</strong>. We will have <code class=\"language-text\">UpdateReview</code> component that will take current review as a prop and then, make a update request to our backend server.</p>\n<p>Here is the code:</p>\n<div class=\"gatsby-highlight\" data-language=\"js\"><pre class=\"language-js\"><code class=\"language-js\"><span class=\"token string\">'use client'</span><span class=\"token punctuation\">;</span>\n\n<span class=\"token keyword\">import</span> <span class=\"token punctuation\">{</span> useRef <span class=\"token punctuation\">}</span> <span class=\"token keyword\">from</span> <span class=\"token string\">'react'</span><span class=\"token punctuation\">;</span>\n<span class=\"token keyword\">import</span> <span class=\"token punctuation\">{</span> experimental_useFormStatus <span class=\"token keyword\">as</span> useFormStatus <span class=\"token punctuation\">}</span> <span class=\"token keyword\">from</span> <span class=\"token string\">'react-dom'</span><span class=\"token punctuation\">;</span>\n\n<span class=\"token keyword\">import</span> <span class=\"token punctuation\">{</span> updateReview <span class=\"token punctuation\">}</span> <span class=\"token keyword\">from</span> <span class=\"token string\">'./action'</span><span class=\"token punctuation\">;</span>\n\n<span class=\"token keyword\">function</span> <span class=\"token function\">UpdateButton</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span> <span class=\"token punctuation\">{</span>\n  <span class=\"token keyword\">const</span> <span class=\"token punctuation\">{</span> pending <span class=\"token punctuation\">}</span> <span class=\"token operator\">=</span> <span class=\"token function\">useFormStatus</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n\n  <span class=\"token keyword\">return</span> <span class=\"token punctuation\">(</span>\n    <span class=\"token operator\">&lt;</span>div className<span class=\"token operator\">=</span><span class=\"token string\">'flex items-center justify-between'</span><span class=\"token operator\">></span>\n      <span class=\"token operator\">&lt;</span>button\n        className<span class=\"token operator\">=</span><span class=\"token string\">'bg-blue-500 hover:bg-blue-700 text-white font-bold py-1 px-2 rounded focus:outline-none focus:shadow-outline'</span>\n        type<span class=\"token operator\">=</span><span class=\"token string\">'submit'</span>\n        aria<span class=\"token operator\">-</span>disabled<span class=\"token operator\">=</span><span class=\"token punctuation\">{</span>pending<span class=\"token punctuation\">}</span>\n      <span class=\"token operator\">></span>\n        Confirm\n      <span class=\"token operator\">&lt;</span><span class=\"token operator\">/</span>button<span class=\"token operator\">></span>\n    <span class=\"token operator\">&lt;</span><span class=\"token operator\">/</span>div<span class=\"token operator\">></span>\n  <span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n<span class=\"token punctuation\">}</span>\n\n<span class=\"token keyword\">export</span> <span class=\"token keyword\">default</span> <span class=\"token keyword\">function</span> <span class=\"token function\">UpdateReview</span><span class=\"token punctuation\">(</span><span class=\"token parameter\"><span class=\"token punctuation\">{</span> review <span class=\"token punctuation\">}</span><span class=\"token operator\">:</span> <span class=\"token punctuation\">{</span> <span class=\"token literal-property property\">review</span><span class=\"token operator\">:</span> any <span class=\"token punctuation\">}</span></span><span class=\"token punctuation\">)</span> <span class=\"token punctuation\">{</span>\n  <span class=\"token keyword\">const</span> passwordRef <span class=\"token operator\">=</span> useRef<span class=\"token operator\">&lt;</span>HTMLInputElement<span class=\"token operator\">></span><span class=\"token punctuation\">(</span><span class=\"token keyword\">null</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n  <span class=\"token keyword\">const</span> cleanlinessRef <span class=\"token operator\">=</span> useRef<span class=\"token operator\">&lt;</span>HTMLInputElement<span class=\"token operator\">></span><span class=\"token punctuation\">(</span><span class=\"token keyword\">null</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n  <span class=\"token keyword\">const</span> performanceRef <span class=\"token operator\">=</span> useRef<span class=\"token operator\">&lt;</span>HTMLInputElement<span class=\"token operator\">></span><span class=\"token punctuation\">(</span><span class=\"token keyword\">null</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n  <span class=\"token keyword\">const</span> descriptionRef <span class=\"token operator\">=</span> useRef<span class=\"token operator\">&lt;</span>HTMLTextAreaElement<span class=\"token operator\">></span><span class=\"token punctuation\">(</span><span class=\"token keyword\">null</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n\n  <span class=\"token keyword\">return</span> <span class=\"token punctuation\">(</span>\n    <span class=\"token operator\">&lt;</span>form\n      className<span class=\"token operator\">=</span><span class=\"token string\">'z-30 w-1/2 h-auto fixed inset-x-1/4 inset-y-1/4 mx-auto bg-white px-4 py-8'</span>\n      action<span class=\"token operator\">=</span><span class=\"token punctuation\">{</span>updateReview<span class=\"token punctuation\">}</span>\n    <span class=\"token operator\">></span>\n      <span class=\"token operator\">&lt;</span>div className<span class=\"token operator\">=</span><span class=\"token string\">'flex justify-between items-center mb-2'</span><span class=\"token operator\">></span>\n      <span class=\"token punctuation\">{</span><span class=\"token comment\">/* ..more code on the repository written \n      at the bottom of this article.*/</span><span class=\"token punctuation\">}</span>  \n      <span class=\"token operator\">&lt;</span>div className<span class=\"token operator\">=</span><span class=\"token string\">'flex items-center my-2'</span><span class=\"token operator\">></span>\n        <span class=\"token operator\">&lt;</span>label className<span class=\"token operator\">=</span><span class=\"token string\">'text-gray-700 text-sm font-bold mb-2 mr-3'</span><span class=\"token operator\">></span>\n          <span class=\"token literal-property property\">Password</span><span class=\"token operator\">:</span><span class=\"token punctuation\">{</span><span class=\"token string\">' '</span><span class=\"token punctuation\">}</span>\n        <span class=\"token operator\">&lt;</span><span class=\"token operator\">/</span>label<span class=\"token operator\">></span>\n        <span class=\"token operator\">&lt;</span>input\n          className<span class=\"token operator\">=</span><span class=\"token string\">'shadow appearance-none border rounded py-2 px-3 text-gray-700 mb-3 leading-tight focus:outline-none focus:shadow-outline'</span>\n          type<span class=\"token operator\">=</span><span class=\"token string\">'password'</span>\n          name<span class=\"token operator\">=</span><span class=\"token string\">'password'</span>\n          ref<span class=\"token operator\">=</span><span class=\"token punctuation\">{</span>passwordRef<span class=\"token punctuation\">}</span>\n          required\n        <span class=\"token operator\">/</span><span class=\"token operator\">></span>\n      <span class=\"token operator\">&lt;</span><span class=\"token operator\">/</span>div<span class=\"token operator\">></span>\n      <span class=\"token operator\">&lt;</span>UpdateButton <span class=\"token operator\">/</span><span class=\"token operator\">></span>\n    <span class=\"token operator\">&lt;</span><span class=\"token operator\">/</span>form<span class=\"token operator\">></span>\n  <span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n<span class=\"token punctuation\">}</span></code></pre></div>\n<p>When a user click <strong>Confirm</strong> button after editing his review, it will trigger an action function <code class=\"language-text\">updateReview</code> that is defined in <code class=\"language-text\">action.ts</code>. That is where the update request is made. The fuction will console log a result depending on its response.</p>\n<p>Here is what the component will render like:</p>\n<p><span\n      class=\"gatsby-resp-image-wrapper\"\n      style=\"position: relative; display: block; margin-left: auto; margin-right: auto; max-width: 630px; \"\n    >\n      <a\n    class=\"gatsby-resp-image-link\"\n    href=\"/static/e946c481cb85fa13dc428b56e5d1a64d/a8417/will-edit.png\"\n    style=\"display: block\"\n    target=\"_blank\"\n    rel=\"noopener\"\n  >\n    <span\n    class=\"gatsby-resp-image-background-image\"\n    style=\"padding-bottom: 51.26582278481012%; position: relative; bottom: 0; left: 0; background-image: url('data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABQAAAAKCAYAAAC0VX7mAAAACXBIWXMAABYlAAAWJQFJUiTwAAABAklEQVR42qVSUU7FIBDslb2SH57DH69gPIFGX1togQUW6Jjd19b3GhOfuskE2B2GWbLd+2lEoAiihBgzKCY9hxDhVwRKmpd6TFm5yrmA1PvBojsNFhLeBwyDgfMBXApqrdiicEEgwmgsjJmQM2NZlr0u3FoqptmfBSVBRPpSTEkv07qneH5dOKUURW0N7QJSk9VODl0/TGBm2Gle2wzqwtgJs3Oady7gllBBcbjZl/Wrlet9O7g6Qri7oLTBnPfCd7jNoZeWLYx1+OgNuNT/C4rD+6eKuwfG43PV9mo7CuJHXAm+mgUvbwtGv/0l/hQqKIPNOaFxQkoJXof296CYIRPzCRNBDp+y6Vq/AAAAAElFTkSuQmCC'); background-size: cover; display: block;\"\n  ></span>\n  <img\n        class=\"gatsby-resp-image-image\"\n        alt=\"will-edit\"\n        title=\"\"\n        src=\"/static/e946c481cb85fa13dc428b56e5d1a64d/f058b/will-edit.png\"\n        srcset=\"/static/e946c481cb85fa13dc428b56e5d1a64d/c26ae/will-edit.png 158w,\n/static/e946c481cb85fa13dc428b56e5d1a64d/6bdcf/will-edit.png 315w,\n/static/e946c481cb85fa13dc428b56e5d1a64d/f058b/will-edit.png 630w,\n/static/e946c481cb85fa13dc428b56e5d1a64d/a8417/will-edit.png 941w\"\n        sizes=\"(max-width: 630px) 100vw, 630px\"\n        style=\"width:100%;height:100%;margin:0;vertical-align:middle;position:absolute;top:0;left:0;\"\n        loading=\"lazy\"\n        decoding=\"async\"\n      />\n  </a>\n    </span></p>\n<p>In our backend server, we have made sure that only authenticated person is allowed to edit his or her review. That is why <code class=\"language-text\">password</code> comes in.</p>\n<h2>Test</h2>\n<p>Before testing the senario, maks sure that we have a toilet that has one or more reviews to be updated on the database. You can simply create a few toilets using the graphql playground of our backend server.</p>\n<h3>Update a review</h3>\n<p><span\n      class=\"gatsby-resp-image-wrapper\"\n      style=\"position: relative; display: block; margin-left: auto; margin-right: auto; max-width: 630px; \"\n    >\n      <a\n    class=\"gatsby-resp-image-link\"\n    href=\"/static/98bf16977bbed679c6d4dda894cd4e99/c6bbc/update-data.png\"\n    style=\"display: block\"\n    target=\"_blank\"\n    rel=\"noopener\"\n  >\n    <span\n    class=\"gatsby-resp-image-background-image\"\n    style=\"padding-bottom: 50.632911392405056%; position: relative; bottom: 0; left: 0; background-image: url('data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABQAAAAKCAYAAAC0VX7mAAAACXBIWXMAABYlAAAWJQFJUiTwAAABEklEQVR42p1SC07DMAzt7eFAuwVcAZAAaYitbZp/4iQP7NKqYwwmnvRkJY6fP3GnjUPOhEwFRBUpE2LKZ+R7kjcF6YJfa4fOhwjGMCj0/Qg+ExFKrVjAAtZ5jOOEflCSnP0NEFKp8oZjO+cDMhG0sXDeI8QkjDEipYSYklj2OeelEharG5ZSUFuD91+CxloMaoJ1DsZYTNpAaSNJ1GTm6thvHX6Dc2EWXNBa27jbet5arojtd66CnJ1nttCHgBCjtLCyngZegrTMbfXDiElbaenldY+396MMexH8S+hE8GEfcLMruN1lPB/nn60NZ+1cLXhQAfdPDXePFSYu0/sfRNDIzxFa5eXMPy71NeR1mj4X+wPG+BAaBA3OjQAAAABJRU5ErkJggg=='); background-size: cover; display: block;\"\n  ></span>\n  <img\n        class=\"gatsby-resp-image-image\"\n        alt=\"update-data\"\n        title=\"\"\n        src=\"/static/98bf16977bbed679c6d4dda894cd4e99/f058b/update-data.png\"\n        srcset=\"/static/98bf16977bbed679c6d4dda894cd4e99/c26ae/update-data.png 158w,\n/static/98bf16977bbed679c6d4dda894cd4e99/6bdcf/update-data.png 315w,\n/static/98bf16977bbed679c6d4dda894cd4e99/f058b/update-data.png 630w,\n/static/98bf16977bbed679c6d4dda894cd4e99/c6bbc/update-data.png 910w\"\n        sizes=\"(max-width: 630px) 100vw, 630px\"\n        style=\"width:100%;height:100%;margin:0;vertical-align:middle;position:absolute;top:0;left:0;\"\n        loading=\"lazy\"\n        decoding=\"async\"\n      />\n  </a>\n    </span></p>\n<h3>Result</h3>\n<p><span\n      class=\"gatsby-resp-image-wrapper\"\n      style=\"position: relative; display: block; margin-left: auto; margin-right: auto; max-width: 630px; \"\n    >\n      <a\n    class=\"gatsby-resp-image-link\"\n    href=\"/static/e4e87678b49209e90fe56baf62ce039d/62de4/update-result.png\"\n    style=\"display: block\"\n    target=\"_blank\"\n    rel=\"noopener\"\n  >\n    <span\n    class=\"gatsby-resp-image-background-image\"\n    style=\"padding-bottom: 23.417721518987342%; position: relative; bottom: 0; left: 0; background-image: url('data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABQAAAAFCAIAAADKYVtkAAAACXBIWXMAAA7DAAAOwwHHb6hkAAAArklEQVR42m2Q3Q6CMAxG9/4vZ6LGSBQR+VkZa7eOYSKwYcQr0JNe9PuSJicV85c4r4hxGzfNgrje7rvD6VFJUBoto2GyjJa589x545zz/fyPEKMoT+d8f1TXm80LLkqdZpBcZHLpa3i1ekKcyMxE0fuNUQhBYA1UyqfWLMGBoqpmaLpGYVF1jXKysQBtmvVZvtyu5MWANCAGMiPShDRo/CxkBtQj0YjLtHpi/v3FG172HqWYJhl6AAAAAElFTkSuQmCC'); background-size: cover; display: block;\"\n  ></span>\n  <img\n        class=\"gatsby-resp-image-image\"\n        alt=\"update-result\"\n        title=\"\"\n        src=\"/static/e4e87678b49209e90fe56baf62ce039d/f058b/update-result.png\"\n        srcset=\"/static/e4e87678b49209e90fe56baf62ce039d/c26ae/update-result.png 158w,\n/static/e4e87678b49209e90fe56baf62ce039d/6bdcf/update-result.png 315w,\n/static/e4e87678b49209e90fe56baf62ce039d/f058b/update-result.png 630w,\n/static/e4e87678b49209e90fe56baf62ce039d/62de4/update-result.png 746w\"\n        sizes=\"(max-width: 630px) 100vw, 630px\"\n        style=\"width:100%;height:100%;margin:0;vertical-align:middle;position:absolute;top:0;left:0;\"\n        loading=\"lazy\"\n        decoding=\"async\"\n      />\n  </a>\n    </span></p>\n<p>In this article, neither I did go into the detail of how I implemented <em>tailwind</em> on the components, nor was its UI properly improved. It is because I just wanted to focus on enabling some core features first. I will make it look better as times goes by.</p>\n<p>You can find the frontend code on <a href=\"https://github.com/shkim04/find-your-wc-frontend\">here</a></p>\n<p><em><strong>THANKS FOR READING. SEE YOU NEXT TIME!</strong></em></p>\n<h3>References</h3>\n<ul>\n<li><a href=\"https://nextjs.org/docs/pages/building-your-application/data-fetching/forms-and-mutations\">https://nextjs.org/docs/pages/building-your-application/data-fetching/forms-and-mutations</a></li>\n</ul>","frontmatter":{"title":"#12 Nextjs update data approach using App router","date":"09 Oct, 2023","description":"","tag":["Project","React"]},"fields":{"locale":"en"}},"previous":{"fields":{"slug":"/en/nextjs-graphql-mutation-query-using-app-router"},"frontmatter":{"title":"#11 Nextjs Graphql mutation query using App router"}},"next":{"fields":{"slug":"/en/add-aggregation-using-prisma-in-nestjs"},"frontmatter":{"title":"#13 Add aggregation using prisma in Nestjs"}}},"pageContext":{"locale":"en","isDefaultLang":false,"slug":"/en/nextjs-update-data-approach-using-app-router","titleByLang":{"ko":"nextjs-app-router-사용시-데이터-수정하기","en":"nextjs-update-data-approach-using-app-router"},"dateFormat":"DD MMM, YYYY","id":"6d86c34b-9491-5605-b30a-2582117e26bc","previousPostId":"0eb72de5-cd51-5e81-a2e0-31151c0eacbf","nextPostId":"73e9a8c0-ee71-56cb-9ca4-21e77ff80559"}},"staticQueryHashes":[],"slicesMap":{}}