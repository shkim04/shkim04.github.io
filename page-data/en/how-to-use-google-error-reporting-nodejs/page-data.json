{"componentChunkName":"component---src-templates-blog-post-js","path":"/en/how-to-use-google-error-reporting-nodejs/","result":{"data":{"site":{"siteMetadata":{"title":"Seunghyun's Blog"}},"markdownRemark":{"id":"a8fe038f-919d-5517-8e6c-2ba6e99b4dd6","excerpt":"For developers, it cannot be mentioned enough that we should catch and alert errors as soon as possible, when an application is in service. There are many tools…","html":"<p>For developers, it cannot be mentioned enough that we should catch and alert errors as soon as possible, when an application is in service. There are many tools that help you accomplish this mission. Among many candidates, i will talk about <strong>Google Error Reporting + Cloud Monitoring</strong> here.</p>\n<h2>Prerequisite</h2>\n<ul>\n<li>Google Cloud Account</li>\n<li>Google Service Account — <em>if you do not know how to create this, check out <a href=\"https://shkim04.github.io/en/how-to-use-google-sheet-on-nodejs/\">this article</a></em></li>\n<li>Node</li>\n<li>Insomnia</li>\n</ul>\n<h2>Enable Google Error Reporting</h2>\n<ul>\n<li>Go to the dashboard of your google cloud project</li>\n<li>Click <strong>APIs and services</strong></li>\n<li>Click <strong>ENABLE APIS AND SERVICE</strong></li>\n<li>Type Error reporting on searching bar and enable it</li>\n</ul>\n<h2>Set Up Node.js — Express</h2>\n<p>In order to focus solely on learning how to set up Google Error Reporting and grasp it, we won’t set up Express API from the scratch. Those who do not have one can download a simple express API boilerplate from <a href=\"https://github.com/shkim04/express_typescript_simple_api\"><strong>my repository</strong></a>. If you are done downloading, open the project so we can begin.</p>\n<h2>Set Up Google Error Reporting For Express</h2>\n<div class=\"gatsby-highlight\" data-language=\"text\"><pre class=\"language-text\"><code class=\"language-text\">npm install --save @google-cloud/error-reporting</code></pre></div>\n<p>We will download the library required as shown above. To activate the error reporting properly, we have to fill the fields in <strong>ErrorReporting</strong> object with corresponding values from the key <code class=\"language-text\">json</code> file you have added after creating <strong>google service account</strong>.</p>\n<p>Add this code as shown below to the main script and fill the values required:</p>\n<div class=\"gatsby-highlight\" data-language=\"js\"><pre class=\"language-js\"><code class=\"language-js\"><span class=\"token keyword\">const</span> <span class=\"token punctuation\">{</span> ErrorReporting <span class=\"token punctuation\">}</span> <span class=\"token operator\">=</span> <span class=\"token function\">require</span><span class=\"token punctuation\">(</span><span class=\"token string\">'@google-cloud/error-reporting'</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n<span class=\"token comment\">// Instantiates a client</span>\n<span class=\"token keyword\">const</span> errorReporting <span class=\"token operator\">=</span> <span class=\"token keyword\">new</span> <span class=\"token class-name\">ErrorReporting</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">{</span>\n                           <span class=\"token literal-property property\">projectId</span><span class=\"token operator\">:</span> <span class=\"token string\">'your-project-id'</span><span class=\"token punctuation\">,</span>\n                           <span class=\"token literal-property property\">keyFilename</span><span class=\"token operator\">:</span> <span class=\"token string\">'key.json name'</span><span class=\"token punctuation\">,</span>\n                           <span class=\"token comment\">// this should look like 'hello.json'</span>\n                           <span class=\"token literal-property property\">credentials</span><span class=\"token operator\">:</span> <span class=\"token function\">require</span><span class=\"token punctuation\">(</span><span class=\"token template-string\"><span class=\"token template-punctuation string\">`</span><span class=\"token string\">/path/to/key.json</span><span class=\"token template-punctuation string\">`</span></span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">,</span>\n                           <span class=\"token literal-property property\">reportMode</span><span class=\"token operator\">:</span> <span class=\"token string\">'always'</span><span class=\"token punctuation\">,</span>\n                           <span class=\"token comment\">// the reason why I set this to 'always' is </span>\n                           <span class=\"token comment\">// because the application is run in development mode</span>\n                           <span class=\"token literal-property property\">logLevel</span><span class=\"token operator\">:</span> <span class=\"token number\">2</span><span class=\"token punctuation\">,</span>\n                           <span class=\"token literal-property property\">serviceContext</span><span class=\"token operator\">:</span> <span class=\"token punctuation\">{</span>\n                              <span class=\"token literal-property property\">service</span><span class=\"token operator\">:</span> <span class=\"token string\">\"Name your app\"</span><span class=\"token punctuation\">,</span>\n                              <span class=\"token comment\">// ex) Test_APP</span>\n                              <span class=\"token literal-property property\">version</span><span class=\"token operator\">:</span> <span class=\"token string\">\"specify your version\"</span><span class=\"token punctuation\">,</span>\n                              <span class=\"token comment\">// ex) 0.0.1</span>\n                           <span class=\"token punctuation\">}</span>\n                           <span class=\"token comment\">// serviceContext field should be filled</span>\n                      <span class=\"token punctuation\">}</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></code></pre></div>\n<h2>Add Test Route</h2>\n<div class=\"gatsby-highlight\" data-language=\"js\"><pre class=\"language-js\"><code class=\"language-js\">app<span class=\"token punctuation\">.</span><span class=\"token function\">get</span><span class=\"token punctuation\">(</span><span class=\"token string\">\"/error\"</span><span class=\"token punctuation\">,</span> <span class=\"token keyword\">async</span> <span class=\"token punctuation\">(</span>req<span class=\"token operator\">:</span> Request<span class=\"token punctuation\">,</span> <span class=\"token literal-property property\">res</span><span class=\"token operator\">:</span> Response<span class=\"token punctuation\">,</span> <span class=\"token literal-property property\">next</span><span class=\"token operator\">:</span> NextFunction<span class=\"token punctuation\">)</span><span class=\"token operator\">:</span> Promise<span class=\"token operator\">&lt;</span><span class=\"token keyword\">void</span><span class=\"token operator\">></span> <span class=\"token operator\">=></span> <span class=\"token punctuation\">{</span>\n   <span class=\"token keyword\">try</span> <span class=\"token punctuation\">{</span>\n      <span class=\"token keyword\">throw</span> <span class=\"token keyword\">new</span> <span class=\"token class-name\">Error</span><span class=\"token punctuation\">(</span><span class=\"token string\">\"this is an intended error in '/error' route\"</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n   <span class=\"token punctuation\">}</span>\n   <span class=\"token keyword\">catch</span><span class=\"token punctuation\">(</span>err<span class=\"token punctuation\">)</span> <span class=\"token punctuation\">{</span>\n      <span class=\"token function\">next</span><span class=\"token punctuation\">(</span><span class=\"token template-string\"><span class=\"token template-punctuation string\">`</span><span class=\"token string\">&lt;GET '/error route error>: </span><span class=\"token interpolation\"><span class=\"token interpolation-punctuation punctuation\">${</span>err<span class=\"token interpolation-punctuation punctuation\">}</span></span><span class=\"token template-punctuation string\">`</span></span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n   <span class=\"token punctuation\">}</span>\n<span class=\"token punctuation\">}</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></code></pre></div>\n<p>We will create <code class=\"language-text\">/error</code> route. What happens in the route is that we deliberately throw an error when any request is made to the route so it can catch the error in the catch block for testing. Notice there is <strong>next</strong> object in the catch block, which means it works as a <em><strong>middleware</strong></em>.</p>\n<p>Simply put, it passes the string that contains what the error is about onto a function defined after the middleware. The code below does take in the error string from the middleware and does its job:</p>\n<div class=\"gatsby-highlight\" data-language=\"js\"><pre class=\"language-js\"><code class=\"language-js\">app<span class=\"token punctuation\">.</span><span class=\"token function\">use</span><span class=\"token punctuation\">(</span>errorReporting<span class=\"token punctuation\">.</span>express<span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></code></pre></div>\n<p>Make sure you write this line after the test route or it won’t work.</p>\n<h2>Create Notification Channel in Cloud Monitoring</h2>\n<p>We expect that if any error occurs in Express application, it will report the error to <strong>Google Error Reporting</strong> Console. But, it does not tell us whether there was an error. It is so crucial to be alerted in this situation. Fortunately, google cloud has its own monitoring service. Here is the instruction for creating email notification channel:</p>\n<ul>\n<li>Go to Could Monitoring Dashboard</li>\n<li>Click <strong>Alerting</strong> and then click <strong>Edit notification channels</strong></li>\n<li>In the <strong>Email</strong> section, click <strong>Add new</strong></li>\n<li>Complete the dialog and click <strong>Save</strong></li>\n</ul>\n<p>We will add the notification channel to <strong>google error reporting</strong>. As soon as any error occurs, not only will errors be reported on google error reporting, but also will it be sent to the email you have registered. Here is the instruction to register the notification channel on <strong>google error reporting</strong>:</p>\n<p><span\n      class=\"gatsby-resp-image-wrapper\"\n      style=\"position: relative; display: block; margin-left: auto; margin-right: auto; max-width: 270px; \"\n    >\n      <a\n    class=\"gatsby-resp-image-link\"\n    href=\"/static/90d52a35cc67e8e427099c55cc0244b7/01bf6/error-reporting.png\"\n    style=\"display: block\"\n    target=\"_blank\"\n    rel=\"noopener\"\n  >\n    <span\n    class=\"gatsby-resp-image-background-image\"\n    style=\"padding-bottom: 58.22784810126582%; position: relative; bottom: 0; left: 0; background-image: url('data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABQAAAAMCAYAAABiDJ37AAAACXBIWXMAAAsTAAALEwEAmpwYAAABOElEQVR42pVS226CQBDl/z+jD/0IXqzxgcQGSAspNiEkyLrVlCWKirCAp5k1UEHEdpLN7pyZncuZ0QDgfD63p9Hruu7cDX4t/T90tCGnIbmH921aA9i2jSiKFBgEARhj4JzD932cTqeHFWZZhrIsLwGpLcdxIIRQRs/zYFmWwkzTRJIknYD9NknSNIWU8u8tj9kHW6bqiqJQYJ7n6n08HlW7pFP2sQqrqroMhRRynkxeWg5nsxmm0ykMw1BvXdcxn8/Vp3sBiRZKrP1mKFsjkUuVkUpORDgFq+vbNblZm0Y5HHKUkioY5/DetDsc7vc5np9eYVtLBbpOCO9jBRYJfC44XJdh4XHYVoiIxY8rlLLC+xvDer1Txvh7i81mi3SXgX8lCJcCsdiDMYEVFzf8Xcu/16YzlAHbD17ap298LnAEAAAAAElFTkSuQmCC'); background-size: cover; display: block;\"\n  ></span>\n  <img\n        class=\"gatsby-resp-image-image\"\n        alt=\"error-reporting\"\n        title=\"\"\n        src=\"/static/90d52a35cc67e8e427099c55cc0244b7/01bf6/error-reporting.png\"\n        srcset=\"/static/90d52a35cc67e8e427099c55cc0244b7/c26ae/error-reporting.png 158w,\n/static/90d52a35cc67e8e427099c55cc0244b7/01bf6/error-reporting.png 270w\"\n        sizes=\"(max-width: 270px) 100vw, 270px\"\n        style=\"width:100%;height:100%;margin:0;vertical-align:middle;position:absolute;top:0;left:0;\"\n        loading=\"lazy\"\n        decoding=\"async\"\n      />\n  </a>\n    </span></p>\n<ul>\n<li>Go to Error Reporting</li>\n<li>Click Configure Notification Channels</li>\n<li>Choose the notification you have created</li>\n<li>Click Save</li>\n</ul>\n<h2>Test Request</h2>\n<p>After running the application in development mode, open Insominia so that we will make a request to the test route. Feel free to send a request that looks like:</p>\n<p><span\n      class=\"gatsby-resp-image-wrapper\"\n      style=\"position: relative; display: block; margin-left: auto; margin-right: auto; max-width: 630px; \"\n    >\n      <a\n    class=\"gatsby-resp-image-link\"\n    href=\"/static/b89f6da848796785028c382c278255ee/c5bb3/insomnia-request.png\"\n    style=\"display: block\"\n    target=\"_blank\"\n    rel=\"noopener\"\n  >\n    <span\n    class=\"gatsby-resp-image-background-image\"\n    style=\"padding-bottom: 15.18987341772152%; position: relative; bottom: 0; left: 0; background-image: url('data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABQAAAADCAYAAACTWi8uAAAACXBIWXMAAAsTAAALEwEAmpwYAAAAsUlEQVR42k3NywqCUBSFYR9FCJTSo0dNHTSIILpMpHlNggbNvELgK9TT9HSmwh/nVNCGD9Zmw16GlCFJkmhpmmqu6yKEQLge9nTCZnHkdnpyWF45rpect3suux2reI4jPHzfx7ZtLMvCUA+iKCIIAqSUhGGo9ziOdVbUbTZzyLKMtm3J85y6rimKgrIstaqqaJoGw/M+DYp6+Mv/VIFpmjwed9R0Xcer7+m/hmHQxnHkDTy6etHgQr30AAAAAElFTkSuQmCC'); background-size: cover; display: block;\"\n  ></span>\n  <img\n        class=\"gatsby-resp-image-image\"\n        alt=\"insomnia-request\"\n        title=\"\"\n        src=\"/static/b89f6da848796785028c382c278255ee/f058b/insomnia-request.png\"\n        srcset=\"/static/b89f6da848796785028c382c278255ee/c26ae/insomnia-request.png 158w,\n/static/b89f6da848796785028c382c278255ee/6bdcf/insomnia-request.png 315w,\n/static/b89f6da848796785028c382c278255ee/f058b/insomnia-request.png 630w,\n/static/b89f6da848796785028c382c278255ee/c5bb3/insomnia-request.png 680w\"\n        sizes=\"(max-width: 630px) 100vw, 630px\"\n        style=\"width:100%;height:100%;margin:0;vertical-align:middle;position:absolute;top:0;left:0;\"\n        loading=\"lazy\"\n        decoding=\"async\"\n      />\n  </a>\n    </span></p>\n<p>As we desire, it will send a response containing the error string we have created in the previous section. Now, it is time to check whether this error is reported on google cloud console.</p>\n<p>There will be an error newly reported on <strong>google error reporting</strong> console and you will see the content of the error and the app that the error came from. Plus, since we did add the notification channel via <strong>cloud monitoring</strong> — <em>we did add an email here</em> — to <strong>google error reporting</strong>, you will get the notification email that looks like:</p>\n<p><span\n      class=\"gatsby-resp-image-wrapper\"\n      style=\"position: relative; display: block; margin-left: auto; margin-right: auto; max-width: 630px; \"\n    >\n      <a\n    class=\"gatsby-resp-image-link\"\n    href=\"/static/d44876630d1f503b00705569ffd06c92/a6d36/alert-mail.png\"\n    style=\"display: block\"\n    target=\"_blank\"\n    rel=\"noopener\"\n  >\n    <span\n    class=\"gatsby-resp-image-background-image\"\n    style=\"padding-bottom: 18.354430379746837%; position: relative; bottom: 0; left: 0; background-image: url('data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABQAAAAECAYAAACOXx+WAAAACXBIWXMAAAsTAAALEwEAmpwYAAAAsElEQVR42m2O2w7CIBBE+/+fpo/6VHujQEsTaaWFVnsbs5toNEpywnKYMETbtkNrBSklqqqCMTUjZYmiyNmXZYmmMRCi4FkpxQghYIxB21o456C1RgQA4zjCe48QPKZp4nPf9+i6Ds7dOEx+GAbO0R1hreWd8vM8I4SA6HhwuNoacXzh9izLkOcZz9ROv06SBGmavt3rwX8rOp8c7g/P7eu6ctOyLF+Q+/SUI/Z9/+EJjTkwavcN4u4AAAAASUVORK5CYII='); background-size: cover; display: block;\"\n  ></span>\n  <img\n        class=\"gatsby-resp-image-image\"\n        alt=\"alert-mail\"\n        title=\"\"\n        src=\"/static/d44876630d1f503b00705569ffd06c92/f058b/alert-mail.png\"\n        srcset=\"/static/d44876630d1f503b00705569ffd06c92/c26ae/alert-mail.png 158w,\n/static/d44876630d1f503b00705569ffd06c92/6bdcf/alert-mail.png 315w,\n/static/d44876630d1f503b00705569ffd06c92/f058b/alert-mail.png 630w,\n/static/d44876630d1f503b00705569ffd06c92/a6d36/alert-mail.png 650w\"\n        sizes=\"(max-width: 630px) 100vw, 630px\"\n        style=\"width:100%;height:100%;margin:0;vertical-align:middle;position:absolute;top:0;left:0;\"\n        loading=\"lazy\"\n        decoding=\"async\"\n      />\n  </a>\n    </span></p>\n<p>That’s for it about how to use google error reporting on Node.js.</p>\n<p><em><strong>THANKS FOR READING. SEE YOU NEXT TIME!</strong></em></p>\n<p><em>This is originally posted on my <a href=\"https://medium.com/@shkim04/how-to-use-google-error-reporting-on-node-js-45b0a6b3054c\">Medium</a>.</em>\n<em>Let's connect!</em></p>","frontmatter":{"title":"How To Use Google Error Reporting On Node.js","date":"07 Feb, 2023","description":"","tag":["Cloud","NodeJS"]},"fields":{"locale":"en"}},"previous":{"fields":{"slug":"/en/how-to-use-aws-sqs-nodejs"},"frontmatter":{"title":"How To Use AWS SQS On Node.js"}},"next":{"fields":{"slug":"/en/how-i-used-crontab-to-schedule-jobs-for-my-work"},"frontmatter":{"title":"How I Used Crontab To Schedule Jobs On Linux For My Work"}}},"pageContext":{"locale":"en","isDefaultLang":false,"slug":"/en/how-to-use-google-error-reporting-nodejs","titleByLang":{"ko":"nodejs-google-error-reporting-사용하기","en":"how-to-use-google-error-reporting-nodejs"},"dateFormat":"DD MMM, YYYY","id":"a8fe038f-919d-5517-8e6c-2ba6e99b4dd6","previousPostId":"6719ac9b-a265-5708-9b8c-5d0de3a784ba","nextPostId":"0b5f3b2e-dfce-516d-9b2b-248d3a6faa1a"}},"staticQueryHashes":[],"slicesMap":{}}