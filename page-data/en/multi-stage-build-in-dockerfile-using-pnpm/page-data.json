{"componentChunkName":"component---src-templates-blog-post-js","path":"/en/multi-stage-build-in-dockerfile-using-pnpm/","result":{"data":{"site":{"siteMetadata":{"title":"Seunghyun's Blog"}},"markdownRemark":{"id":"c7e4ec0d-8096-517e-ac56-5dd7ff679876","excerpt":"I chose to use npm as the package manager in the beginning as usual. But, I have changed it into pnpm and migrated it to this project since I was curious what…","html":"<p>I chose to use <strong>npm</strong> as the package manager in the beginning as usual. But, I have changed it into <strong>pnpm</strong> and migrated it to this project since I was curious what it is like - <em>I am not sure but I think it might impose a potential danger on the application. I should look more into this topic later.</em></p>\n<p>I had to change <strong>Docker</strong> script for it was written for <strong>npm</strong>. Let me break down the Dockerfile that I have implemented.</p>\n<blockquote>\n<p>For those who might read this article without reading the previous articles, You can find the whole backend code <a href=\"https://github.com/shkim04/find-your-wc\">here</a></p>\n</blockquote>\n<h2>Development stage</h2>\n<p><span\n      class=\"gatsby-resp-image-wrapper\"\n      style=\"position: relative; display: block; margin-left: auto; margin-right: auto; max-width: 630px; \"\n    >\n      <a\n    class=\"gatsby-resp-image-link\"\n    href=\"/static/0a4c667333bada5394731421fa2357fd/c1c45/development-stage.png\"\n    style=\"display: block\"\n    target=\"_blank\"\n    rel=\"noopener\"\n  >\n    <span\n    class=\"gatsby-resp-image-background-image\"\n    style=\"padding-bottom: 61.39240506329114%; position: relative; bottom: 0; left: 0; background-image: url('data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABQAAAAMCAYAAABiDJ37AAAACXBIWXMAABYlAAAWJQFJUiTwAAABhUlEQVR42pWS25LiIBRF/Q8N4U6AQCSJjrZW25enmf//nz3FwenybfRh1c5DWHX2gY2fDGKxiLNDqLk4DKOGtgJmkOCSo2c9+v45NmE2GFeLcbGU+ThgSFUo70KBvucPh+7f/CH/UYVOW2hroIKDMRayCrQEUwKM9+i2W3S7HcG6rsFq7sAYQ7fbout2BAlP6YT5/I54vaAcr1gvn8i3G9bff1A+vhDLEePyC2G/wAwRflpgQ80Zxkekwxt8nhHKEUJIbKy2sMpCCgUzBDoY8gznx0ZMxBATlLEQUoFLCaE0fStqpSG1aRPOcUHxBT5kDKk0cqEKtV7LO7UqY+gZe8juBxJ64yE4h4kJPk3wubQK+wPifCB5KCvcmMGF/P8tJ5cRaQcHqquMAReC6gilSEI1n5CRsO5PGwdtB0JICc75z43Sj7Xes+/wlM/IecV0vmG5fqO83VAun5hO71D3Rb/CxmmHIWR6AnVCpS1NaX1swhemI2F2CTHuafmtYhO0B8xenvAv8y9VZPE2IJ0AAAAASUVORK5CYII='); background-size: cover; display: block;\"\n  ></span>\n  <img\n        class=\"gatsby-resp-image-image\"\n        alt=\"development-stage\"\n        title=\"\"\n        src=\"/static/0a4c667333bada5394731421fa2357fd/f058b/development-stage.png\"\n        srcset=\"/static/0a4c667333bada5394731421fa2357fd/c26ae/development-stage.png 158w,\n/static/0a4c667333bada5394731421fa2357fd/6bdcf/development-stage.png 315w,\n/static/0a4c667333bada5394731421fa2357fd/f058b/development-stage.png 630w,\n/static/0a4c667333bada5394731421fa2357fd/c1c45/development-stage.png 824w\"\n        sizes=\"(max-width: 630px) 100vw, 630px\"\n        style=\"width:100%;height:100%;margin:0;vertical-align:middle;position:absolute;top:0;left:0;\"\n        loading=\"lazy\"\n        decoding=\"async\"\n      />\n  </a>\n    </span></p>\n<p>Installing <code class=\"language-text\">pnpm</code> is added to the script by writing <code class=\"language-text\">RUN curl -f https://get.pnpm.io/v6.16.js | node - add --global pnpm</code>.</p>\n<p>Notice that instead of <strong>install</strong>, <strong>fetch</strong> is used for loading packages and it only requires <code class=\"language-text\">pnpm-lock.yaml</code> file - <em>I reason that <code class=\"language-text\">pnpm fetch</code> is equivalent to <code class=\"language-text\">npm ci</code> when you use <code class=\"language-text\">npm</code> for the build.</em></p>\n<p>According to the official document of <strong>pnpm</strong>, <code class=\"language-text\">pnpm fetch</code> and <code class=\"language-text\">pnpm install --offline</code> will save so much time.</p>\n<h2>Build stage</h2>\n<p><span\n      class=\"gatsby-resp-image-wrapper\"\n      style=\"position: relative; display: block; margin-left: auto; margin-right: auto; max-width: 630px; \"\n    >\n      <a\n    class=\"gatsby-resp-image-link\"\n    href=\"/static/7896d69dd312f8bc509f328c9a19b74a/fbf08/build-stage.png\"\n    style=\"display: block\"\n    target=\"_blank\"\n    rel=\"noopener\"\n  >\n    <span\n    class=\"gatsby-resp-image-background-image\"\n    style=\"padding-bottom: 63.92405063291139%; position: relative; bottom: 0; left: 0; background-image: url('data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABQAAAANCAYAAACpUE5eAAAACXBIWXMAABYlAAAWJQFJUiTwAAABnklEQVR42p1T7Y6bMBDkQQLGxN822AECXK7JNY2aqmrV93+bqVi43OVOqpT+GK0/0HhndshMI2GTgo0SLikoL1CWJRhj/4UsDBpxNGgGjfTsEDqFSnAwVhLxjXyun9aveEdopIGwGtJ5bKsKXAnkRY58s0GeL7Uoig/IUeQriuKesAs93DDBt3v0hzPi8Sva4xlpOqHZH5CeTrD1DjpEgnI1TJ0QuhG26SC0pQduhMkmeOUhjKcPbZ3AeUUoOX+H+z2vtuBV9cnvzAgDKTWUC5DWUQdCGVRy9lJBaEMEBWOLvFfJa2XrGWNLzQ7xCT4NmK5/MJyv2F9+of1yQXf6jvHbT/QvP1B3E6QNpMDv9nC7Hr4dENqRJLvUI3QTXOyQJROhbEAcj2j6EfX+Gdo3JGkr1Wr6PFV2m/oCTmB3+xKZVY4IyHBfw8YWZl5bv/rzWCazQ3vEcPmN/uW6TC52JI0IOX882Ea5t65cgAkJW6WR55u3ID/0p5hZZk9Zm0mF0pTJuUPb7Cga7EN4/02oAmxIqISg5NPFLR7Fwx3+BabcdC8NR6xRAAAAAElFTkSuQmCC'); background-size: cover; display: block;\"\n  ></span>\n  <img\n        class=\"gatsby-resp-image-image\"\n        alt=\"build-stage\"\n        title=\"\"\n        src=\"/static/7896d69dd312f8bc509f328c9a19b74a/f058b/build-stage.png\"\n        srcset=\"/static/7896d69dd312f8bc509f328c9a19b74a/c26ae/build-stage.png 158w,\n/static/7896d69dd312f8bc509f328c9a19b74a/6bdcf/build-stage.png 315w,\n/static/7896d69dd312f8bc509f328c9a19b74a/f058b/build-stage.png 630w,\n/static/7896d69dd312f8bc509f328c9a19b74a/40601/build-stage.png 945w,\n/static/7896d69dd312f8bc509f328c9a19b74a/fbf08/build-stage.png 962w\"\n        sizes=\"(max-width: 630px) 100vw, 630px\"\n        style=\"width:100%;height:100%;margin:0;vertical-align:middle;position:absolute;top:0;left:0;\"\n        loading=\"lazy\"\n        decoding=\"async\"\n      />\n  </a>\n    </span></p>\n<p>We can now copy <code class=\"language-text\">node_modules</code> folder created from the development stage. I have also copied <strong>.env</strong> file since it has some information when running the application.</p>\n<p>If you use <strong>Prisma</strong>, this stage is where you write to migrate it to make sure it will work. Finally by using <code class=\"language-text\">--prod</code> flag for installing packages after the build, Only production packages will be installed.</p>\n<h2>Production stage</h2>\n<p><span\n      class=\"gatsby-resp-image-wrapper\"\n      style=\"position: relative; display: block; margin-left: auto; margin-right: auto; max-width: 630px; \"\n    >\n      <a\n    class=\"gatsby-resp-image-link\"\n    href=\"/static/e9556e83e36c69f590156c7e5046ceae/e4374/production-stage.png\"\n    style=\"display: block\"\n    target=\"_blank\"\n    rel=\"noopener\"\n  >\n    <span\n    class=\"gatsby-resp-image-background-image\"\n    style=\"padding-bottom: 34.177215189873415%; position: relative; bottom: 0; left: 0; background-image: url('data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABQAAAAHCAYAAAAIy204AAAACXBIWXMAABYlAAAWJQFJUiTwAAABFklEQVR42p3RyY6cMBCAYR6ksXF5K2PA0Et6ehapNe//Tv9oIIkU5ZQcPqkutXc6R8Yt7XRJ5Bqw1v63rl4S60Np98y4BVIVjDWY/mDNPxbMIRE04zURy0hURZzgYsClwCAOa8zBHow5WPMr7n8ydHOaKeuKbmdqu1LXGzmPpHUhn1dEM4NzOPE4EZz3SIi7QQTxER8zPmWcE7qmjRgL9fLKfHtQb6/ocibXxvbyZPnxRj3fqJcX2v2D7f2T+fpge3uicyOWiXG9MrYrPia6KVdSirS2Mk4zy9KY6oSqMk4TIZe9e0hK1EoqE+IDPuk+telPmL4/fK9cYib6AQ2CHyzFO0oQshe8O/2R0J9OO/v7buavp3wB85HID8nMkMoAAAAASUVORK5CYII='); background-size: cover; display: block;\"\n  ></span>\n  <img\n        class=\"gatsby-resp-image-image\"\n        alt=\"production-stage\"\n        title=\"\"\n        src=\"/static/e9556e83e36c69f590156c7e5046ceae/f058b/production-stage.png\"\n        srcset=\"/static/e9556e83e36c69f590156c7e5046ceae/c26ae/production-stage.png 158w,\n/static/e9556e83e36c69f590156c7e5046ceae/6bdcf/production-stage.png 315w,\n/static/e9556e83e36c69f590156c7e5046ceae/f058b/production-stage.png 630w,\n/static/e9556e83e36c69f590156c7e5046ceae/e4374/production-stage.png 927w\"\n        sizes=\"(max-width: 630px) 100vw, 630px\"\n        style=\"width:100%;height:100%;margin:0;vertical-align:middle;position:absolute;top:0;left:0;\"\n        loading=\"lazy\"\n        decoding=\"async\"\n      />\n  </a>\n    </span></p>\n<p>In the production stage, we will simply copy <code class=\"language-text\">node_modules</code> and <code class=\"language-text\">dist</code> folders created from the build stage and then run the application.</p>\n<p>Once you enter the command <code class=\"language-text\">docker build -t [image-name-you-want-give] -f Dockerfile .</code> to build an image, the image will be created and you can see how fast it is created and how light it is - <em>You can build an image without implementing multi-stage build to compare.</em></p>\n<p><em><strong>THANKS FOR READING. SEE YOU NEXT TIME!</strong></em></p>\n<h3>References</h3>\n<ul>\n<li><a href=\"https://pnpm.io/cli/fetch\">https://pnpm.io/cli/fetch</a></li>\n</ul>","frontmatter":{"title":"#15 Multi-stage build in Dockerfile using pnpm","date":"03 Nov, 2023","description":"","tag":["Project"]},"fields":{"locale":"en"}},"previous":{"fields":{"slug":"/en/display-aggregated-data-in-nextjs"},"frontmatter":{"title":"#14 Display aggregated data in Nextjs application"}},"next":null},"pageContext":{"locale":"en","isDefaultLang":false,"slug":"/en/multi-stage-build-in-dockerfile-using-pnpm","titleByLang":{"ko":"pnpm으로-dockerfile에서-multi-stage-빌드하기","en":"multi-stage-build-in-dockerfile-using-pnpm"},"dateFormat":"DD MMM, YYYY","id":"c7e4ec0d-8096-517e-ac56-5dd7ff679876","previousPostId":"42ddf178-9017-5ca2-8454-1b5ad3d9acac","nextPostId":null}},"staticQueryHashes":[],"slicesMap":{}}