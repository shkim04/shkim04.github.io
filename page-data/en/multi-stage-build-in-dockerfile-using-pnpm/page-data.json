{"componentChunkName":"component---src-templates-blog-post-js","path":"/en/multi-stage-build-in-dockerfile-using-pnpm/","result":{"data":{"site":{"siteMetadata":{"title":"Seunghyun's Blog"}},"markdownRemark":{"id":"c7e4ec0d-8096-517e-ac56-5dd7ff679876","excerpt":"I chose to use npm as the package manager in the beginning as usual. But, I have changed it into pnpm and migrated it to this project since I was curious what…","html":"<p>I chose to use <strong>npm</strong> as the package manager in the beginning as usual. But, I have changed it into <strong>pnpm</strong> and migrated it to this project since I was curious what it is like - <em>I am not sure but I think it might impose a potential danger on the application. I should look more into this topic later.</em></p>\n<p>I had to change <strong>Docker</strong> script for it was written for <strong>npm</strong>. Let me break down the Dockerfile that I have implemented.</p>\n<blockquote>\n<p>For those who might read this article without reading the previous articles, You can find the whole backend code <a href=\"https://github.com/shkim04/find-your-wc\">here</a></p>\n</blockquote>\n<h2>Development stage</h2>\n<p><span\n      class=\"gatsby-resp-image-wrapper\"\n      style=\"position: relative; display: block; margin-left: auto; margin-right: auto; max-width: 630px; \"\n    >\n      <a\n    class=\"gatsby-resp-image-link\"\n    href=\"/static/0c03facdffeb46f04279d9e0979fae24/fe8a7/development-stage.png\"\n    style=\"display: block\"\n    target=\"_blank\"\n    rel=\"noopener\"\n  >\n    <span\n    class=\"gatsby-resp-image-background-image\"\n    style=\"padding-bottom: 35.44303797468354%; position: relative; bottom: 0; left: 0; background-image: url('data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABQAAAAHCAYAAAAIy204AAAACXBIWXMAABYlAAAWJQFJUiTwAAAA3ElEQVR42p2PW07DMBBFsw+wHTvxM3GckLb0Kfa/qoNiQALUD8rH0Z25Gh1pmt1yIp8vlOOVcrxRysy6n1nXiRIdS/IsQ2BO/ge1i54Sfc0xBjoXaFJe8DET8oKNA0oKtBBoKTG6xWh9l+5Op1pNM9kRbyM2ZcI4Y/oe3X2wHUgpkVJ9y6/5164USima4CI+z6Sy0ruASyMuDrg4Yjbp5+FfaXKcqmxYdlVmeot4fkIIgVLyceHLuGc63Jher0yHC/P5DRtTfeVRWRUmN+CHTKtbWq1ptan8R7YJ3wFh2caA/smLygAAAABJRU5ErkJggg=='); background-size: cover; display: block;\"\n  ></span>\n  <img\n        class=\"gatsby-resp-image-image\"\n        alt=\"development-stage\"\n        title=\"\"\n        src=\"/static/0c03facdffeb46f04279d9e0979fae24/f058b/development-stage.png\"\n        srcset=\"/static/0c03facdffeb46f04279d9e0979fae24/c26ae/development-stage.png 158w,\n/static/0c03facdffeb46f04279d9e0979fae24/6bdcf/development-stage.png 315w,\n/static/0c03facdffeb46f04279d9e0979fae24/f058b/development-stage.png 630w,\n/static/0c03facdffeb46f04279d9e0979fae24/40601/development-stage.png 945w,\n/static/0c03facdffeb46f04279d9e0979fae24/fe8a7/development-stage.png 1223w\"\n        sizes=\"(max-width: 630px) 100vw, 630px\"\n        style=\"width:100%;height:100%;margin:0;vertical-align:middle;position:absolute;top:0;left:0;\"\n        loading=\"lazy\"\n        decoding=\"async\"\n      />\n  </a>\n    </span></p>\n<p>Installing <code class=\"language-text\">pnpm</code> is added to the script by writing <code class=\"language-text\">RUN wget -qO /bin/pnpm \"https://github.com/pnpm/pnpm/releases/latest/download/pnpm-linuxstatic-x64\" &amp;&amp; chmod +x /bin/pnpm</code>.</p>\n<p>Notice that instead of <strong>install</strong>, <strong>fetch</strong> is used for loading packages and it only requires <code class=\"language-text\">pnpm-lock.yaml</code> file - <em>I reason that <code class=\"language-text\">pnpm fetch</code> is equivalent to <code class=\"language-text\">npm ci</code> when you use <code class=\"language-text\">npm</code> for the build.</em></p>\n<p>According to the official document of <strong>pnpm</strong>, <code class=\"language-text\">pnpm fetch</code> and <code class=\"language-text\">pnpm install --offline</code> will save so much time.</p>\n<p>Lastly, since we use <strong>Prisma</strong> in the application, we should add <code class=\"language-text\">RUN pnpm exec prisma generate</code> to generate prisma client.</p>\n<h2>Build stage</h2>\n<p><span\n      class=\"gatsby-resp-image-wrapper\"\n      style=\"position: relative; display: block; margin-left: auto; margin-right: auto; max-width: 630px; \"\n    >\n      <a\n    class=\"gatsby-resp-image-link\"\n    href=\"/static/78f279d415af6f7fd15acad423c019af/d9b5d/build-stage.png\"\n    style=\"display: block\"\n    target=\"_blank\"\n    rel=\"noopener\"\n  >\n    <span\n    class=\"gatsby-resp-image-background-image\"\n    style=\"padding-bottom: 40.50632911392405%; position: relative; bottom: 0; left: 0; background-image: url('data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABQAAAAICAYAAAD5nd/tAAAACXBIWXMAABYlAAAWJQFJUiTwAAABG0lEQVR42pWP7U6EMBBFeQ+hZWhpS7cfsGyURdFN/OH7P9E1DKy6GhP9cdI7TXsnpzgNZ6T5EWlakKdnpJwRY4dgWyY5g7jn6D7P9f76JhgNby2UsSh8GOB8QpeOMD6AagnTEIxWMErB6lvML7NWDeqaUITWw7QOynYwXUBNDWRNkESohERZVqiqCmVZMmu+zpyFYIQQkFKgGP0R4XTG/eUNx+UVeVowzC8Y5gt8HqFtB3tIcDHDxZ6Xts6zkTZuL5IfFNFG+P6EfloQxom1tXVolAYRbTQKpDZWgxVSGjXRTRkX5jgiPTxxqfGRP1XlHW/m7Ttf8838vdCZA2zIGz6ynnYejW5/6PyF4mADXEistSqw2p7/W7YWvgOXwuSLR1uIJwAAAABJRU5ErkJggg=='); background-size: cover; display: block;\"\n  ></span>\n  <img\n        class=\"gatsby-resp-image-image\"\n        alt=\"build-stage\"\n        title=\"\"\n        src=\"/static/78f279d415af6f7fd15acad423c019af/f058b/build-stage.png\"\n        srcset=\"/static/78f279d415af6f7fd15acad423c019af/c26ae/build-stage.png 158w,\n/static/78f279d415af6f7fd15acad423c019af/6bdcf/build-stage.png 315w,\n/static/78f279d415af6f7fd15acad423c019af/f058b/build-stage.png 630w,\n/static/78f279d415af6f7fd15acad423c019af/40601/build-stage.png 945w,\n/static/78f279d415af6f7fd15acad423c019af/d9b5d/build-stage.png 1224w\"\n        sizes=\"(max-width: 630px) 100vw, 630px\"\n        style=\"width:100%;height:100%;margin:0;vertical-align:middle;position:absolute;top:0;left:0;\"\n        loading=\"lazy\"\n        decoding=\"async\"\n      />\n  </a>\n    </span></p>\n<p>We can now copy <code class=\"language-text\">node_modules</code> folder created from the development stage. I have also copied <strong>.env</strong> file since it has some information when running the application.</p>\n<p>Finally by using <code class=\"language-text\">--prod</code> flag for installing packages after the build, Only production packages will be installed.</p>\n<h2>Production stage</h2>\n<p><span\n      class=\"gatsby-resp-image-wrapper\"\n      style=\"position: relative; display: block; margin-left: auto; margin-right: auto; max-width: 630px; \"\n    >\n      <a\n    class=\"gatsby-resp-image-link\"\n    href=\"/static/e99298f940617a5de8bbdbee98688ec5/681f1/production-stage.png\"\n    style=\"display: block\"\n    target=\"_blank\"\n    rel=\"noopener\"\n  >\n    <span\n    class=\"gatsby-resp-image-background-image\"\n    style=\"padding-bottom: 20.88607594936709%; position: relative; bottom: 0; left: 0; background-image: url('data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABQAAAAECAYAAACOXx+WAAAACXBIWXMAABYlAAAWJQFJUiTwAAAAyklEQVR42j2PW3KDMBAEuYdAQqCHJSSQwQabpHz/W3XKcpKPqen52K3qJpqAywmTItYHbEy40TF4Rx8c2ltk29LVCFohaNtPZNehpER2bWUpJU0JC9YF8n6yHCfp9iRe7/i0UPYv8u+e1p18PynPF/PxzfJ4EZYVFxPTdpC2R+WmhIJzF9K6M9+O2nFe8VNm3g5iueFz4ZKvld+Hb/48m+j7Hj0a9DjS64FmcgFvepIdMFoxGV052AGrRdWsSn/aQvxzVVaqatdWih8LhHS+oidIvQAAAABJRU5ErkJggg=='); background-size: cover; display: block;\"\n  ></span>\n  <img\n        class=\"gatsby-resp-image-image\"\n        alt=\"production-stage\"\n        title=\"\"\n        src=\"/static/e99298f940617a5de8bbdbee98688ec5/f058b/production-stage.png\"\n        srcset=\"/static/e99298f940617a5de8bbdbee98688ec5/c26ae/production-stage.png 158w,\n/static/e99298f940617a5de8bbdbee98688ec5/6bdcf/production-stage.png 315w,\n/static/e99298f940617a5de8bbdbee98688ec5/f058b/production-stage.png 630w,\n/static/e99298f940617a5de8bbdbee98688ec5/681f1/production-stage.png 899w\"\n        sizes=\"(max-width: 630px) 100vw, 630px\"\n        style=\"width:100%;height:100%;margin:0;vertical-align:middle;position:absolute;top:0;left:0;\"\n        loading=\"lazy\"\n        decoding=\"async\"\n      />\n  </a>\n    </span></p>\n<p>In the production stage, we will simply copy <code class=\"language-text\">node_modules</code> and <code class=\"language-text\">dist</code> folders created from the build stage and then run the application.</p>\n<p>Once you enter the command <code class=\"language-text\">docker build -t [image-name-you-want-give] -f Dockerfile .</code> to build an image, the image will be created and you can see how fast it is created and how light it is - <em>You can build an image without implementing multi-stage build to compare.</em></p>\n<p><em><strong>THANKS FOR READING. SEE YOU NEXT TIME!</strong></em></p>\n<h3>References</h3>\n<ul>\n<li><a href=\"https://pnpm.io/cli/fetch\">https://pnpm.io/cli/fetch</a></li>\n</ul>","frontmatter":{"title":"#15 Multi-stage build in Dockerfile using pnpm","date":"03 Nov, 2023","description":"","tag":["Project"]},"fields":{"locale":"en"}},"previous":{"fields":{"slug":"/en/display-aggregated-data-in-nextjs"},"frontmatter":{"title":"#14 Display aggregated data in Nextjs application"}},"next":{"fields":{"slug":"/en/link-postgresql-redis-application-in-docker-compose"},"frontmatter":{"title":"#16 Link PostgresQL and Redis to Application in docker-compose"}}},"pageContext":{"locale":"en","isDefaultLang":false,"slug":"/en/multi-stage-build-in-dockerfile-using-pnpm","titleByLang":{"ko":"pnpm으로-dockerfile에서-multi-stage-빌드하기","en":"multi-stage-build-in-dockerfile-using-pnpm"},"dateFormat":"DD MMM, YYYY","id":"c7e4ec0d-8096-517e-ac56-5dd7ff679876","previousPostId":"42ddf178-9017-5ca2-8454-1b5ad3d9acac","nextPostId":"2e356326-4209-567c-8686-001b40bd42a0"}},"staticQueryHashes":[],"slicesMap":{}}