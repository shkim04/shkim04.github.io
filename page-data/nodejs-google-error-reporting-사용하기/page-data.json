{"componentChunkName":"component---src-templates-blog-post-js","path":"/nodejs-google-error-reporting-사용하기/","result":{"data":{"site":{"siteMetadata":{"title":"Seunghyun's Blog"}},"markdownRemark":{"id":"047c43a2-f682-50b8-b7ab-23eb1d24ccb7","excerpt":"서비스중인 어플리케이션에 에러가 발생했을 때 개발자에게 에러를 신속하게 확인하고 알리는 것만큼 중요한 것도 없다. 이 목적으로 사용할 수 있는 많은 플랫폼들이 있는데 그 중 Google Error Reporting + Cloud Monitoring…","html":"<p>서비스중인 어플리케이션에 에러가 발생했을 때 개발자에게 에러를 신속하게 확인하고 알리는 것만큼 중요한 것도 없다. 이 목적으로 사용할 수 있는 많은 플랫폼들이 있는데 그 중 <strong>Google Error Reporting + Cloud Monitoring</strong>에 대해서 알아보려고 한다.</p>\n<h2>필수</h2>\n<ul>\n<li>google cloud 계정</li>\n<li>google service 계정 — <em>만드는 법을 모르시는 분들은 <a href=\"https://shkim04.github.io/nodejs-%EC%97%90%EC%84%9C-google-sheet-%EC%82%AC%EC%9A%A9%ED%95%98%EB%8A%94%EB%B2%95\">이 글</a>을 보시면 된다</em></li>\n<li>Node</li>\n<li>Insomnia</li>\n</ul>\n<h2>Google Error Reporting 허용</h2>\n<ul>\n<li>google clould 프로젝트 대시보드로 이동한다</li>\n<li><strong>APIs and services</strong> 클릭</li>\n<li><strong>ENABLE APIS AND SERVICE</strong> 클릭</li>\n<li>검색 창에 Error reporting을 입력하고 해당 API를 허용한다</li>\n</ul>\n<h2>Node.js — Express</h2>\n<p>Google Error Reporting을 사용하는 법에 중점을 두기 위해 Express API 서버를 만드는 것은 생략한다. 테스트용 Express API가 없는 분은 <a href=\"https://github.com/shkim04/express_typescript_simple_api\"><strong>여기</strong></a>에서 다운로드 받길 바란다. 준비가 되면 프로젝트를 열어 시작해보자.</p>\n<h2>Express에 Google Error Reporting 설정</h2>\n<div class=\"gatsby-highlight\" data-language=\"text\"><pre class=\"language-text\"><code class=\"language-text\">npm install --save @google-cloud/error-reporting</code></pre></div>\n<p>필요한 라이브러리를 받은 후 error reproting을 정상적으로 동작시키기 위해 <strong>ErrorReporting</strong> 객체 안에 필요한 키 값들을 알맞게 넣어줘야 한다. 이 키 값들은 <strong>google service account</strong> 생성하고 난 뒤 추가한 key <code class=\"language-text\">json</code> 파일에서 얻을 수 있다.</p>\n<p>아래 코드를 메인 스크립트에 추가한 뒤 필요한 값들을 입력한다:</p>\n<div class=\"gatsby-highlight\" data-language=\"js\"><pre class=\"language-js\"><code class=\"language-js\"><span class=\"token keyword\">const</span> <span class=\"token punctuation\">{</span> ErrorReporting <span class=\"token punctuation\">}</span> <span class=\"token operator\">=</span> <span class=\"token function\">require</span><span class=\"token punctuation\">(</span><span class=\"token string\">'@google-cloud/error-reporting'</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\r\n<span class=\"token comment\">// Instantiates a client</span>\r\n<span class=\"token keyword\">const</span> errorReporting <span class=\"token operator\">=</span> <span class=\"token keyword\">new</span> <span class=\"token class-name\">ErrorReporting</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">{</span>\r\n                           <span class=\"token literal-property property\">projectId</span><span class=\"token operator\">:</span> <span class=\"token string\">'your-project-id'</span><span class=\"token punctuation\">,</span>\r\n                           <span class=\"token literal-property property\">keyFilename</span><span class=\"token operator\">:</span> <span class=\"token string\">'key.json name'</span><span class=\"token punctuation\">,</span>\r\n                           <span class=\"token comment\">// this should look like 'hello.json'</span>\r\n                           <span class=\"token literal-property property\">credentials</span><span class=\"token operator\">:</span> <span class=\"token function\">require</span><span class=\"token punctuation\">(</span><span class=\"token template-string\"><span class=\"token template-punctuation string\">`</span><span class=\"token string\">/path/to/key.json</span><span class=\"token template-punctuation string\">`</span></span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">,</span>\r\n                           <span class=\"token literal-property property\">reportMode</span><span class=\"token operator\">:</span> <span class=\"token string\">'always'</span><span class=\"token punctuation\">,</span>\r\n                           <span class=\"token comment\">// the reason why I set this to 'always' is </span>\r\n                           <span class=\"token comment\">// because the application is run in development mode</span>\r\n                           <span class=\"token literal-property property\">logLevel</span><span class=\"token operator\">:</span> <span class=\"token number\">2</span><span class=\"token punctuation\">,</span>\r\n                           <span class=\"token literal-property property\">serviceContext</span><span class=\"token operator\">:</span> <span class=\"token punctuation\">{</span>\r\n                              <span class=\"token literal-property property\">service</span><span class=\"token operator\">:</span> <span class=\"token string\">\"Name your app\"</span><span class=\"token punctuation\">,</span>\r\n                              <span class=\"token comment\">// ex) Test_APP</span>\r\n                              <span class=\"token literal-property property\">version</span><span class=\"token operator\">:</span> <span class=\"token string\">\"specify your version\"</span><span class=\"token punctuation\">,</span>\r\n                              <span class=\"token comment\">// ex) 0.0.1</span>\r\n                           <span class=\"token punctuation\">}</span>\r\n                           <span class=\"token comment\">// serviceContext field should be filled</span>\r\n                      <span class=\"token punctuation\">}</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></code></pre></div>\n<h2>테스트 Route 추가</h2>\n<div class=\"gatsby-highlight\" data-language=\"js\"><pre class=\"language-js\"><code class=\"language-js\">app<span class=\"token punctuation\">.</span><span class=\"token function\">get</span><span class=\"token punctuation\">(</span><span class=\"token string\">\"/error\"</span><span class=\"token punctuation\">,</span> <span class=\"token keyword\">async</span> <span class=\"token punctuation\">(</span>req<span class=\"token operator\">:</span> Request<span class=\"token punctuation\">,</span> <span class=\"token literal-property property\">res</span><span class=\"token operator\">:</span> Response<span class=\"token punctuation\">,</span> <span class=\"token literal-property property\">next</span><span class=\"token operator\">:</span> NextFunction<span class=\"token punctuation\">)</span><span class=\"token operator\">:</span> Promise<span class=\"token operator\">&lt;</span><span class=\"token keyword\">void</span><span class=\"token operator\">></span> <span class=\"token operator\">=></span> <span class=\"token punctuation\">{</span>\r\n   <span class=\"token keyword\">try</span> <span class=\"token punctuation\">{</span>\r\n      <span class=\"token keyword\">throw</span> <span class=\"token keyword\">new</span> <span class=\"token class-name\">Error</span><span class=\"token punctuation\">(</span><span class=\"token string\">\"this is an intended error in '/error' route\"</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\r\n   <span class=\"token punctuation\">}</span>\r\n   <span class=\"token keyword\">catch</span><span class=\"token punctuation\">(</span>err<span class=\"token punctuation\">)</span> <span class=\"token punctuation\">{</span>\r\n      <span class=\"token function\">next</span><span class=\"token punctuation\">(</span><span class=\"token template-string\"><span class=\"token template-punctuation string\">`</span><span class=\"token string\">&lt;GET '/error route error>: </span><span class=\"token interpolation\"><span class=\"token interpolation-punctuation punctuation\">${</span>err<span class=\"token interpolation-punctuation punctuation\">}</span></span><span class=\"token template-punctuation string\">`</span></span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\r\n   <span class=\"token punctuation\">}</span>\r\n<span class=\"token punctuation\">}</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></code></pre></div>\n<p><code class=\"language-text\">/error</code> 라우트를 만드는데 이 라우트에 요청을 보내면 에러를 생성하게 만들어 catch 블락에서 에러를 잡아낼 수 있도록 한다. 이 catch 블락에 <strong>next</strong> 객체가 있는데 <em><strong>middleware</strong></em> 로써 역할을 한다.</p>\n<p>간단히 말하자면 에러 내용이 담긴 문자열을 다른 함수에 전달한다. 아래 코드는 그 에러 내용을 받아 처리하는 부분이다:</p>\n<div class=\"gatsby-highlight\" data-language=\"js\"><pre class=\"language-js\"><code class=\"language-js\">app<span class=\"token punctuation\">.</span><span class=\"token function\">use</span><span class=\"token punctuation\">(</span>errorReporting<span class=\"token punctuation\">.</span>express<span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></code></pre></div>\n<p>위 코드를 테스트 라우트 다음에 적어야 정상적으로 동작하지 주의한다.</p>\n<h2>Cloud Monitoring Notification 채널 생성</h2>\n<p>Expresss 어플리케이션에서 에러가 발생하면 즉각적으로 <strong>Google Error Reporting</strong> 콘솔에 기록이 되는 것을 예상할 수 있다. 하지만 에러가 발생해도 에러가 났는지 알려주는 기능은 없다. 에러가 발생된 것을 알리는 것이 중요한데 google cloud에는 자체적으로 모니터링 서비스가 존재한다. notificiation 채널을 만드는 법은 다음과 같다:</p>\n<ul>\n<li>Could Monitoring 대시보드로 이동한다</li>\n<li><strong>Alerting</strong> 클릭 후 <strong>Edit notification channels</strong> 클릭한다</li>\n<li><strong>Email</strong> 란에 있는 <strong>Add new</strong>를 클릭한다</li>\n<li>대화 상자를 완료하고 <strong>Save</strong>를 클릭한다</li>\n</ul>\n<p>이 notification 채널을 <strong>google error reporting</strong>에 추가한다. 이제 에러가 발생하면 google error reporting에 기록이 되고 notification 채널에 등록한 이메일로 알림을 받을 수 있다. <strong>google error reporting</strong>에 notification 채널을 등록하는 법은 다음과 같다:</p>\n<p><span\n      class=\"gatsby-resp-image-wrapper\"\n      style=\"position: relative; display: block; margin-left: auto; margin-right: auto; max-width: 270px; \"\n    >\n      <a\n    class=\"gatsby-resp-image-link\"\n    href=\"/static/90d52a35cc67e8e427099c55cc0244b7/01bf6/error-reporting.png\"\n    style=\"display: block\"\n    target=\"_blank\"\n    rel=\"noopener\"\n  >\n    <span\n    class=\"gatsby-resp-image-background-image\"\n    style=\"padding-bottom: 58.22784810126582%; position: relative; bottom: 0; left: 0; background-image: url('data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABQAAAAMCAYAAABiDJ37AAAACXBIWXMAAAsTAAALEwEAmpwYAAABOElEQVR42pVS226CQBDl/z+jD/0IXqzxgcQGSAspNiEkyLrVlCWKirCAp5k1UEHEdpLN7pyZncuZ0QDgfD63p9Hruu7cDX4t/T90tCGnIbmH921aA9i2jSiKFBgEARhj4JzD932cTqeHFWZZhrIsLwGpLcdxIIRQRs/zYFmWwkzTRJIknYD9NknSNIWU8u8tj9kHW6bqiqJQYJ7n6n08HlW7pFP2sQqrqroMhRRynkxeWg5nsxmm0ykMw1BvXdcxn8/Vp3sBiRZKrP1mKFsjkUuVkUpORDgFq+vbNblZm0Y5HHKUkioY5/DetDsc7vc5np9eYVtLBbpOCO9jBRYJfC44XJdh4XHYVoiIxY8rlLLC+xvDer1Txvh7i81mi3SXgX8lCJcCsdiDMYEVFzf8Xcu/16YzlAHbD17ap298LnAEAAAAAElFTkSuQmCC'); background-size: cover; display: block;\"\n  ></span>\n  <img\n        class=\"gatsby-resp-image-image\"\n        alt=\"error-reporting\"\n        title=\"\"\n        src=\"/static/90d52a35cc67e8e427099c55cc0244b7/01bf6/error-reporting.png\"\n        srcset=\"/static/90d52a35cc67e8e427099c55cc0244b7/c26ae/error-reporting.png 158w,\n/static/90d52a35cc67e8e427099c55cc0244b7/01bf6/error-reporting.png 270w\"\n        sizes=\"(max-width: 270px) 100vw, 270px\"\n        style=\"width:100%;height:100%;margin:0;vertical-align:middle;position:absolute;top:0;left:0;\"\n        loading=\"lazy\"\n        decoding=\"async\"\n      />\n  </a>\n    </span></p>\n<ul>\n<li>Error Reporting 이동한다</li>\n<li>Configure Notification Channels 클릭한다</li>\n<li>생성한 notification 선택한다</li>\n<li>Save 클릭한다</li>\n</ul>\n<h2>테스트 요청</h2>\n<p>개발 모드에서 어플리케이션을 실행한 후, Insomnia를 통해 테스트 라우트에 다음과 같은 요청을 보내보자:</p>\n<p><span\n      class=\"gatsby-resp-image-wrapper\"\n      style=\"position: relative; display: block; margin-left: auto; margin-right: auto; max-width: 630px; \"\n    >\n      <a\n    class=\"gatsby-resp-image-link\"\n    href=\"/static/b89f6da848796785028c382c278255ee/c5bb3/insomnia-request.png\"\n    style=\"display: block\"\n    target=\"_blank\"\n    rel=\"noopener\"\n  >\n    <span\n    class=\"gatsby-resp-image-background-image\"\n    style=\"padding-bottom: 15.18987341772152%; position: relative; bottom: 0; left: 0; background-image: url('data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABQAAAADCAYAAACTWi8uAAAACXBIWXMAAAsTAAALEwEAmpwYAAAAsUlEQVR42k3NywqCUBSFYR9FCJTSo0dNHTSIILpMpHlNggbNvELgK9TT9HSmwh/nVNCGD9Zmw16GlCFJkmhpmmqu6yKEQLge9nTCZnHkdnpyWF45rpect3suux2reI4jPHzfx7ZtLMvCUA+iKCIIAqSUhGGo9ziOdVbUbTZzyLKMtm3J85y6rimKgrIstaqqaJoGw/M+DYp6+Mv/VIFpmjwed9R0Xcer7+m/hmHQxnHkDTy6etHgQr30AAAAAElFTkSuQmCC'); background-size: cover; display: block;\"\n  ></span>\n  <img\n        class=\"gatsby-resp-image-image\"\n        alt=\"insomnia-request\"\n        title=\"\"\n        src=\"/static/b89f6da848796785028c382c278255ee/f058b/insomnia-request.png\"\n        srcset=\"/static/b89f6da848796785028c382c278255ee/c26ae/insomnia-request.png 158w,\n/static/b89f6da848796785028c382c278255ee/6bdcf/insomnia-request.png 315w,\n/static/b89f6da848796785028c382c278255ee/f058b/insomnia-request.png 630w,\n/static/b89f6da848796785028c382c278255ee/c5bb3/insomnia-request.png 680w\"\n        sizes=\"(max-width: 630px) 100vw, 630px\"\n        style=\"width:100%;height:100%;margin:0;vertical-align:middle;position:absolute;top:0;left:0;\"\n        loading=\"lazy\"\n        decoding=\"async\"\n      />\n  </a>\n    </span></p>\n<p>예상한대로 에러 내용이 담긴 응답을 보내준다. 이제 google cloud 콘솔에 에러가 기록이 되었는지 확인한다.</p>\n<p><strong>google error reporting</strong> 콘솔에 에러가 기록되는 것을 확인할 수 있고 에러의 내용, 어떤 어플리케이션에서 에러가 발생했는지도 확인할 수 있다. 또한, <strong>cloud monitoring</strong>을 통해 notification 채널을 <strong>google error reporting</strong>에 추가했으므로 다음과 같이 이메일로 알림을 받게 된다 - <em>이메일을 선택했다는 것을 기억하자</em>:</p>\n<p><span\n      class=\"gatsby-resp-image-wrapper\"\n      style=\"position: relative; display: block; margin-left: auto; margin-right: auto; max-width: 630px; \"\n    >\n      <a\n    class=\"gatsby-resp-image-link\"\n    href=\"/static/d44876630d1f503b00705569ffd06c92/a6d36/alert-mail.png\"\n    style=\"display: block\"\n    target=\"_blank\"\n    rel=\"noopener\"\n  >\n    <span\n    class=\"gatsby-resp-image-background-image\"\n    style=\"padding-bottom: 18.354430379746837%; position: relative; bottom: 0; left: 0; background-image: url('data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABQAAAAECAYAAACOXx+WAAAACXBIWXMAAAsTAAALEwEAmpwYAAAAsElEQVR42m2O2w7CIBBE+/+fpo/6VHujQEsTaaWFVnsbs5toNEpywnKYMETbtkNrBSklqqqCMTUjZYmiyNmXZYmmMRCi4FkpxQghYIxB21o456C1RgQA4zjCe48QPKZp4nPf9+i6Ds7dOEx+GAbO0R1hreWd8vM8I4SA6HhwuNoacXzh9izLkOcZz9ROv06SBGmavt3rwX8rOp8c7g/P7eu6ctOyLF+Q+/SUI/Z9/+EJjTkwavcN4u4AAAAASUVORK5CYII='); background-size: cover; display: block;\"\n  ></span>\n  <img\n        class=\"gatsby-resp-image-image\"\n        alt=\"alert-mail\"\n        title=\"\"\n        src=\"/static/d44876630d1f503b00705569ffd06c92/f058b/alert-mail.png\"\n        srcset=\"/static/d44876630d1f503b00705569ffd06c92/c26ae/alert-mail.png 158w,\n/static/d44876630d1f503b00705569ffd06c92/6bdcf/alert-mail.png 315w,\n/static/d44876630d1f503b00705569ffd06c92/f058b/alert-mail.png 630w,\n/static/d44876630d1f503b00705569ffd06c92/a6d36/alert-mail.png 650w\"\n        sizes=\"(max-width: 630px) 100vw, 630px\"\n        style=\"width:100%;height:100%;margin:0;vertical-align:middle;position:absolute;top:0;left:0;\"\n        loading=\"lazy\"\n        decoding=\"async\"\n      />\n  </a>\n    </span></p>\n<p>여기까지 Node.js에 google error reporting을 사용하는 법을 알아보았다.</p>\n<p><em><strong>읽어 주셔서 감사합니다. To be continued!</strong></em></p>\n<p><em>이 글은 <a href=\"https://medium.com/@shkim04/how-to-use-google-error-reporting-on-node-js-45b0a6b3054c\">Medium</a>에도 업로드 되었습니다.</em>\r\n<em>놀러 오세요!</em></p>","frontmatter":{"title":"Node.js에서 Google Error Reporting 사용하기","date":"2023년 02월 07일","description":"","tag":["Cloud","NodeJS"]},"fields":{"locale":"ko"}},"previous":{"fields":{"slug":"/nodejs-aws-sqs-사용하기"},"frontmatter":{"title":"Node.js 어플리케이션에서 AWS SQS 사용하기"}},"next":{"fields":{"slug":"/crontab-실무-적용-예시"},"frontmatter":{"title":"Crontab 실무에 적용한 예"}}},"pageContext":{"locale":"ko","isDefaultLang":true,"slug":"/nodejs-google-error-reporting-사용하기","titleByLang":{"ko":"nodejs-google-error-reporting-사용하기","en":"how-to-use-google-error-reporting-nodejs"},"dateFormat":"YYYY년 MM월 DD일","id":"047c43a2-f682-50b8-b7ab-23eb1d24ccb7","previousPostId":"c2d7da30-da2c-5563-8634-e108baa88ade","nextPostId":"19cf70ee-6a68-50f6-b131-4b9c2367cc91"}},"staticQueryHashes":[],"slicesMap":{}}