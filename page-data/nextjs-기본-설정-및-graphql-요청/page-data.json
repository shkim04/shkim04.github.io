{"componentChunkName":"component---src-templates-blog-post-js","path":"/nextjs-기본-설정-및-graphql-요청/","result":{"data":{"site":{"siteMetadata":{"title":"Seunghyun's Blog"}},"markdownRemark":{"id":"ab8314cc-903f-57ea-859b-6035796275ce","excerpt":"화장실 정보를 CRUD 작업을 할 수 있는 Nestjs-graphql 백엔드 어플리케이션이 있으니 이 정보들을 다루고 보여주는 Nextjs 어플리케이션을 만들려고 합니다. Nextjs app…","html":"<p>화장실 정보를 CRUD 작업을 할 수 있는 Nestjs-graphql 백엔드 어플리케이션이 있으니 이 정보들을 다루고 보여주는 Nextjs 어플리케이션을 만들려고 합니다.</p>\n<h2>Nextjs app 생성하기</h2>\n<div class=\"gatsby-highlight\" data-language=\"bash\"><pre class=\"language-bash\"><code class=\"language-bash\">npx create-next-app</code></pre></div>\n<p>위 명령어를 실행하면 설치에 관련한 질문들을 볼 수 있습니다.</p>\n<div class=\"gatsby-highlight\" data-language=\"text\"><pre class=\"language-text\"><code class=\"language-text\">What is your project named? my-app\r\nWould you like to use TypeScript? No / Yes\r\nWould you like to use ESLint? No / Yes\r\nWould you like to use Tailwind CSS? No / Yes\r\nWould you like to use `src/` directory? No / Yes\r\nWould you like to use App Router? (recommended) No / Yes\r\nWould you like to customize the default import alias? No / Yes\r\nWhat import alias would you like configured? @/*</code></pre></div>\n<p>개발을 용이하게 만들어 줄 것으로 보이기 때문에 모든 질문에 <code class=\"language-text\">Yes</code>를 선택합니다.</p>\n<h2>동적 라우트 생성하기</h2>\n<p>필자는 국가, 도시 그리고 거리 이름에 따른 화장실 정보 목록들을 동적으로 보여주는 페이지를 만들려고 합니다. 공식 문서에 따르면 App Router의 동적 라우트는 <code class=\"language-text\">[country]</code>,<code class=\"language-text\">[city]</code> 같이 대괄호로 감싼 폴더 이름을 통해 얻을 수 있다고 합니다. 국가, 나라 그리고 거리는 서로 연관이 있기 때문에 라우트는 <code class=\"language-text\">[country]/[city]/[street]</code>과 같은 형태가 될 것입니다.</p>\n<p>이를 구현하기 위해 <code class=\"language-text\">/toilets</code>로 표현되는 라우트가 될 <code class=\"language-text\">toilets</code>이라는 폴더를 생성합니다. 그리고 나서 <code class=\"language-text\">[country]</code> 폴더를 생성합니다. 같은 방식으로 <code class=\"language-text\">[city]</code>와 <code class=\"language-text\">[street]</code>를 순서대로 <code class=\"language-text\">[country]</code>와 <code class=\"language-text\">[city]</code> 하위에 생성합니다.</p>\n<div class=\"gatsby-highlight\" data-language=\"text\"><pre class=\"language-text\"><code class=\"language-text\">src/app\r\n└── toilets\r\n    ├── [country]\r\n    │   ├── [city]\r\n    │   │   ├── [street]\r\n    │   │   │   └── page.tsx\r\n    │   │   └── page.tsx\r\n    │   └── page.tsx\r\n    └── page.tsx</code></pre></div>\n<h2>테스트 화장실 추가하기</h2>\n<p>Nestjs-graphql 서버가 잘 동작하는지 확인하기 위해 <em>playground</em> 를 통해 테스트 화장실을 추가해보겠습니다. 그리고 나서 이 화장실 정보들이 Nextjs 어플리케이션에서 사용될 것입니다.</p>\n<p><span\n      class=\"gatsby-resp-image-wrapper\"\n      style=\"position: relative; display: block; margin-left: auto; margin-right: auto; max-width: 630px; \"\n    >\n      <a\n    class=\"gatsby-resp-image-link\"\n    href=\"/static/e0fc2e2bc7b64cfeddc73047a5e92a27/c7dcc/test-toilets-playground.png\"\n    style=\"display: block\"\n    target=\"_blank\"\n    rel=\"noopener\"\n  >\n    <span\n    class=\"gatsby-resp-image-background-image\"\n    style=\"padding-bottom: 104.43037974683544%; position: relative; bottom: 0; left: 0; background-image: url('data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABQAAAAVCAYAAABG1c6oAAAACXBIWXMAABYlAAAWJQFJUiTwAAACD0lEQVR42qVV7W7iMBDkKbDX11Ork/gBJM73B0nshIOW0l7f/3Hm5HWggKoW2h+rxA4ZdmZnnMksqaCrEn/SBioaQGEHsWy+XZPpsgGlj6B0B8qeoOI1VNBBLJpv1cShSgeqDWRoIYMGMm4hoo5LutIthG7H+w4y9nsyGvcivyfC1gOKxQpS91DFCyhZg5oN7lYGvxsLWfSgqocsLGRu+UrNAJka0GrgZ1T3vEdRNwIuV9wdFXsPGm9wH1vM0g60HOksb6DMHUYDVPkKlT+zjpS/gZIdxLw+B/tqKMdF0HF33GGxxy9tQNGopdMrHnUKrgV0tCPX2Z67pNh4bZx+uQWVPWRmIIP2OsCpox3/BTnK6RaUOLEHUDuAMutfmN9Ame2ie+/JZAPSA3fDk80txBednQG6F5U2o/g1D+n4o/nJME71C5oP9WRAFzc3BEebO1n4yftq3tfzD8o9O9yfUdaWqcqwhcw6iLLH1GnnBsG0zWhuAyrHdd37azkaX58YW4T26EMqtnjIa8yKCpSYo2VcOs6u7s9c/BID4So4i56F4qTseSB36QsesidI1vTE2FdRPmS5evOg2SNUsoHQw4WOFwMKPjW2P8YYsPwH5TQtDPuQD4TaHwIyNrcmZQeVbCGTDtSu340dtr6uTYoYk6KqVwbliacW1A2cGAa75XBQYXeR0+sAPknKz74lB8D/Btt3sBFGtuYAAAAASUVORK5CYII='); background-size: cover; display: block;\"\n  ></span>\n  <img\n        class=\"gatsby-resp-image-image\"\n        alt=\"test-toilets-playground\"\n        title=\"\"\n        src=\"/static/e0fc2e2bc7b64cfeddc73047a5e92a27/f058b/test-toilets-playground.png\"\n        srcset=\"/static/e0fc2e2bc7b64cfeddc73047a5e92a27/c26ae/test-toilets-playground.png 158w,\n/static/e0fc2e2bc7b64cfeddc73047a5e92a27/6bdcf/test-toilets-playground.png 315w,\n/static/e0fc2e2bc7b64cfeddc73047a5e92a27/f058b/test-toilets-playground.png 630w,\n/static/e0fc2e2bc7b64cfeddc73047a5e92a27/c7dcc/test-toilets-playground.png 641w\"\n        sizes=\"(max-width: 630px) 100vw, 630px\"\n        style=\"width:100%;height:100%;margin:0;vertical-align:middle;position:absolute;top:0;left:0;\"\n        loading=\"lazy\"\n        decoding=\"async\"\n      />\n  </a>\n    </span></p>\n<h2>도시에 따른 화장실 정보 보여주기</h2>\n<p><strong>Jeonju</strong>에 있는 화장실 정보를 요청해보겠습니다. 그러기 위해서는 쿼리 요청을 해야 합니다. App Router를 사용할 때는 <strong>fetch</strong>를 사용하면 간단하게 요청을 할 수 있습니다. 다음의 코드를 <code class=\"language-text\">[city]</code> 폴더 하위에 있는 <code class=\"language-text\">page.tsx</code> 파일에 적습니다.</p>\n<div class=\"gatsby-highlight\" data-language=\"js\"><pre class=\"language-js\"><code class=\"language-js\"><span class=\"token keyword\">async</span> <span class=\"token keyword\">function</span> <span class=\"token function\">getData</span><span class=\"token punctuation\">(</span><span class=\"token parameter\"><span class=\"token literal-property property\">city</span><span class=\"token operator\">:</span> string</span><span class=\"token punctuation\">)</span> <span class=\"token punctuation\">{</span>\r\n  <span class=\"token keyword\">const</span> res <span class=\"token operator\">=</span> <span class=\"token keyword\">await</span> <span class=\"token function\">fetch</span><span class=\"token punctuation\">(</span><span class=\"token string\">'http://localhost:4000/graphql'</span><span class=\"token punctuation\">,</span> <span class=\"token punctuation\">{</span>\r\n    <span class=\"token literal-property property\">method</span><span class=\"token operator\">:</span> <span class=\"token string\">'POST'</span><span class=\"token punctuation\">,</span>\r\n    <span class=\"token literal-property property\">body</span><span class=\"token operator\">:</span> <span class=\"token constant\">JSON</span><span class=\"token punctuation\">.</span><span class=\"token function\">stringify</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">{</span>\r\n      <span class=\"token literal-property property\">query</span><span class=\"token operator\">:</span> <span class=\"token template-string\"><span class=\"token template-punctuation string\">`</span><span class=\"token string\">{ toilets(city: \"</span><span class=\"token interpolation\"><span class=\"token interpolation-punctuation punctuation\">${</span>city<span class=\"token interpolation-punctuation punctuation\">}</span></span><span class=\"token string\">\") {\r\n        id\r\n        price\r\n        isPaid\r\n        address {\r\n          street\r\n          city\r\n          country\r\n        }\r\n      }}</span><span class=\"token template-punctuation string\">`</span></span><span class=\"token punctuation\">,</span>\r\n    <span class=\"token punctuation\">}</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">,</span>\r\n    <span class=\"token literal-property property\">headers</span><span class=\"token operator\">:</span> <span class=\"token punctuation\">{</span>\r\n      <span class=\"token string-property property\">'Content-Type'</span><span class=\"token operator\">:</span> <span class=\"token string\">'application/json'</span><span class=\"token punctuation\">,</span>\r\n    <span class=\"token punctuation\">}</span><span class=\"token punctuation\">,</span>\r\n    <span class=\"token literal-property property\">next</span><span class=\"token operator\">:</span> <span class=\"token punctuation\">{</span> <span class=\"token literal-property property\">revalidate</span><span class=\"token operator\">:</span> <span class=\"token number\">10</span> <span class=\"token punctuation\">}</span><span class=\"token punctuation\">,</span>\r\n  <span class=\"token punctuation\">}</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\r\n\r\n  <span class=\"token keyword\">if</span> <span class=\"token punctuation\">(</span><span class=\"token operator\">!</span>res<span class=\"token punctuation\">.</span>ok<span class=\"token punctuation\">)</span> <span class=\"token punctuation\">{</span>\r\n    <span class=\"token keyword\">throw</span> <span class=\"token keyword\">new</span> <span class=\"token class-name\">Error</span><span class=\"token punctuation\">(</span><span class=\"token string\">'Failed to fetch toilet data in a city'</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\r\n  <span class=\"token punctuation\">}</span>\r\n  <span class=\"token keyword\">const</span> dataObj <span class=\"token operator\">=</span> <span class=\"token keyword\">await</span> res<span class=\"token punctuation\">.</span><span class=\"token function\">json</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\r\n  <span class=\"token keyword\">return</span> dataObj<span class=\"token punctuation\">.</span>data<span class=\"token punctuation\">;</span>\r\n<span class=\"token punctuation\">}</span>\r\n\r\n<span class=\"token keyword\">export</span> <span class=\"token keyword\">default</span> <span class=\"token keyword\">async</span> <span class=\"token keyword\">function</span> <span class=\"token function\">City</span><span class=\"token punctuation\">(</span><span class=\"token parameter\"><span class=\"token punctuation\">{</span> params <span class=\"token punctuation\">}</span><span class=\"token operator\">:</span> <span class=\"token punctuation\">{</span> <span class=\"token literal-property property\">params</span><span class=\"token operator\">:</span> <span class=\"token punctuation\">{</span> <span class=\"token literal-property property\">city</span><span class=\"token operator\">:</span> string <span class=\"token punctuation\">}</span> <span class=\"token punctuation\">}</span></span><span class=\"token punctuation\">)</span> <span class=\"token punctuation\">{</span>\r\n  <span class=\"token keyword\">const</span> <span class=\"token punctuation\">{</span> toilets <span class=\"token punctuation\">}</span> <span class=\"token operator\">=</span> <span class=\"token keyword\">await</span> <span class=\"token function\">getData</span><span class=\"token punctuation\">(</span>params<span class=\"token punctuation\">.</span>city<span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\r\n  <span class=\"token keyword\">return</span> <span class=\"token punctuation\">(</span>\r\n    <span class=\"token operator\">&lt;</span>main className<span class=\"token operator\">=</span><span class=\"token string\">'flex min-h-screen flex-col items-center justify-between p-24'</span><span class=\"token operator\">></span>\r\n      <span class=\"token operator\">&lt;</span>div className<span class=\"token operator\">=</span><span class=\"token string\">'z-10 max-w-5xl flex-col w-full items-center justify-between font-mono text-sm lg:flex'</span><span class=\"token operator\">></span>\r\n        <span class=\"token punctuation\">{</span>toilets<span class=\"token punctuation\">.</span><span class=\"token function\">map</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">(</span><span class=\"token parameter\"><span class=\"token literal-property property\">toilet</span><span class=\"token operator\">:</span> any<span class=\"token punctuation\">,</span> <span class=\"token literal-property property\">index</span><span class=\"token operator\">:</span> number</span><span class=\"token punctuation\">)</span> <span class=\"token operator\">=></span> <span class=\"token punctuation\">{</span>\r\n          <span class=\"token keyword\">return</span> <span class=\"token punctuation\">(</span>\r\n            <span class=\"token operator\">&lt;</span>p\r\n              key<span class=\"token operator\">=</span><span class=\"token punctuation\">{</span>index<span class=\"token punctuation\">}</span>\r\n              className<span class=\"token operator\">=</span><span class=\"token string\">'flex flex-col w-full justify-center border-b border-gray-300 bg-gradient-to-b from-zinc-200 pb-6 pt-8 backdrop-blur-2xl dark:border-neutral-800 dark:bg-zinc-800/30 dark:from-inherit lg:static lg:w-auto  lg:rounded-xl lg:border lg:bg-gray-200 lg:p-4 lg:dark:bg-zinc-800/30'</span>\r\n            <span class=\"token operator\">></span>\r\n              <span class=\"token operator\">&lt;</span>span className<span class=\"token operator\">=</span><span class=\"token string\">'w-full'</span><span class=\"token operator\">></span><span class=\"token constant\">ID</span><span class=\"token operator\">:</span> <span class=\"token punctuation\">{</span>toilet<span class=\"token punctuation\">.</span>id<span class=\"token punctuation\">}</span><span class=\"token operator\">&lt;</span><span class=\"token operator\">/</span>span<span class=\"token operator\">></span>\r\n              <span class=\"token operator\">&lt;</span>br <span class=\"token operator\">/</span><span class=\"token operator\">></span>\r\n              <span class=\"token operator\">&lt;</span>span className<span class=\"token operator\">=</span><span class=\"token string\">'w-full'</span><span class=\"token operator\">></span>Price<span class=\"token operator\">:</span> <span class=\"token punctuation\">{</span>toilet<span class=\"token punctuation\">.</span>price<span class=\"token punctuation\">}</span><span class=\"token operator\">&lt;</span><span class=\"token operator\">/</span>span<span class=\"token operator\">></span>\r\n              <span class=\"token operator\">&lt;</span>br <span class=\"token operator\">/</span><span class=\"token operator\">></span>\r\n              <span class=\"token operator\">&lt;</span>span className<span class=\"token operator\">=</span><span class=\"token string\">'w-full'</span><span class=\"token operator\">></span>Country<span class=\"token operator\">:</span> <span class=\"token punctuation\">{</span>toilet<span class=\"token punctuation\">.</span>address<span class=\"token punctuation\">.</span>country<span class=\"token punctuation\">}</span><span class=\"token operator\">&lt;</span><span class=\"token operator\">/</span>span<span class=\"token operator\">></span>\r\n              <span class=\"token operator\">&lt;</span>br <span class=\"token operator\">/</span><span class=\"token operator\">></span>\r\n              <span class=\"token operator\">&lt;</span>span className<span class=\"token operator\">=</span><span class=\"token string\">'w-full'</span><span class=\"token operator\">></span>City<span class=\"token operator\">:</span> <span class=\"token punctuation\">{</span>toilet<span class=\"token punctuation\">.</span>address<span class=\"token punctuation\">.</span>city<span class=\"token punctuation\">}</span><span class=\"token operator\">&lt;</span><span class=\"token operator\">/</span>span<span class=\"token operator\">></span>\r\n              <span class=\"token operator\">&lt;</span>br <span class=\"token operator\">/</span><span class=\"token operator\">></span>\r\n              <span class=\"token operator\">&lt;</span>span className<span class=\"token operator\">=</span><span class=\"token string\">'w-full'</span><span class=\"token operator\">></span>Street<span class=\"token operator\">:</span> <span class=\"token punctuation\">{</span>toilet<span class=\"token punctuation\">.</span>address<span class=\"token punctuation\">.</span>street<span class=\"token punctuation\">}</span><span class=\"token operator\">&lt;</span><span class=\"token operator\">/</span>span<span class=\"token operator\">></span>\r\n            <span class=\"token operator\">&lt;</span><span class=\"token operator\">/</span>p<span class=\"token operator\">></span>\r\n          <span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\r\n        <span class=\"token punctuation\">}</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">}</span>\r\n      <span class=\"token operator\">&lt;</span><span class=\"token operator\">/</span>div<span class=\"token operator\">></span>\r\n    <span class=\"token operator\">&lt;</span><span class=\"token operator\">/</span>main<span class=\"token operator\">></span>\r\n  <span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\r\n<span class=\"token punctuation\">}</span></code></pre></div>\n<p>도시 이름을 갖고 있는 파라미터는 <em><a href=\"https://your-website.com/toilets/a-country-name/a-city-name\">https://your-website.com/toilets/a-country-name/a-city-name</a></em> 과 같은 형식의 url에 사용자가 접근했을 때 <strong>City</strong> 컴포넌트로 전달이 됩니다. 해당 도시 이름은 <code class=\"language-text\">getData</code> 함수에 전달되어 쿼리를 형성하게 됩니다. 컴포넌트가 전달된 쿼리에 맞는 화장실 정보를 얻게 되면 이 화장실 정보들이 다음과 같이 브라우저에 보이게 될 것입니다.</p>\n<p><span\n      class=\"gatsby-resp-image-wrapper\"\n      style=\"position: relative; display: block; margin-left: auto; margin-right: auto; max-width: 630px; \"\n    >\n      <a\n    class=\"gatsby-resp-image-link\"\n    href=\"/static/9c348002ea151ba21c7a064838103b29/ae694/test-toilets-info.png\"\n    style=\"display: block\"\n    target=\"_blank\"\n    rel=\"noopener\"\n  >\n    <span\n    class=\"gatsby-resp-image-background-image\"\n    style=\"padding-bottom: 72.78481012658227%; position: relative; bottom: 0; left: 0; background-image: url('data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABQAAAAPCAYAAADkmO9VAAAACXBIWXMAABYlAAAWJQFJUiTwAAABs0lEQVR42pXS2ZKiMBQG4Lz/m824tWAjS3aSsCraXX39TyWIZrRvvPjqcEj9ZIMUBYfWDtZ2cK5H4/pQvWn6xvX68xZScQEmNbjSYOpRPaENZG3fQnLGcaTsdxV9GymFxLPiphRi7uVtTM6KXzILQqVCjKsaUt+2oE3ohazBw7HUMzlXfyzPecJ1jYWoDSomkKYZ1usd/v5ZI8sKHA45PrMcaXoMY/vkE/v9AUI9sgsijcFCWQvKJLbbBEmaYbPdQ2kL1wwwpoWxEdNBG4c47xFtHRa1a0CZwmq9C6tYbz5QlBxc1LCuf1HbFnHeI6ZpEVOmAeUaQhpwaUC5glAGrh3vbDOEalyH5zyxXYe7vg8XwZhEXlCUFQfj/rnC8Vgiz2k4y0NWIDtWqG2D//JdB9L0AxbtMIYz9FvdbD6wWu3AuA4T0EChogKMq9Bb1yHOe6QbRyz60yncnL8Mvwpf/S/iL6Xx2pnvg7ZHnPfIcDpjMZ4nSGWwTzIcshKbbRKq355x/cw+NN2AOO+R0zQh5j96mi4YzxeM0+U+UT+eX/ix5zyZrlfELtcvXEJd+vj9q+f8P3bdSeLlMt7LAAAAAElFTkSuQmCC'); background-size: cover; display: block;\"\n  ></span>\n  <img\n        class=\"gatsby-resp-image-image\"\n        alt=\"test-toilets-info\"\n        title=\"\"\n        src=\"/static/9c348002ea151ba21c7a064838103b29/f058b/test-toilets-info.png\"\n        srcset=\"/static/9c348002ea151ba21c7a064838103b29/c26ae/test-toilets-info.png 158w,\n/static/9c348002ea151ba21c7a064838103b29/6bdcf/test-toilets-info.png 315w,\n/static/9c348002ea151ba21c7a064838103b29/f058b/test-toilets-info.png 630w,\n/static/9c348002ea151ba21c7a064838103b29/ae694/test-toilets-info.png 850w\"\n        sizes=\"(max-width: 630px) 100vw, 630px\"\n        style=\"width:100%;height:100%;margin:0;vertical-align:middle;position:absolute;top:0;left:0;\"\n        loading=\"lazy\"\n        decoding=\"async\"\n      />\n  </a>\n    </span></p>\n<p>지금은 간단한 동적 라우트 생성과 graphql 요청을 해보는 데에만 신경을 썼습니다. 앞으로 Typescript와 Tailwind로 프론트엔드를 향상시킬 뿐만 아니라 이 프론트엔드와 유기적으로 동작할 백엔드에서도 더 많은 세부 기능들을 개발할 것입니다.</p>\n<p><em><strong>읽어 주셔서 감사합니다. To be continued!</strong></em></p>\n<h3>참조</h3>\n<ul>\n<li><a href=\"https://nextjs.org/docs/app/building-your-application/routing/defining-routes\">https://nextjs.org/docs/app/building-your-application/routing/defining-routes</a></li>\n<li><a href=\"https://nextjs.org/docs/app/building-your-application/data-fetching/fetching-caching-and-revalidating\">https://nextjs.org/docs/app/building-your-application/data-fetching/fetching-caching-and-revalidating</a></li>\n</ul>","frontmatter":{"title":"#10 Nextjs 기본 설정 및 GraphQL 요청","date":"2023년 09월 13일","description":"","tag":["Project","ReactJS"]},"fields":{"locale":"ko"}},"previous":{"fields":{"slug":"/nestjs-graphql-logging-예외-처리"},"frontmatter":{"title":"#9 Nestjs Graphql logging과 예외 처리"}},"next":{"fields":{"slug":"/nextjs-app-router로-graphql-mutation-쿼리-요청하기"},"frontmatter":{"title":"#11 Nextjs App router로 Graphql mutation 쿼리 요청하기"}}},"pageContext":{"locale":"ko","isDefaultLang":true,"slug":"/nextjs-기본-설정-및-graphql-요청","titleByLang":{"ko":"nextjs-기본-설정-및-graphql-요청","en":"nextjs-basic-setup-and-request-graphql"},"dateFormat":"YYYY년 MM월 DD일","id":"ab8314cc-903f-57ea-859b-6035796275ce","previousPostId":"bcce5e69-c13b-54b5-9480-800208fc2b80","nextPostId":"5132b814-4df3-5db4-b0a5-0188fca52df6"}},"staticQueryHashes":[],"slicesMap":{}}