{"componentChunkName":"component---src-templates-blog-post-js","path":"/nextjs-app-router로-graphql-mutation-쿼리-요청하기/","result":{"data":{"site":{"siteMetadata":{"title":"Seunghyun's Blog"}},"markdownRemark":{"id":"5132b814-4df3-5db4-b0a5-0188fca52df6","excerpt":"이 어플리케이션은 이제 나라, 도시 그리고 길 이름에 따라 동적으로 화장실 정보를 보여주는 페이지를 가지고 있습니다. 하지만 사용자들이 처음에 화장실 주소, 리뷰 등을 적어 화장실 정보를 등록할 수 있어야 합니다. 그래서 화장실 정보를 form에 담아 graphql mutation…","html":"<p>이 어플리케이션은 이제 나라, 도시 그리고 길 이름에 따라 동적으로 화장실 정보를 보여주는 페이지를 가지고 있습니다. 하지만 사용자들이 처음에 화장실 주소, 리뷰 등을 적어 화장실 정보를 등록할 수 있어야 합니다. 그래서 화장실 정보를 form에 담아 graphql mutation 쿼리를 요청하는 <code class=\"language-text\">/contribute</code> 라우트를 만들어 보겠습니다.</p>\n<h2>Contribute 컴포넌트 생성</h2>\n<p>아래와 같이 <code class=\"language-text\">/contribute</code> 라우트를 생성하기 위해 <code class=\"language-text\">contribute</code>라는 이름의 폴더를 만듭니다.</p>\n<div class=\"gatsby-highlight\" data-language=\"text\"><pre class=\"language-text\"><code class=\"language-text\">src/app\r\n├── contribute\r\n│   └── page.tsx\r\n└── toilets\r\n    ├── [country]\r\n    │   ├── [city]\r\n    │   │   ├── [street]\r\n    │   │   │   └── page.tsx\r\n    │   │   └── page.tsx\r\n    │   └── page.tsx\r\n    └── page.tsx</code></pre></div>\n<p><code class=\"language-text\">contribute</code> 폴더 하위에 <code class=\"language-text\">page.tsx</code> 파일 안에 다음 코드를 작성합니다.</p>\n<div class=\"gatsby-highlight\" data-language=\"js\"><pre class=\"language-js\"><code class=\"language-js\"><span class=\"token string\">'use client'</span><span class=\"token punctuation\">;</span>\r\n<span class=\"token keyword\">import</span> <span class=\"token punctuation\">{</span> useState<span class=\"token punctuation\">,</span> useRef <span class=\"token punctuation\">}</span> <span class=\"token keyword\">from</span> <span class=\"token string\">'react'</span><span class=\"token punctuation\">;</span>\r\n<span class=\"token keyword\">import</span> create <span class=\"token keyword\">from</span> <span class=\"token string\">'./action'</span><span class=\"token punctuation\">;</span>\r\n\r\n<span class=\"token keyword\">export</span> <span class=\"token keyword\">default</span> <span class=\"token keyword\">function</span> <span class=\"token function\">Contribute</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span> <span class=\"token punctuation\">{</span>\r\n  <span class=\"token keyword\">const</span> <span class=\"token punctuation\">[</span>paid<span class=\"token punctuation\">,</span> setPaid<span class=\"token punctuation\">]</span> <span class=\"token operator\">=</span> <span class=\"token function\">useState</span><span class=\"token punctuation\">(</span><span class=\"token string\">''</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\r\n  <span class=\"token keyword\">const</span> priceRef <span class=\"token operator\">=</span> useRef<span class=\"token operator\">&lt;</span>HTMLInputElement<span class=\"token operator\">></span><span class=\"token punctuation\">(</span><span class=\"token keyword\">null</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\r\n  <span class=\"token keyword\">const</span> streetNumberRef <span class=\"token operator\">=</span> useRef<span class=\"token operator\">&lt;</span>HTMLInputElement<span class=\"token operator\">></span><span class=\"token punctuation\">(</span><span class=\"token keyword\">null</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\r\n  <span class=\"token keyword\">const</span> streetRef <span class=\"token operator\">=</span> useRef<span class=\"token operator\">&lt;</span>HTMLInputElement<span class=\"token operator\">></span><span class=\"token punctuation\">(</span><span class=\"token keyword\">null</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\r\n  <span class=\"token keyword\">const</span> cityRef <span class=\"token operator\">=</span> useRef<span class=\"token operator\">&lt;</span>HTMLInputElement<span class=\"token operator\">></span><span class=\"token punctuation\">(</span><span class=\"token keyword\">null</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\r\n  <span class=\"token keyword\">const</span> countryRef <span class=\"token operator\">=</span> useRef<span class=\"token operator\">&lt;</span>HTMLInputElement<span class=\"token operator\">></span><span class=\"token punctuation\">(</span><span class=\"token keyword\">null</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\r\n  <span class=\"token keyword\">const</span> emailRef <span class=\"token operator\">=</span> useRef<span class=\"token operator\">&lt;</span>HTMLInputElement<span class=\"token operator\">></span><span class=\"token punctuation\">(</span><span class=\"token keyword\">null</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\r\n  <span class=\"token keyword\">const</span> passwordRef <span class=\"token operator\">=</span> useRef<span class=\"token operator\">&lt;</span>HTMLInputElement<span class=\"token operator\">></span><span class=\"token punctuation\">(</span><span class=\"token keyword\">null</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\r\n  <span class=\"token keyword\">const</span> cleanlinessRef <span class=\"token operator\">=</span> useRef<span class=\"token operator\">&lt;</span>HTMLInputElement<span class=\"token operator\">></span><span class=\"token punctuation\">(</span><span class=\"token keyword\">null</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\r\n  <span class=\"token keyword\">const</span> performanceRef <span class=\"token operator\">=</span> useRef<span class=\"token operator\">&lt;</span>HTMLInputElement<span class=\"token operator\">></span><span class=\"token punctuation\">(</span><span class=\"token keyword\">null</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\r\n  <span class=\"token keyword\">const</span> descriptionRef <span class=\"token operator\">=</span> useRef<span class=\"token operator\">&lt;</span>HTMLTextAreaElement<span class=\"token operator\">></span><span class=\"token punctuation\">(</span><span class=\"token keyword\">null</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\r\n\r\n  <span class=\"token keyword\">return</span> <span class=\"token punctuation\">(</span>\r\n    <span class=\"token operator\">&lt;</span>main className<span class=\"token operator\">=</span><span class=\"token string\">'flex min-h-screen flex-col items-center justify-between p-24'</span><span class=\"token operator\">></span>\r\n      <span class=\"token operator\">&lt;</span>form\r\n        className<span class=\"token operator\">=</span><span class=\"token string\">'w-1/2 bg-white shadow-md rounded px-8 pt-6 pb-8 mb-4'</span>\r\n        action<span class=\"token operator\">=</span><span class=\"token punctuation\">{</span>create<span class=\"token punctuation\">}</span>\r\n      <span class=\"token operator\">></span>\r\n        <span class=\"token operator\">&lt;</span>div className<span class=\"token operator\">=</span><span class=\"token string\">'mb-4'</span><span class=\"token operator\">></span>\r\n          <span class=\"token operator\">&lt;</span>label className<span class=\"token operator\">=</span><span class=\"token string\">'block text-gray-700 text-sm font-bold mb-2'</span><span class=\"token operator\">></span>\r\n            Paid or not\r\n          <span class=\"token operator\">&lt;</span><span class=\"token operator\">/</span>label<span class=\"token operator\">></span>\r\n          <span class=\"token operator\">&lt;</span>div className<span class=\"token operator\">=</span><span class=\"token string\">'flex items-center mb-4'</span><span class=\"token operator\">></span>\r\n            <span class=\"token operator\">&lt;</span>input\r\n              className<span class=\"token operator\">=</span><span class=\"token string\">'w-4 h-4 text-blue-600 bg-gray-100 border-gray-300 rounded focus:ring-blue-500 dark:focus:ring-blue-600 dark:ring-offset-gray-800 focus:ring-2 dark:bg-gray-700 dark:border-gray-600'</span>\r\n              checked<span class=\"token operator\">=</span><span class=\"token punctuation\">{</span>paid <span class=\"token operator\">===</span> <span class=\"token string\">'Yes'</span><span class=\"token punctuation\">}</span>\r\n              type<span class=\"token operator\">=</span><span class=\"token string\">'radio'</span>\r\n              name<span class=\"token operator\">=</span><span class=\"token string\">'paid'</span>\r\n              value<span class=\"token operator\">=</span><span class=\"token string\">'Yes'</span>\r\n              onChange<span class=\"token operator\">=</span><span class=\"token punctuation\">{</span><span class=\"token punctuation\">(</span><span class=\"token parameter\">e</span><span class=\"token punctuation\">)</span> <span class=\"token operator\">=></span> <span class=\"token function\">setPaid</span><span class=\"token punctuation\">(</span>e<span class=\"token punctuation\">.</span>target<span class=\"token punctuation\">.</span>value<span class=\"token punctuation\">)</span><span class=\"token punctuation\">}</span>\r\n            <span class=\"token operator\">/</span><span class=\"token operator\">></span>\r\n            <span class=\"token operator\">&lt;</span>label\r\n              htmlFor<span class=\"token operator\">=</span><span class=\"token string\">'Yes'</span>\r\n              className<span class=\"token operator\">=</span><span class=\"token string\">'ml-2 text-sm font-medium text-gray-900 dark:text-gray-300'</span>\r\n            <span class=\"token operator\">></span>\r\n              Yes\r\n            <span class=\"token operator\">&lt;</span><span class=\"token operator\">/</span>label<span class=\"token operator\">></span>\r\n          <span class=\"token operator\">&lt;</span><span class=\"token operator\">/</span>div<span class=\"token operator\">></span>\r\n          <span class=\"token operator\">&lt;</span>div className<span class=\"token operator\">=</span><span class=\"token string\">'flex items-center mb-4'</span><span class=\"token operator\">></span>\r\n            <span class=\"token operator\">&lt;</span>input\r\n              className<span class=\"token operator\">=</span><span class=\"token string\">'w-4 h-4 text-blue-600 bg-gray-100 border-gray-300 rounded focus:ring-blue-500 dark:focus:ring-blue-600 dark:ring-offset-gray-800 focus:ring-2 dark:bg-gray-700 dark:border-gray-600'</span>\r\n              checked<span class=\"token operator\">=</span><span class=\"token punctuation\">{</span>paid <span class=\"token operator\">===</span> <span class=\"token string\">'No'</span><span class=\"token punctuation\">}</span>\r\n              type<span class=\"token operator\">=</span><span class=\"token string\">'radio'</span>\r\n              name<span class=\"token operator\">=</span><span class=\"token string\">'paid'</span>\r\n              value<span class=\"token operator\">=</span><span class=\"token string\">'No'</span>\r\n              onChange<span class=\"token operator\">=</span><span class=\"token punctuation\">{</span><span class=\"token punctuation\">(</span><span class=\"token parameter\">e</span><span class=\"token punctuation\">)</span> <span class=\"token operator\">=></span> <span class=\"token function\">setPaid</span><span class=\"token punctuation\">(</span>e<span class=\"token punctuation\">.</span>target<span class=\"token punctuation\">.</span>value<span class=\"token punctuation\">)</span><span class=\"token punctuation\">}</span>\r\n            <span class=\"token operator\">/</span><span class=\"token operator\">></span>\r\n            <span class=\"token operator\">&lt;</span>label\r\n              htmlFor<span class=\"token operator\">=</span><span class=\"token string\">'No'</span>\r\n              className<span class=\"token operator\">=</span><span class=\"token string\">'ml-2 text-sm font-medium text-gray-900 dark:text-gray-300'</span>\r\n            <span class=\"token operator\">></span>\r\n              No\r\n            <span class=\"token operator\">&lt;</span><span class=\"token operator\">/</span>label<span class=\"token operator\">></span>\r\n          <span class=\"token operator\">&lt;</span><span class=\"token operator\">/</span>div<span class=\"token operator\">></span>\r\n        <span class=\"token operator\">&lt;</span><span class=\"token operator\">/</span>div<span class=\"token operator\">></span>\r\n        <span class=\"token operator\">&lt;</span>div className<span class=\"token operator\">=</span><span class=\"token string\">'mb-4'</span><span class=\"token operator\">></span>\r\n          <span class=\"token operator\">&lt;</span>label className<span class=\"token operator\">=</span><span class=\"token string\">'block text-gray-700 text-sm font-bold mb-2'</span><span class=\"token operator\">></span>\r\n            Price\r\n          <span class=\"token operator\">&lt;</span><span class=\"token operator\">/</span>label<span class=\"token operator\">></span>\r\n          <span class=\"token operator\">&lt;</span>input\r\n            className<span class=\"token operator\">=</span><span class=\"token string\">'shadow appearance-none border rounded w-full py-2 px-3 text-gray-700 mb-3 leading-tight focus:outline-none focus:shadow-outline'</span>\r\n            type<span class=\"token operator\">=</span><span class=\"token string\">'text'</span>\r\n            name<span class=\"token operator\">=</span><span class=\"token string\">'price'</span>\r\n            placeholder<span class=\"token operator\">=</span><span class=\"token string\">'How much is it?'</span>\r\n            ref<span class=\"token operator\">=</span><span class=\"token punctuation\">{</span>priceRef<span class=\"token punctuation\">}</span>\r\n          <span class=\"token operator\">/</span><span class=\"token operator\">></span>\r\n        <span class=\"token operator\">&lt;</span><span class=\"token operator\">/</span>div<span class=\"token operator\">></span>\r\n        <span class=\"token operator\">&lt;</span>div className<span class=\"token operator\">=</span><span class=\"token string\">'mb-4'</span><span class=\"token operator\">></span>\r\n          <span class=\"token operator\">&lt;</span>label className<span class=\"token operator\">=</span><span class=\"token string\">'block text-gray-700 text-sm font-bold mb-2'</span><span class=\"token operator\">></span>\r\n            Street no<span class=\"token punctuation\">.</span>\r\n          <span class=\"token operator\">&lt;</span><span class=\"token operator\">/</span>label<span class=\"token operator\">></span>\r\n          <span class=\"token operator\">&lt;</span>input\r\n            className<span class=\"token operator\">=</span><span class=\"token string\">'shadow appearance-none border rounded w-full py-2 px-3 text-gray-700 mb-3 leading-tight focus:outline-none focus:shadow-outline'</span>\r\n            type<span class=\"token operator\">=</span><span class=\"token string\">'text'</span>\r\n            name<span class=\"token operator\">=</span><span class=\"token string\">'streetNumber'</span>\r\n            ref<span class=\"token operator\">=</span><span class=\"token punctuation\">{</span>streetNumberRef<span class=\"token punctuation\">}</span>\r\n          <span class=\"token operator\">/</span><span class=\"token operator\">></span>\r\n        <span class=\"token operator\">&lt;</span><span class=\"token operator\">/</span>div<span class=\"token operator\">></span>\r\n        <span class=\"token operator\">&lt;</span>div className<span class=\"token operator\">=</span><span class=\"token string\">'mb-4'</span><span class=\"token operator\">></span>\r\n          <span class=\"token operator\">&lt;</span>label className<span class=\"token operator\">=</span><span class=\"token string\">'block text-gray-700 text-sm font-bold mb-2'</span><span class=\"token operator\">></span>\r\n            Street\r\n          <span class=\"token operator\">&lt;</span><span class=\"token operator\">/</span>label<span class=\"token operator\">></span>\r\n          <span class=\"token operator\">&lt;</span>input\r\n            className<span class=\"token operator\">=</span><span class=\"token string\">'shadow appearance-none border rounded w-full py-2 px-3 text-gray-700 mb-3 leading-tight focus:outline-none focus:shadow-outline'</span>\r\n            type<span class=\"token operator\">=</span><span class=\"token string\">'text'</span>\r\n            name<span class=\"token operator\">=</span><span class=\"token string\">'street'</span>\r\n            ref<span class=\"token operator\">=</span><span class=\"token punctuation\">{</span>streetRef<span class=\"token punctuation\">}</span>\r\n          <span class=\"token operator\">/</span><span class=\"token operator\">></span>\r\n        <span class=\"token operator\">&lt;</span><span class=\"token operator\">/</span>div<span class=\"token operator\">></span>\r\n        <span class=\"token operator\">&lt;</span>div className<span class=\"token operator\">=</span><span class=\"token string\">'mb-4'</span><span class=\"token operator\">></span>\r\n          <span class=\"token operator\">&lt;</span>label className<span class=\"token operator\">=</span><span class=\"token string\">'block text-gray-700 text-sm font-bold mb-2'</span><span class=\"token operator\">></span>\r\n            City\r\n          <span class=\"token operator\">&lt;</span><span class=\"token operator\">/</span>label<span class=\"token operator\">></span>\r\n          <span class=\"token operator\">&lt;</span>input\r\n            className<span class=\"token operator\">=</span><span class=\"token string\">'shadow appearance-none border rounded w-full py-2 px-3 text-gray-700 mb-3 leading-tight focus:outline-none focus:shadow-outline'</span>\r\n            type<span class=\"token operator\">=</span><span class=\"token string\">'text'</span>\r\n            name<span class=\"token operator\">=</span><span class=\"token string\">'city'</span>\r\n            ref<span class=\"token operator\">=</span><span class=\"token punctuation\">{</span>cityRef<span class=\"token punctuation\">}</span>\r\n          <span class=\"token operator\">/</span><span class=\"token operator\">></span>\r\n        <span class=\"token operator\">&lt;</span><span class=\"token operator\">/</span>div<span class=\"token operator\">></span>\r\n        <span class=\"token operator\">&lt;</span>div className<span class=\"token operator\">=</span><span class=\"token string\">'mb-4'</span><span class=\"token operator\">></span>\r\n          <span class=\"token operator\">&lt;</span>label className<span class=\"token operator\">=</span><span class=\"token string\">'block text-gray-700 text-sm font-bold mb-2'</span><span class=\"token operator\">></span>\r\n            Country\r\n          <span class=\"token operator\">&lt;</span><span class=\"token operator\">/</span>label<span class=\"token operator\">></span>\r\n          <span class=\"token operator\">&lt;</span>input\r\n            className<span class=\"token operator\">=</span><span class=\"token string\">'shadow appearance-none border rounded w-full py-2 px-3 text-gray-700 mb-3 leading-tight focus:outline-none focus:shadow-outline'</span>\r\n            type<span class=\"token operator\">=</span><span class=\"token string\">'text'</span>\r\n            name<span class=\"token operator\">=</span><span class=\"token string\">'country'</span>\r\n            ref<span class=\"token operator\">=</span><span class=\"token punctuation\">{</span>countryRef<span class=\"token punctuation\">}</span>\r\n          <span class=\"token operator\">/</span><span class=\"token operator\">></span>\r\n        <span class=\"token operator\">&lt;</span><span class=\"token operator\">/</span>div<span class=\"token operator\">></span>\r\n        <span class=\"token operator\">&lt;</span>div className<span class=\"token operator\">=</span><span class=\"token string\">'mb-4'</span><span class=\"token operator\">></span>\r\n          <span class=\"token operator\">&lt;</span>label className<span class=\"token operator\">=</span><span class=\"token string\">'block text-gray-700 text-sm font-bold mb-2'</span><span class=\"token operator\">></span>\r\n            Cleanliness\r\n          <span class=\"token operator\">&lt;</span><span class=\"token operator\">/</span>label<span class=\"token operator\">></span>\r\n          <span class=\"token operator\">&lt;</span>input\r\n            className<span class=\"token operator\">=</span><span class=\"token string\">'shadow appearance-none border rounded w-full py-2 px-3 text-gray-700 mb-3 leading-tight focus:outline-none focus:shadow-outline'</span>\r\n            type<span class=\"token operator\">=</span><span class=\"token string\">'number'</span>\r\n            step<span class=\"token operator\">=</span><span class=\"token punctuation\">{</span><span class=\"token number\">0.1</span><span class=\"token punctuation\">}</span>\r\n            name<span class=\"token operator\">=</span><span class=\"token string\">'cleanliness'</span>\r\n            placeholder<span class=\"token operator\">=</span><span class=\"token string\">'How clean is it?'</span>\r\n            ref<span class=\"token operator\">=</span><span class=\"token punctuation\">{</span>cleanlinessRef<span class=\"token punctuation\">}</span>\r\n          <span class=\"token operator\">/</span><span class=\"token operator\">></span>\r\n        <span class=\"token operator\">&lt;</span><span class=\"token operator\">/</span>div<span class=\"token operator\">></span>\r\n        <span class=\"token operator\">&lt;</span>div className<span class=\"token operator\">=</span><span class=\"token string\">'mb-4'</span><span class=\"token operator\">></span>\r\n          <span class=\"token operator\">&lt;</span>label className<span class=\"token operator\">=</span><span class=\"token string\">'block text-gray-700 text-sm font-bold mb-2'</span><span class=\"token operator\">></span>\r\n            Performance\r\n          <span class=\"token operator\">&lt;</span><span class=\"token operator\">/</span>label<span class=\"token operator\">></span>\r\n          <span class=\"token operator\">&lt;</span>input\r\n            className<span class=\"token operator\">=</span><span class=\"token string\">'shadow appearance-none border rounded w-full py-2 px-3 text-gray-700 mb-3 leading-tight focus:outline-none focus:shadow-outline'</span>\r\n            type<span class=\"token operator\">=</span><span class=\"token string\">'number'</span>\r\n            step<span class=\"token operator\">=</span><span class=\"token punctuation\">{</span><span class=\"token number\">0.1</span><span class=\"token punctuation\">}</span>\r\n            name<span class=\"token operator\">=</span><span class=\"token string\">'performance'</span>\r\n            placeholder<span class=\"token operator\">=</span><span class=\"token string\">'How well does it work?'</span>\r\n            ref<span class=\"token operator\">=</span><span class=\"token punctuation\">{</span>performanceRef<span class=\"token punctuation\">}</span>\r\n          <span class=\"token operator\">/</span><span class=\"token operator\">></span>\r\n        <span class=\"token operator\">&lt;</span><span class=\"token operator\">/</span>div<span class=\"token operator\">></span>\r\n        <span class=\"token operator\">&lt;</span>div className<span class=\"token operator\">=</span><span class=\"token string\">'mb-4'</span><span class=\"token operator\">></span>\r\n          <span class=\"token operator\">&lt;</span>label className<span class=\"token operator\">=</span><span class=\"token string\">'block text-gray-700 text-sm font-bold mb-2'</span><span class=\"token operator\">></span>\r\n            Description\r\n          <span class=\"token operator\">&lt;</span><span class=\"token operator\">/</span>label<span class=\"token operator\">></span>\r\n          <span class=\"token operator\">&lt;</span>textarea\r\n            className<span class=\"token operator\">=</span><span class=\"token string\">'resize-none shadow appearance-none border rounded w-full py-2 px-3 text-gray-700 mb-3 leading-tight focus:outline-none focus:shadow-outline'</span>\r\n            rows<span class=\"token operator\">=</span><span class=\"token punctuation\">{</span><span class=\"token number\">2</span><span class=\"token punctuation\">}</span>\r\n            name<span class=\"token operator\">=</span><span class=\"token string\">'description'</span>\r\n            placeholder<span class=\"token operator\">=</span><span class=\"token string\">'Write your experience in less than 500 characters'</span>\r\n            maxLength<span class=\"token operator\">=</span><span class=\"token punctuation\">{</span><span class=\"token number\">500</span><span class=\"token punctuation\">}</span>\r\n            ref<span class=\"token operator\">=</span><span class=\"token punctuation\">{</span>descriptionRef<span class=\"token punctuation\">}</span>\r\n          <span class=\"token operator\">/</span><span class=\"token operator\">></span>\r\n        <span class=\"token operator\">&lt;</span><span class=\"token operator\">/</span>div<span class=\"token operator\">></span>\r\n        <span class=\"token operator\">&lt;</span>div className<span class=\"token operator\">=</span><span class=\"token string\">'mb-4'</span><span class=\"token operator\">></span>\r\n          <span class=\"token operator\">&lt;</span>label className<span class=\"token operator\">=</span><span class=\"token string\">'block text-gray-700 text-sm font-bold mb-2'</span><span class=\"token operator\">></span>\r\n            Email\r\n          <span class=\"token operator\">&lt;</span><span class=\"token operator\">/</span>label<span class=\"token operator\">></span>\r\n          <span class=\"token operator\">&lt;</span>input\r\n            className<span class=\"token operator\">=</span><span class=\"token string\">'shadow appearance-none border rounded w-full py-2 px-3 text-gray-700 mb-3 leading-tight focus:outline-none focus:shadow-outline'</span>\r\n            type<span class=\"token operator\">=</span><span class=\"token string\">'email'</span>\r\n            name<span class=\"token operator\">=</span><span class=\"token string\">'email'</span>\r\n            ref<span class=\"token operator\">=</span><span class=\"token punctuation\">{</span>emailRef<span class=\"token punctuation\">}</span>\r\n          <span class=\"token operator\">/</span><span class=\"token operator\">></span>\r\n        <span class=\"token operator\">&lt;</span><span class=\"token operator\">/</span>div<span class=\"token operator\">></span>\r\n        <span class=\"token operator\">&lt;</span>div className<span class=\"token operator\">=</span><span class=\"token string\">'mb-4'</span><span class=\"token operator\">></span>\r\n          <span class=\"token operator\">&lt;</span>label className<span class=\"token operator\">=</span><span class=\"token string\">'block text-gray-700 text-sm font-bold mb-2'</span><span class=\"token operator\">></span>\r\n            Password\r\n          <span class=\"token operator\">&lt;</span><span class=\"token operator\">/</span>label<span class=\"token operator\">></span>\r\n          <span class=\"token operator\">&lt;</span>input\r\n            className<span class=\"token operator\">=</span><span class=\"token string\">'shadow appearance-none border rounded w-full py-2 px-3 text-gray-700 mb-3 leading-tight focus:outline-none focus:shadow-outline'</span>\r\n            type<span class=\"token operator\">=</span><span class=\"token string\">'password'</span>\r\n            name<span class=\"token operator\">=</span><span class=\"token string\">'password'</span>\r\n            ref<span class=\"token operator\">=</span><span class=\"token punctuation\">{</span>passwordRef<span class=\"token punctuation\">}</span>\r\n          <span class=\"token operator\">/</span><span class=\"token operator\">></span>\r\n        <span class=\"token operator\">&lt;</span><span class=\"token operator\">/</span>div<span class=\"token operator\">></span>\r\n        <span class=\"token operator\">&lt;</span>div className<span class=\"token operator\">=</span><span class=\"token string\">'flex items-center justify-between'</span><span class=\"token operator\">></span>\r\n          <span class=\"token operator\">&lt;</span>button\r\n            className<span class=\"token operator\">=</span><span class=\"token string\">'bg-blue-500 hover:bg-blue-700 text-white font-bold py-2 px-4 rounded focus:outline-none focus:shadow-outline'</span>\r\n            type<span class=\"token operator\">=</span><span class=\"token string\">'submit'</span>\r\n          <span class=\"token operator\">></span>\r\n            Submit\r\n          <span class=\"token operator\">&lt;</span><span class=\"token operator\">/</span>button<span class=\"token operator\">></span>\r\n        <span class=\"token operator\">&lt;</span><span class=\"token operator\">/</span>div<span class=\"token operator\">></span>\r\n      <span class=\"token operator\">&lt;</span><span class=\"token operator\">/</span>form<span class=\"token operator\">></span>\r\n    <span class=\"token operator\">&lt;</span><span class=\"token operator\">/</span>main<span class=\"token operator\">></span>\r\n  <span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\r\n<span class=\"token punctuation\">}</span></code></pre></div>\n<p>어플리케이션을 개발 환경에서 동작시키고 브라우저에서 <code class=\"language-text\">http://localhost:4000/contribute</code>를 입력하면 다음과 같은 화면이 보일 것입니다.</p>\n<p><span\n      class=\"gatsby-resp-image-wrapper\"\n      style=\"position: relative; display: block; margin-left: auto; margin-right: auto; max-width: 630px; \"\n    >\n      <a\n    class=\"gatsby-resp-image-link\"\n    href=\"/static/d29d17b7ff73265b611f10ec2f45b0ea/ddc81/create-form-2.png\"\n    style=\"display: block\"\n    target=\"_blank\"\n    rel=\"noopener\"\n  >\n    <span\n    class=\"gatsby-resp-image-background-image\"\n    style=\"padding-bottom: 95.56962025316456%; position: relative; bottom: 0; left: 0; background-image: url('data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABQAAAATCAYAAACQjC21AAAACXBIWXMAABYlAAAWJQFJUiTwAAABtUlEQVR42qWUy47UMBBF/cEs+BvYIsFnwAaJHR/ABiSEhu52Ho5jx+9cdCsT1LNgRgmWSt1pd07VcVWiLlojxIhlCdDdAGMsWms4umKMuHYd1FV3f4GXq4buRqSUUWvDuuLFKKWitRUxJVx1D3XrewGu6yqglIrAQ4hS6XPBe0JIKLkg5YzbMEDpvhc6IdNkYe0sWQ8rp4SOwG4Yhe6cF+Xflxtm50U5l/Ki+q5MRj8aqN4Yoe/KORc4v8D7IEm2veeUo9zD5IMxUMNoBMQuzbOD817+eHTlnDGaCWqcJqHb2eHnrwc8XDRiyqKSS5XPfwVV9+RkGGuhJmvFn5vsWE5ZNDy12W2OVNjGaosov/P7vQmBZClWRqCsE6r7Ko+WanbusZtVDpdZGfcH/7QZT/f2KgkkS83zNiI8UD56/1Mhp0L5xcvFnu1cAKUWkKV4wFvHmmgzjgKlwlqlWWoJQWBmsjI2VD+zWAhZimPBC0Kpfn/YR4IMslSMadOUslfUdu4M2ViyVEgJQMOHLwWv3ye8ehfx9cf2tmkHxpJmKScovv8I/Pyt4e2ngjcfM77f1lNAzvEftQTUtopAMM0AAAAASUVORK5CYII='); background-size: cover; display: block;\"\n  ></span>\n  <img\n        class=\"gatsby-resp-image-image\"\n        alt=\"create-form-2.png\"\n        title=\"\"\n        src=\"/static/d29d17b7ff73265b611f10ec2f45b0ea/f058b/create-form-2.png\"\n        srcset=\"/static/d29d17b7ff73265b611f10ec2f45b0ea/c26ae/create-form-2.png 158w,\n/static/d29d17b7ff73265b611f10ec2f45b0ea/6bdcf/create-form-2.png 315w,\n/static/d29d17b7ff73265b611f10ec2f45b0ea/f058b/create-form-2.png 630w,\n/static/d29d17b7ff73265b611f10ec2f45b0ea/ddc81/create-form-2.png 837w\"\n        sizes=\"(max-width: 630px) 100vw, 630px\"\n        style=\"width:100%;height:100%;margin:0;vertical-align:middle;position:absolute;top:0;left:0;\"\n        loading=\"lazy\"\n        decoding=\"async\"\n      />\n  </a>\n    </span></p>\n<h2>Graphql mutation query 요청</h2>\n<p>직전에 만든 컴포넌트에서 <strong>Submit</strong> 버튼을 누를 때 <code class=\"language-text\">create</code> 함수를 호출하는 form을 볼 수 있습니다. 이 함수가 form에서 받은 데이터들이 처리되고 우리가 graphql 쿼리를 만드는 곳입니다.</p>\n<p>이를 위해 <code class=\"language-text\">contribute</code> 폴더 하위에 <code class=\"language-text\">action.ts</code>라는 이름의 파일을 만듭니다.</p>\n<div class=\"gatsby-highlight\" data-language=\"text\"><pre class=\"language-text\"><code class=\"language-text\">src/app\r\n└── contribute\r\n    ├── action.ts\r\n    └── page.tsx</code></pre></div>\n<p><code class=\"language-text\">action.ts</code> 파일에 다음의 코드를 작성합니다.</p>\n<div class=\"gatsby-highlight\" data-language=\"js\"><pre class=\"language-js\"><code class=\"language-js\"><span class=\"token string\">'use server'</span><span class=\"token punctuation\">;</span>\r\n<span class=\"token keyword\">import</span> <span class=\"token punctuation\">{</span> redirect <span class=\"token punctuation\">}</span> <span class=\"token keyword\">from</span> <span class=\"token string\">'next/navigation'</span><span class=\"token punctuation\">;</span>\r\n\r\n<span class=\"token keyword\">export</span> <span class=\"token keyword\">default</span> <span class=\"token keyword\">async</span> <span class=\"token keyword\">function</span> <span class=\"token function\">create</span><span class=\"token punctuation\">(</span><span class=\"token parameter\"><span class=\"token literal-property property\">formData</span><span class=\"token operator\">:</span> FormData</span><span class=\"token punctuation\">)</span> <span class=\"token punctuation\">{</span>\r\n  <span class=\"token keyword\">const</span> isPaid <span class=\"token operator\">=</span> formData<span class=\"token punctuation\">.</span><span class=\"token function\">get</span><span class=\"token punctuation\">(</span><span class=\"token string\">'paid'</span><span class=\"token punctuation\">)</span> <span class=\"token operator\">===</span> <span class=\"token string\">'Yes'</span> <span class=\"token operator\">?</span> <span class=\"token boolean\">true</span> <span class=\"token operator\">:</span> <span class=\"token boolean\">false</span><span class=\"token punctuation\">;</span>\r\n  <span class=\"token keyword\">const</span> price <span class=\"token operator\">=</span> <span class=\"token function\">parseInt</span><span class=\"token punctuation\">(</span>formData<span class=\"token punctuation\">.</span><span class=\"token function\">get</span><span class=\"token punctuation\">(</span><span class=\"token string\">'price'</span><span class=\"token punctuation\">)</span> <span class=\"token keyword\">as</span> string<span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\r\n  <span class=\"token keyword\">const</span> streetNumber <span class=\"token operator\">=</span> formData<span class=\"token punctuation\">.</span><span class=\"token function\">get</span><span class=\"token punctuation\">(</span><span class=\"token string\">'streetNumber'</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\r\n  <span class=\"token keyword\">const</span> street <span class=\"token operator\">=</span> formData<span class=\"token punctuation\">.</span><span class=\"token function\">get</span><span class=\"token punctuation\">(</span><span class=\"token string\">'street'</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\r\n  <span class=\"token keyword\">const</span> city <span class=\"token operator\">=</span> formData<span class=\"token punctuation\">.</span><span class=\"token function\">get</span><span class=\"token punctuation\">(</span><span class=\"token string\">'city'</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\r\n  <span class=\"token keyword\">const</span> country <span class=\"token operator\">=</span> formData<span class=\"token punctuation\">.</span><span class=\"token function\">get</span><span class=\"token punctuation\">(</span><span class=\"token string\">'country'</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\r\n  <span class=\"token keyword\">const</span> email <span class=\"token operator\">=</span> formData<span class=\"token punctuation\">.</span><span class=\"token function\">get</span><span class=\"token punctuation\">(</span><span class=\"token string\">'email'</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\r\n  <span class=\"token keyword\">const</span> password <span class=\"token operator\">=</span> formData<span class=\"token punctuation\">.</span><span class=\"token function\">get</span><span class=\"token punctuation\">(</span><span class=\"token string\">'password'</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\r\n  <span class=\"token keyword\">const</span> cleanliness <span class=\"token operator\">=</span> <span class=\"token function\">parseFloat</span><span class=\"token punctuation\">(</span>formData<span class=\"token punctuation\">.</span><span class=\"token function\">get</span><span class=\"token punctuation\">(</span><span class=\"token string\">'cleanliness'</span><span class=\"token punctuation\">)</span> <span class=\"token keyword\">as</span> string<span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\r\n  <span class=\"token keyword\">const</span> performance <span class=\"token operator\">=</span> <span class=\"token function\">parseFloat</span><span class=\"token punctuation\">(</span>formData<span class=\"token punctuation\">.</span><span class=\"token function\">get</span><span class=\"token punctuation\">(</span><span class=\"token string\">'performance'</span><span class=\"token punctuation\">)</span> <span class=\"token keyword\">as</span> string<span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\r\n  <span class=\"token keyword\">const</span> description <span class=\"token operator\">=</span> formData<span class=\"token punctuation\">.</span><span class=\"token function\">get</span><span class=\"token punctuation\">(</span><span class=\"token string\">'description'</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\r\n\r\n  <span class=\"token keyword\">const</span> apiUrl <span class=\"token operator\">=</span> <span class=\"token string\">'http://localhost:4000/graphql'</span><span class=\"token punctuation\">;</span>\r\n  <span class=\"token keyword\">const</span> response <span class=\"token operator\">=</span> <span class=\"token keyword\">await</span> <span class=\"token function\">fetch</span><span class=\"token punctuation\">(</span>apiUrl<span class=\"token punctuation\">,</span> <span class=\"token punctuation\">{</span>\r\n    <span class=\"token literal-property property\">method</span><span class=\"token operator\">:</span> <span class=\"token string\">'POST'</span><span class=\"token punctuation\">,</span>\r\n    <span class=\"token literal-property property\">headers</span><span class=\"token operator\">:</span> <span class=\"token punctuation\">{</span> <span class=\"token string-property property\">'Content-Type'</span><span class=\"token operator\">:</span> <span class=\"token string\">'application/json'</span> <span class=\"token punctuation\">}</span><span class=\"token punctuation\">,</span>\r\n    <span class=\"token literal-property property\">body</span><span class=\"token operator\">:</span> <span class=\"token constant\">JSON</span><span class=\"token punctuation\">.</span><span class=\"token function\">stringify</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">{</span>\r\n      <span class=\"token literal-property property\">query</span><span class=\"token operator\">:</span> <span class=\"token template-string\"><span class=\"token template-punctuation string\">`</span><span class=\"token string\">mutation { createToilet(createToiletData: {\r\n          isPaid: </span><span class=\"token interpolation\"><span class=\"token interpolation-punctuation punctuation\">${</span>isPaid<span class=\"token interpolation-punctuation punctuation\">}</span></span><span class=\"token string\">\r\n          price: </span><span class=\"token interpolation\"><span class=\"token interpolation-punctuation punctuation\">${</span>price<span class=\"token interpolation-punctuation punctuation\">}</span></span><span class=\"token string\">\r\n          address: {\r\n            streetNumber: \"</span><span class=\"token interpolation\"><span class=\"token interpolation-punctuation punctuation\">${</span>streetNumber<span class=\"token interpolation-punctuation punctuation\">}</span></span><span class=\"token string\">\"\r\n            street: \"</span><span class=\"token interpolation\"><span class=\"token interpolation-punctuation punctuation\">${</span>street<span class=\"token interpolation-punctuation punctuation\">}</span></span><span class=\"token string\">\"\r\n            city: \"</span><span class=\"token interpolation\"><span class=\"token interpolation-punctuation punctuation\">${</span>city<span class=\"token interpolation-punctuation punctuation\">}</span></span><span class=\"token string\">\"\r\n            country: \"</span><span class=\"token interpolation\"><span class=\"token interpolation-punctuation punctuation\">${</span>country<span class=\"token interpolation-punctuation punctuation\">}</span></span><span class=\"token string\">\"\r\n          }\r\n          reviews: {\r\n            contributedBy: \"</span><span class=\"token interpolation\"><span class=\"token interpolation-punctuation punctuation\">${</span>email<span class=\"token interpolation-punctuation punctuation\">}</span></span><span class=\"token string\">\"\r\n            password: \"</span><span class=\"token interpolation\"><span class=\"token interpolation-punctuation punctuation\">${</span>password<span class=\"token interpolation-punctuation punctuation\">}</span></span><span class=\"token string\">\"\r\n            cleanliness: </span><span class=\"token interpolation\"><span class=\"token interpolation-punctuation punctuation\">${</span>cleanliness<span class=\"token interpolation-punctuation punctuation\">}</span></span><span class=\"token string\">\r\n            performance: </span><span class=\"token interpolation\"><span class=\"token interpolation-punctuation punctuation\">${</span>performance<span class=\"token interpolation-punctuation punctuation\">}</span></span><span class=\"token string\">\r\n            description: \"</span><span class=\"token interpolation\"><span class=\"token interpolation-punctuation punctuation\">${</span>description<span class=\"token interpolation-punctuation punctuation\">}</span></span><span class=\"token string\">\"\r\n          }\r\n        }) {\r\n          id\r\n          isPaid\r\n          price\r\n          address {\r\n            street\r\n            city\r\n            country\r\n          }\r\n        }\r\n      }</span><span class=\"token template-punctuation string\">`</span></span><span class=\"token punctuation\">,</span>\r\n    <span class=\"token punctuation\">}</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">,</span>\r\n  <span class=\"token punctuation\">}</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\r\n\r\n  <span class=\"token keyword\">const</span> data <span class=\"token operator\">=</span> <span class=\"token keyword\">await</span> response<span class=\"token punctuation\">.</span><span class=\"token function\">json</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\r\n  console<span class=\"token punctuation\">.</span><span class=\"token function\">log</span><span class=\"token punctuation\">(</span>data<span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\r\n  <span class=\"token function\">redirect</span><span class=\"token punctuation\">(</span><span class=\"token string\">'/'</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\r\n<span class=\"token punctuation\">}</span></code></pre></div>\n<p>간략하게 설명하자면 이 <code class=\"language-text\">create</code> 함수가 <code class=\"language-text\">Contribute</code> 컴포넌트로부터 form 데이터를 받고 이를 사용하여 graphql mutation 쿼리를 만듭니다. 이 mutation 쿼리는 body 안에 포함됩니다. 이 쿼리가 서버에 전달이 되면 응답을 기다리고 콘솔에 로그를 생성합니다. 마지막으로 root 라우트로 리다이렉트가 됩니다.</p>\n<p>이제 화장실을 등록하기 위해 먼저 백엔드 서버를 알맞은 포트에 동작시킵니다.</p>\n<p><code class=\"language-text\">/contribute</code>로 이동하고 form에 있는 모든 필드값을 채운 뒤 <strong>Submit</strong> 버튼을 누르면 터미널에서 다음과 같은 로그를 볼 수 있어야 합니다.</p>\n<p><span\n      class=\"gatsby-resp-image-wrapper\"\n      style=\"position: relative; display: block; margin-left: auto; margin-right: auto; max-width: 568px; \"\n    >\n      <a\n    class=\"gatsby-resp-image-link\"\n    href=\"/static/546db917d9662ae01f6c4a7c350f9e34/10e91/create-response.png\"\n    style=\"display: block\"\n    target=\"_blank\"\n    rel=\"noopener\"\n  >\n    <span\n    class=\"gatsby-resp-image-background-image\"\n    style=\"padding-bottom: 42.405063291139236%; position: relative; bottom: 0; left: 0; background-image: url('data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABQAAAAICAYAAAD5nd/tAAAACXBIWXMAABYlAAAWJQFJUiTwAAABH0lEQVR42o1SXXOCMBD0PwBJsCQKTMSg5TMgaAt98a3+/5+zndyoQ/tSH3b2kks2d3tZbeMtjNkjTmJEUQTOORhjxEIIhGH4Mtz5leAcZVVjmib0nUVRFDjkOdIkoQecuO/7CIKA8IgdL+MgYHdBIeB5Ho6HI6y1eC8KXK9XfM0z2ralvaZpYDvHNcZxILZdh4/LmXKXyxl1VSIMBVauVNdemqYYzyNOfY/c5JinT+yzjFpxlUopCUopyMjF6hmrzYZy7iwJsoBB7zSmaUZVliirCrfbN7TWkDLCer2m1pb+Ol7i4Tm17Hw0xqCzHdqmoWozk2EYBjR1BaXk88J/IMEkdhN+g3c3+VGBv1i/IkaCO63JC8b5r/H//Q6vCv4AOP7aKOXIOfQAAAAASUVORK5CYII='); background-size: cover; display: block;\"\n  ></span>\n  <img\n        class=\"gatsby-resp-image-image\"\n        alt=\"create-response.png\"\n        title=\"\"\n        src=\"/static/546db917d9662ae01f6c4a7c350f9e34/10e91/create-response.png\"\n        srcset=\"/static/546db917d9662ae01f6c4a7c350f9e34/c26ae/create-response.png 158w,\n/static/546db917d9662ae01f6c4a7c350f9e34/6bdcf/create-response.png 315w,\n/static/546db917d9662ae01f6c4a7c350f9e34/10e91/create-response.png 568w\"\n        sizes=\"(max-width: 568px) 100vw, 568px\"\n        style=\"width:100%;height:100%;margin:0;vertical-align:middle;position:absolute;top:0;left:0;\"\n        loading=\"lazy\"\n        decoding=\"async\"\n      />\n  </a>\n    </span></p>\n<p>로그 이외에도 <code class=\"language-text\">/toilets</code> 라우트를 사용하면 화장실이 등록이 되었는지 아닌지 여부를 확인할 수 있을 것입니다.</p>\n<p><em><strong>읽어 주셔서 감사합니다. To be continued!</strong></em></p>\n<h3>참조</h3>\n<ul>\n<li><a href=\"https://nextjs.org/docs/pages/building-your-application/data-fetching/forms-and-mutations\">https://nextjs.org/docs/pages/building-your-application/data-fetching/forms-and-mutations</a></li>\n</ul>","frontmatter":{"title":"#11 Nextjs App router로 Graphql mutation 쿼리 요청하기","date":"2023년 09월 20일","description":"","tag":["Project","React"]},"fields":{"locale":"ko"}},"previous":{"fields":{"slug":"/nextjs-기본-설정-및-graphql-요청"},"frontmatter":{"title":"#10 Nextjs 기본 설정 및 GraphQL 요청"}},"next":{"fields":{"slug":"/nextjs-app-router-사용시-데이터-수정하기"},"frontmatter":{"title":"#12 Nextjs App router 사용시 데이터 수정하기"}}},"pageContext":{"locale":"ko","isDefaultLang":true,"slug":"/nextjs-app-router로-graphql-mutation-쿼리-요청하기","titleByLang":{"ko":"nextjs-app-router로-graphql-mutation-쿼리-요청하기","en":"nextjs-graphql-mutation-query-using-app-router"},"dateFormat":"YYYY년 MM월 DD일","id":"5132b814-4df3-5db4-b0a5-0188fca52df6","previousPostId":"ab8314cc-903f-57ea-859b-6035796275ce","nextPostId":"61270607-b1d2-5be2-a9f9-0ada74289969"}},"staticQueryHashes":[],"slicesMap":{}}