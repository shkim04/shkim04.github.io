{"componentChunkName":"component---src-templates-blog-post-js","path":"/pnpm으로-dockerfile에서-multi-stage-빌드하기/","result":{"data":{"site":{"siteMetadata":{"title":"Seunghyun's Blog"}},"markdownRemark":{"id":"af72a085-a5b0-5c13-9dd0-016f5c136636","excerpt":"프로젝트를 시작할 때 평소와 같이 패키지 매니저로 npm을 선택했습니다. 그런데 pnpm이 어떨지 궁금하여 pnpm으로 바꾸고 이 프로젝트에 적용해보았습니다 - 이 주제에 관해서는 더 알아봐야 겠지만 어플리케이션에 잠재적인 위험을 야기할 수 있다고 생각합니다. npm…","html":"<p>프로젝트를 시작할 때 평소와 같이 패키지 매니저로 <strong>npm</strong>을 선택했습니다. 그런데 <strong>pnpm</strong>이 어떨지 궁금하여 <strong>pnpm</strong>으로 바꾸고 이 프로젝트에 적용해보았습니다 - <em>이 주제에 관해서는 더 알아봐야 겠지만 어플리케이션에 잠재적인 위험을 야기할 수 있다고 생각합니다.</em></p>\n<p><strong>npm</strong>으로 작성되었던 <strong>Docker</strong> 스크립트를 바꿔야 했습니다. 적용한 Dockerfile에 대해 설명해보려고 합니다.</p>\n<blockquote>\n<p>이전 글을 읽지 않고 이 글을 읽으신 분들은 <a href=\"https://github.com/shkim04/find-your-wc\">여기</a>에서 백엔드의 전체 코드를 확인하실 수 있습니다.</p>\n</blockquote>\n<h2>Development 단계</h2>\n<p><span\n      class=\"gatsby-resp-image-wrapper\"\n      style=\"position: relative; display: block; margin-left: auto; margin-right: auto; max-width: 630px; \"\n    >\n      <a\n    class=\"gatsby-resp-image-link\"\n    href=\"/static/0a4c667333bada5394731421fa2357fd/c1c45/development-stage.png\"\n    style=\"display: block\"\n    target=\"_blank\"\n    rel=\"noopener\"\n  >\n    <span\n    class=\"gatsby-resp-image-background-image\"\n    style=\"padding-bottom: 61.39240506329114%; position: relative; bottom: 0; left: 0; background-image: url('data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABQAAAAMCAYAAABiDJ37AAAACXBIWXMAABYlAAAWJQFJUiTwAAABhUlEQVR42pWS25LiIBRF/Q8N4U6AQCSJjrZW25enmf//nz3FwenybfRh1c5DWHX2gY2fDGKxiLNDqLk4DKOGtgJmkOCSo2c9+v45NmE2GFeLcbGU+ThgSFUo70KBvucPh+7f/CH/UYVOW2hroIKDMRayCrQEUwKM9+i2W3S7HcG6rsFq7sAYQ7fbout2BAlP6YT5/I54vaAcr1gvn8i3G9bff1A+vhDLEePyC2G/wAwRflpgQ80Zxkekwxt8nhHKEUJIbKy2sMpCCgUzBDoY8gznx0ZMxBATlLEQUoFLCaE0fStqpSG1aRPOcUHxBT5kDKk0cqEKtV7LO7UqY+gZe8juBxJ64yE4h4kJPk3wubQK+wPifCB5KCvcmMGF/P8tJ5cRaQcHqquMAReC6gilSEI1n5CRsO5PGwdtB0JICc75z43Sj7Xes+/wlM/IecV0vmG5fqO83VAun5hO71D3Rb/CxmmHIWR6AnVCpS1NaX1swhemI2F2CTHuafmtYhO0B8xenvAv8y9VZPE2IJ0AAAAASUVORK5CYII='); background-size: cover; display: block;\"\n  ></span>\n  <img\n        class=\"gatsby-resp-image-image\"\n        alt=\"development-stage\"\n        title=\"\"\n        src=\"/static/0a4c667333bada5394731421fa2357fd/f058b/development-stage.png\"\n        srcset=\"/static/0a4c667333bada5394731421fa2357fd/c26ae/development-stage.png 158w,\n/static/0a4c667333bada5394731421fa2357fd/6bdcf/development-stage.png 315w,\n/static/0a4c667333bada5394731421fa2357fd/f058b/development-stage.png 630w,\n/static/0a4c667333bada5394731421fa2357fd/c1c45/development-stage.png 824w\"\n        sizes=\"(max-width: 630px) 100vw, 630px\"\n        style=\"width:100%;height:100%;margin:0;vertical-align:middle;position:absolute;top:0;left:0;\"\n        loading=\"lazy\"\n        decoding=\"async\"\n      />\n  </a>\n    </span></p>\n<p><code class=\"language-text\">RUN curl -f https://get.pnpm.io/v6.16.js | node - add --global pnpm</code>을 입력하여 <code class=\"language-text\">pnpm</code>를 설치합니다.</p>\n<p>패키지를 가져올 때 <strong>install</strong> 대신에 <strong>fetch</strong>이 사용되는 것을 볼 수 있고 이 명령어는 오직 <code class=\"language-text\">pnpm-lock.yaml</code>만 필요합니다 - <em><code class=\"language-text\">pnpm fetch</code>이 <code class=\"language-text\">npm</code>을 사용하여 스크립트를 작성할 떄 <code class=\"language-text\">npm ci</code>와 동일한 역할을 한다고 판단됩니다.</em></p>\n<p><strong>pnpm</strong> 공식 문서에 따르면 <code class=\"language-text\">pnpm fetch</code>와 <code class=\"language-text\">pnpm install --offline</code>를 사용하면 많은 시간을 아낄 수 있다고 나옵니다.</p>\n<h2>Build 단계</h2>\n<p><span\n      class=\"gatsby-resp-image-wrapper\"\n      style=\"position: relative; display: block; margin-left: auto; margin-right: auto; max-width: 630px; \"\n    >\n      <a\n    class=\"gatsby-resp-image-link\"\n    href=\"/static/7896d69dd312f8bc509f328c9a19b74a/fbf08/build-stage.png\"\n    style=\"display: block\"\n    target=\"_blank\"\n    rel=\"noopener\"\n  >\n    <span\n    class=\"gatsby-resp-image-background-image\"\n    style=\"padding-bottom: 63.92405063291139%; position: relative; bottom: 0; left: 0; background-image: url('data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABQAAAANCAYAAACpUE5eAAAACXBIWXMAABYlAAAWJQFJUiTwAAABnklEQVR42p1T7Y6bMBDkQQLGxN822AECXK7JNY2aqmrV93+bqVi43OVOqpT+GK0/0HhndshMI2GTgo0SLikoL1CWJRhj/4UsDBpxNGgGjfTsEDqFSnAwVhLxjXyun9aveEdopIGwGtJ5bKsKXAnkRY58s0GeL7Uoig/IUeQriuKesAs93DDBt3v0hzPi8Sva4xlpOqHZH5CeTrD1DjpEgnI1TJ0QuhG26SC0pQduhMkmeOUhjKcPbZ3AeUUoOX+H+z2vtuBV9cnvzAgDKTWUC5DWUQdCGVRy9lJBaEMEBWOLvFfJa2XrGWNLzQ7xCT4NmK5/MJyv2F9+of1yQXf6jvHbT/QvP1B3E6QNpMDv9nC7Hr4dENqRJLvUI3QTXOyQJROhbEAcj2j6EfX+Gdo3JGkr1Wr6PFV2m/oCTmB3+xKZVY4IyHBfw8YWZl5bv/rzWCazQ3vEcPmN/uW6TC52JI0IOX882Ea5t65cgAkJW6WR55u3ID/0p5hZZk9Zm0mF0pTJuUPb7Cga7EN4/02oAmxIqISg5NPFLR7Fwx3+BabcdC8NR6xRAAAAAElFTkSuQmCC'); background-size: cover; display: block;\"\n  ></span>\n  <img\n        class=\"gatsby-resp-image-image\"\n        alt=\"build-stage\"\n        title=\"\"\n        src=\"/static/7896d69dd312f8bc509f328c9a19b74a/f058b/build-stage.png\"\n        srcset=\"/static/7896d69dd312f8bc509f328c9a19b74a/c26ae/build-stage.png 158w,\n/static/7896d69dd312f8bc509f328c9a19b74a/6bdcf/build-stage.png 315w,\n/static/7896d69dd312f8bc509f328c9a19b74a/f058b/build-stage.png 630w,\n/static/7896d69dd312f8bc509f328c9a19b74a/40601/build-stage.png 945w,\n/static/7896d69dd312f8bc509f328c9a19b74a/fbf08/build-stage.png 962w\"\n        sizes=\"(max-width: 630px) 100vw, 630px\"\n        style=\"width:100%;height:100%;margin:0;vertical-align:middle;position:absolute;top:0;left:0;\"\n        loading=\"lazy\"\n        decoding=\"async\"\n      />\n  </a>\n    </span></p>\n<p>이제 development 단계에서 생성한 <code class=\"language-text\">node_modules</code> 폴더를 복사할 수 있습니다. 그리고 어플리케이션 구동할 떄 필요한 정보가 담긴 <strong>.env</strong> 파일도 복사했습니다.</p>\n<p><strong>Prisma</strong>를 사용한다면 이 단계에서 migration하는 명령어를 적어줘야 합니다. 마지막으로 빌드를 마친 후 패키지를 설치할 때 <code class=\"language-text\">--prod</code> 플래그를 사용하면 배포에 필요한 패키지만 설치가 됩니다.</p>\n<h2>Production 단계</h2>\n<p><span\n      class=\"gatsby-resp-image-wrapper\"\n      style=\"position: relative; display: block; margin-left: auto; margin-right: auto; max-width: 630px; \"\n    >\n      <a\n    class=\"gatsby-resp-image-link\"\n    href=\"/static/e9556e83e36c69f590156c7e5046ceae/e4374/production-stage.png\"\n    style=\"display: block\"\n    target=\"_blank\"\n    rel=\"noopener\"\n  >\n    <span\n    class=\"gatsby-resp-image-background-image\"\n    style=\"padding-bottom: 34.177215189873415%; position: relative; bottom: 0; left: 0; background-image: url('data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABQAAAAHCAYAAAAIy204AAAACXBIWXMAABYlAAAWJQFJUiTwAAABFklEQVR42p3RyY6cMBCAYR6ksXF5K2PA0Et6ehapNe//Tv9oIIkU5ZQcPqkutXc6R8Yt7XRJ5Bqw1v63rl4S60Np98y4BVIVjDWY/mDNPxbMIRE04zURy0hURZzgYsClwCAOa8zBHow5WPMr7n8ydHOaKeuKbmdqu1LXGzmPpHUhn1dEM4NzOPE4EZz3SIi7QQTxER8zPmWcE7qmjRgL9fLKfHtQb6/ocibXxvbyZPnxRj3fqJcX2v2D7f2T+fpge3uicyOWiXG9MrYrPia6KVdSirS2Mk4zy9KY6oSqMk4TIZe9e0hK1EoqE+IDPuk+telPmL4/fK9cYib6AQ2CHyzFO0oQshe8O/2R0J9OO/v7buavp3wB85HID8nMkMoAAAAASUVORK5CYII='); background-size: cover; display: block;\"\n  ></span>\n  <img\n        class=\"gatsby-resp-image-image\"\n        alt=\"production-stage\"\n        title=\"\"\n        src=\"/static/e9556e83e36c69f590156c7e5046ceae/f058b/production-stage.png\"\n        srcset=\"/static/e9556e83e36c69f590156c7e5046ceae/c26ae/production-stage.png 158w,\n/static/e9556e83e36c69f590156c7e5046ceae/6bdcf/production-stage.png 315w,\n/static/e9556e83e36c69f590156c7e5046ceae/f058b/production-stage.png 630w,\n/static/e9556e83e36c69f590156c7e5046ceae/e4374/production-stage.png 927w\"\n        sizes=\"(max-width: 630px) 100vw, 630px\"\n        style=\"width:100%;height:100%;margin:0;vertical-align:middle;position:absolute;top:0;left:0;\"\n        loading=\"lazy\"\n        decoding=\"async\"\n      />\n  </a>\n    </span></p>\n<p>production 단계에서는 간단하게 build 단계에서 생성한 <code class=\"language-text\">node_modules</code>과 <code class=\"language-text\">dist</code> 폴더를 복사합니다.</p>\n<p>이미지를 생성하기 위해 명령어 <code class=\"language-text\">docker build -t [image-name-you-want-give] -f Dockerfile .</code>를 입력하게 되면 해당 이미지가 생성이 될 것이고 빠르고 저용량으로 만들어지는 것을 확인할 수 있습니다 - <em>multi-stage 빌드를 적용하지 않고 이미지를 생성해보면 알 수 있습니다.</em></p>\n<p><em><strong>읽어 주셔서 감사합니다. To be continued!</strong></em></p>\n<h3>참조</h3>\n<ul>\n<li><a href=\"https://pnpm.io/cli/fetch\">https://pnpm.io/cli/fetch</a></li>\n</ul>","frontmatter":{"title":"#15 pnpm으로 Dockefile에서 multi-stage 빌드하기","date":"2023년 11월 03일","description":"","tag":["Project"]},"fields":{"locale":"ko"}},"previous":{"fields":{"slug":"/nextjs-어플리케이션에-집계-데이터-보여주기"},"frontmatter":{"title":"#14 Nestjs 어플리케이션에 집계 데이터 보여주기"}},"next":null},"pageContext":{"locale":"ko","isDefaultLang":true,"slug":"/pnpm으로-dockerfile에서-multi-stage-빌드하기","titleByLang":{"ko":"pnpm으로-dockerfile에서-multi-stage-빌드하기","en":"multi-stage-build-in-dockerfile-using-pnpm"},"dateFormat":"YYYY년 MM월 DD일","id":"af72a085-a5b0-5c13-9dd0-016f5c136636","previousPostId":"cf40a602-52f0-55d8-af2c-568c93521138","nextPostId":null}},"staticQueryHashes":[],"slicesMap":{}}