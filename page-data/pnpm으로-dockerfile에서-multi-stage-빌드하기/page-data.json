{"componentChunkName":"component---src-templates-blog-post-js","path":"/pnpm으로-dockerfile에서-multi-stage-빌드하기/","result":{"data":{"site":{"siteMetadata":{"title":"Seunghyun's Blog"}},"markdownRemark":{"id":"447d0f67-6a6a-5703-8010-35d6ab451d2b","excerpt":"프로젝트를 시작할 때 평소와 같이 패키지 매니저로 npm을 선택했습니다. 그런데 pnpm이 어떨지 궁금하여 pnpm으로 바꾸고 이 프로젝트에 적용해보았습니다 - pnpm은 npm…","html":"<p>프로젝트를 시작할 때 평소와 같이 패키지 매니저로 <strong>npm</strong>을 선택했습니다. 그런데 <strong>pnpm</strong>이 어떨지 궁금하여 <strong>pnpm</strong>으로 바꾸고 이 프로젝트에 적용해보았습니다 - <em>pnpm은 npm과 다르기 때문에 빌드 체계에 문제를 야기할 수 있습니다. 프로덕션 단계에서 변경을 원할 때는 반드시 적절한 테스트를 거쳐야 할 것입니다.</em></p>\n<p><strong>npm</strong>으로 작성되었던 <strong>Docker</strong> 스크립트를 바꿔야 했습니다. 적용한 Dockerfile에 대해 설명해보려고 합니다.</p>\n<blockquote>\n<p>이전 글을 읽지 않고 이 글을 읽으신 분들은 <a href=\"https://github.com/shkim04/find-your-wc\">여기</a>에서 백엔드의 전체 코드를 확인하실 수 있습니다.</p>\n</blockquote>\n<h2>Development 단계</h2>\n<p><span\n      class=\"gatsby-resp-image-wrapper\"\n      style=\"position: relative; display: block; margin-left: auto; margin-right: auto; max-width: 630px; \"\n    >\n      <a\n    class=\"gatsby-resp-image-link\"\n    href=\"/static/0c03facdffeb46f04279d9e0979fae24/fe8a7/development-stage.png\"\n    style=\"display: block\"\n    target=\"_blank\"\n    rel=\"noopener\"\n  >\n    <span\n    class=\"gatsby-resp-image-background-image\"\n    style=\"padding-bottom: 35.44303797468354%; position: relative; bottom: 0; left: 0; background-image: url('data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABQAAAAHCAYAAAAIy204AAAACXBIWXMAABYlAAAWJQFJUiTwAAAA00lEQVR42p2PW27DMAwEdZCYejimREWyJDsp0iRF73+qLawa/UqBph+DJYjFgFTn9o58u6NcHyjXD5RSsV4q1mVGCYwWPWoMKD39T7ZtJ75ThZEkYOQAFXODl4yQF7CcYIhgaYAlgrMGztqnjE922liomRM8CzhmhFThjhPseOxsBSL9O3pnn7XWUIEFIRfEsvSTJ0ngmMCS4DbpXvwrKssMKStO7dxFbpwwHA4gGqA1vS5s6YL57bFzR719Ygqxv/GqrAuFI3zMMMZ+Y13nP7JN+AVjKMZ+E8oVmgAAAABJRU5ErkJggg=='); background-size: cover; display: block;\"\n  ></span>\n  <img\n        class=\"gatsby-resp-image-image\"\n        alt=\"development-stage\"\n        title=\"\"\n        src=\"/static/0c03facdffeb46f04279d9e0979fae24/f058b/development-stage.png\"\n        srcset=\"/static/0c03facdffeb46f04279d9e0979fae24/c26ae/development-stage.png 158w,\n/static/0c03facdffeb46f04279d9e0979fae24/6bdcf/development-stage.png 315w,\n/static/0c03facdffeb46f04279d9e0979fae24/f058b/development-stage.png 630w,\n/static/0c03facdffeb46f04279d9e0979fae24/40601/development-stage.png 945w,\n/static/0c03facdffeb46f04279d9e0979fae24/fe8a7/development-stage.png 1223w\"\n        sizes=\"(max-width: 630px) 100vw, 630px\"\n        style=\"width:100%;height:100%;margin:0;vertical-align:middle;position:absolute;top:0;left:0;\"\n        loading=\"lazy\"\n        decoding=\"async\"\n      />\n  </a>\n    </span></p>\n<p><code class=\"language-text\">RUN curl -f https://get.pnpm.io/v6.16.js | node - add --global pnpm</code>을 입력하여 <code class=\"language-text\">pnpm</code>를 설치합니다.</p>\n<p>패키지를 가져올 때 <strong>install</strong> 대신에 <strong>fetch</strong>이 사용되는 것을 볼 수 있고 이 명령어는 오직 <code class=\"language-text\">pnpm-lock.yaml</code>만 필요합니다 - <em><code class=\"language-text\">pnpm fetch</code>이 <code class=\"language-text\">npm</code>을 사용하여 스크립트를 작성할 떄 <code class=\"language-text\">npm ci</code>와 동일한 역할을 한다고 판단됩니다.</em></p>\n<p><strong>pnpm</strong> 공식 문서에 따르면 <code class=\"language-text\">pnpm fetch</code>와 <code class=\"language-text\">pnpm install --offline</code>를 사용하면 많은 시간을 아낄 수 있다고 나옵니다.</p>\n<p>마지막으로 어플리케이션에서 <strong>Prisma</strong>를 사용하기 때문에 prisma 클라이언트를 생성하기 위해 <code class=\"language-text\">RUN pnpm exec prisma generate</code>를 추가해야 합니다.</p>\n<h2>Build 단계</h2>\n<p><span\n      class=\"gatsby-resp-image-wrapper\"\n      style=\"position: relative; display: block; margin-left: auto; margin-right: auto; max-width: 630px; \"\n    >\n      <a\n    class=\"gatsby-resp-image-link\"\n    href=\"/static/78f279d415af6f7fd15acad423c019af/d9b5d/build-stage.png\"\n    style=\"display: block\"\n    target=\"_blank\"\n    rel=\"noopener\"\n  >\n    <span\n    class=\"gatsby-resp-image-background-image\"\n    style=\"padding-bottom: 40.50632911392405%; position: relative; bottom: 0; left: 0; background-image: url('data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABQAAAAICAYAAAD5nd/tAAAACXBIWXMAABYlAAAWJQFJUiTwAAABJElEQVR42pWPW26DMBBF2UcCZvBjbGMbCGlD0qSpVKn739GtMCRK2p/242hm7PGVT7EfjoinN6Tpgm56R0odYnAIrNGyRrIGkU2eo9VLXc/nPmMUPDOkYRRtGMA+waUdjA8gIWCIYGQDIyVYLZgHnuZ1RzUNRE0ogm5htIVkB+MCapL5QhChEgJlWS5stwvrvF37qqruCCFQjH6HsJ/w8vGF3fkT3eGC4XhFf7rCdyMUW3CbYEMHG3to10JbD5cGKGPvQTeKyBG+36OfLgjjIWvPi41UIKKFRoKkzLWmJkNSoSZ6CsuBXRiRXs/w/QjjY35UbjaoqllHQMw/uCk9cJ9/BlrTgkOXtdjHXJV1aJT+pfMXipZDDpmV6nrVy2r077A58BttGuRs3irnCQAAAABJRU5ErkJggg=='); background-size: cover; display: block;\"\n  ></span>\n  <img\n        class=\"gatsby-resp-image-image\"\n        alt=\"build-stage\"\n        title=\"\"\n        src=\"/static/78f279d415af6f7fd15acad423c019af/f058b/build-stage.png\"\n        srcset=\"/static/78f279d415af6f7fd15acad423c019af/c26ae/build-stage.png 158w,\n/static/78f279d415af6f7fd15acad423c019af/6bdcf/build-stage.png 315w,\n/static/78f279d415af6f7fd15acad423c019af/f058b/build-stage.png 630w,\n/static/78f279d415af6f7fd15acad423c019af/40601/build-stage.png 945w,\n/static/78f279d415af6f7fd15acad423c019af/d9b5d/build-stage.png 1224w\"\n        sizes=\"(max-width: 630px) 100vw, 630px\"\n        style=\"width:100%;height:100%;margin:0;vertical-align:middle;position:absolute;top:0;left:0;\"\n        loading=\"lazy\"\n        decoding=\"async\"\n      />\n  </a>\n    </span></p>\n<p>이제 development 단계에서 생성한 <code class=\"language-text\">node_modules</code> 폴더를 복사할 수 있습니다. 그리고 어플리케이션 구동할 떄 필요한 정보가 담긴 <strong>.env</strong> 파일도 복사했습니다.</p>\n<p>마지막으로 빌드를 마친 후 패키지를 설치할 때 <code class=\"language-text\">--prod</code> 플래그를 사용하면 배포에 필요한 패키지만 설치가 됩니다.</p>\n<h2>Production 단계</h2>\n<p><span\n      class=\"gatsby-resp-image-wrapper\"\n      style=\"position: relative; display: block; margin-left: auto; margin-right: auto; max-width: 630px; \"\n    >\n      <a\n    class=\"gatsby-resp-image-link\"\n    href=\"/static/e99298f940617a5de8bbdbee98688ec5/681f1/production-stage.png\"\n    style=\"display: block\"\n    target=\"_blank\"\n    rel=\"noopener\"\n  >\n    <span\n    class=\"gatsby-resp-image-background-image\"\n    style=\"padding-bottom: 20.88607594936709%; position: relative; bottom: 0; left: 0; background-image: url('data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABQAAAAECAYAAACOXx+WAAAACXBIWXMAABYlAAAWJQFJUiTwAAAAzklEQVR42j2Q4W6EIBCEfY6KKByCKCDqnXq9tu//Vl8jufbHZGaTzWS/rcbeY2PAhJHejdgxYI3j5izKW5TrkUIgG0EjakT9UfySbBpaKYsXSUmV/UxvPfHxSdpfhPuTMd9xYSbvL+I1Lw+mdS87+flDOr6Yz2/8vJYDpu0gbGfJ1eIz1g6EdSfdj+JjWnFTJG1HKR9iZkhLyXE78XF5l020XYfSBqVvdEpTTdbjTEfoNUa1TEYRrMYbTa/+0C5cQVPXRdcL/pFbWVDbt34BFIl0vOYJQjkAAAAASUVORK5CYII='); background-size: cover; display: block;\"\n  ></span>\n  <img\n        class=\"gatsby-resp-image-image\"\n        alt=\"production-stage\"\n        title=\"\"\n        src=\"/static/e99298f940617a5de8bbdbee98688ec5/f058b/production-stage.png\"\n        srcset=\"/static/e99298f940617a5de8bbdbee98688ec5/c26ae/production-stage.png 158w,\n/static/e99298f940617a5de8bbdbee98688ec5/6bdcf/production-stage.png 315w,\n/static/e99298f940617a5de8bbdbee98688ec5/f058b/production-stage.png 630w,\n/static/e99298f940617a5de8bbdbee98688ec5/681f1/production-stage.png 899w\"\n        sizes=\"(max-width: 630px) 100vw, 630px\"\n        style=\"width:100%;height:100%;margin:0;vertical-align:middle;position:absolute;top:0;left:0;\"\n        loading=\"lazy\"\n        decoding=\"async\"\n      />\n  </a>\n    </span></p>\n<p>production 단계에서는 간단하게 build 단계에서 생성한 <code class=\"language-text\">node_modules</code>과 <code class=\"language-text\">dist</code> 폴더를 복사합니다.</p>\n<p>이미지를 생성하기 위해 명령어 <code class=\"language-text\">docker build -t [image-name-you-want-give] -f Dockerfile .</code>를 입력하게 되면 해당 이미지가 생성이 될 것이고 빠르고 저용량으로 만들어지는 것을 확인할 수 있습니다 - <em>multi-stage 빌드를 적용하지 않고 이미지를 생성해보면 알 수 있습니다.</em></p>\n<p><em><strong>읽어 주셔서 감사합니다. To be continued!</strong></em></p>\n<h3>참조</h3>\n<ul>\n<li><a href=\"https://pnpm.io/cli/fetch\">https://pnpm.io/cli/fetch</a></li>\n</ul>","frontmatter":{"title":"#15 pnpm으로 Dockefile에서 multi-stage 빌드하기","date":"2023년 11월 03일","description":"","tag":["Project"]},"fields":{"locale":"ko"}},"previous":{"fields":{"slug":"/nextjs-어플리케이션에-집계-데이터-보여주기"},"frontmatter":{"title":"#14 Nestjs 어플리케이션에 집계 데이터 보여주기"}},"next":{"fields":{"slug":"/docker-compose로-postgresql과-redis-어플리케이션에-연결하기"},"frontmatter":{"title":"#16 docker-compose로 PostgresQL과 redis 어플리케이션에 연결하기"}}},"pageContext":{"locale":"ko","isDefaultLang":true,"slug":"/pnpm으로-dockerfile에서-multi-stage-빌드하기","titleByLang":{"ko":"pnpm으로-dockerfile에서-multi-stage-빌드하기","en":"multi-stage-build-in-dockerfile-using-pnpm"},"dateFormat":"YYYY년 MM월 DD일","id":"447d0f67-6a6a-5703-8010-35d6ab451d2b","previousPostId":"71783b5f-36f1-55ff-9914-8cae61903a9c","nextPostId":"fb2ea90f-4135-5232-a307-88f61c044d02"}},"staticQueryHashes":[],"slicesMap":{}}