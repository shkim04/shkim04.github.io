{"componentChunkName":"component---src-templates-blog-post-js","path":"/pnpm으로-dockerfile에서-multi-stage-빌드하기/","result":{"data":{"site":{"siteMetadata":{"title":"Seunghyun's Blog"}},"markdownRemark":{"id":"af72a085-a5b0-5c13-9dd0-016f5c136636","excerpt":"프로젝트를 시작할 때 평소와 같이 패키지 매니저로 npm을 선택했습니다. 그런데 pnpm이 어떨지 궁금하여 pnpm으로 바꾸고 이 프로젝트에 적용해보았습니다 - 이 주제에 관해서는 더 알아봐야 겠지만 어플리케이션에 잠재적인 위험을 야기할 수 있다고 생각합니다. npm…","html":"<p>프로젝트를 시작할 때 평소와 같이 패키지 매니저로 <strong>npm</strong>을 선택했습니다. 그런데 <strong>pnpm</strong>이 어떨지 궁금하여 <strong>pnpm</strong>으로 바꾸고 이 프로젝트에 적용해보았습니다 - <em>이 주제에 관해서는 더 알아봐야 겠지만 어플리케이션에 잠재적인 위험을 야기할 수 있다고 생각합니다.</em></p>\n<p><strong>npm</strong>으로 작성되었던 <strong>Docker</strong> 스크립트를 바꿔야 했습니다. 적용한 Dockerfile에 대해 설명해보려고 합니다.</p>\n<blockquote>\n<p>이전 글을 읽지 않고 이 글을 읽으신 분들은 <a href=\"https://github.com/shkim04/find-your-wc\">여기</a>에서 백엔드의 전체 코드를 확인하실 수 있습니다.</p>\n</blockquote>\n<h2>Development 단계</h2>\n<p><span\n      class=\"gatsby-resp-image-wrapper\"\n      style=\"position: relative; display: block; margin-left: auto; margin-right: auto; max-width: 630px; \"\n    >\n      <a\n    class=\"gatsby-resp-image-link\"\n    href=\"/static/0c03facdffeb46f04279d9e0979fae24/fe8a7/development-stage.png\"\n    style=\"display: block\"\n    target=\"_blank\"\n    rel=\"noopener\"\n  >\n    <span\n    class=\"gatsby-resp-image-background-image\"\n    style=\"padding-bottom: 35.44303797468354%; position: relative; bottom: 0; left: 0; background-image: url('data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABQAAAAHCAYAAAAIy204AAAACXBIWXMAABYlAAAWJQFJUiTwAAAA3ElEQVR42p2PW07DMBBFsw+wHTvxM3GckLb0Kfa/qoNiQALUD8rH0Z25Gh1pmt1yIp8vlOOVcrxRysy6n1nXiRIdS/IsQ2BO/ge1i54Sfc0xBjoXaFJe8DET8oKNA0oKtBBoKTG6xWh9l+5Op1pNM9kRbyM2ZcI4Y/oe3X2wHUgpkVJ9y6/5164USima4CI+z6Sy0ruASyMuDrg4Yjbp5+FfaXKcqmxYdlVmeot4fkIIgVLyceHLuGc63Jher0yHC/P5DRtTfeVRWRUmN+CHTKtbWq1ptan8R7YJ3wFh2caA/smLygAAAABJRU5ErkJggg=='); background-size: cover; display: block;\"\n  ></span>\n  <img\n        class=\"gatsby-resp-image-image\"\n        alt=\"development-stage\"\n        title=\"\"\n        src=\"/static/0c03facdffeb46f04279d9e0979fae24/f058b/development-stage.png\"\n        srcset=\"/static/0c03facdffeb46f04279d9e0979fae24/c26ae/development-stage.png 158w,\n/static/0c03facdffeb46f04279d9e0979fae24/6bdcf/development-stage.png 315w,\n/static/0c03facdffeb46f04279d9e0979fae24/f058b/development-stage.png 630w,\n/static/0c03facdffeb46f04279d9e0979fae24/40601/development-stage.png 945w,\n/static/0c03facdffeb46f04279d9e0979fae24/fe8a7/development-stage.png 1223w\"\n        sizes=\"(max-width: 630px) 100vw, 630px\"\n        style=\"width:100%;height:100%;margin:0;vertical-align:middle;position:absolute;top:0;left:0;\"\n        loading=\"lazy\"\n        decoding=\"async\"\n      />\n  </a>\n    </span></p>\n<p><code class=\"language-text\">RUN curl -f https://get.pnpm.io/v6.16.js | node - add --global pnpm</code>을 입력하여 <code class=\"language-text\">pnpm</code>를 설치합니다.</p>\n<p>패키지를 가져올 때 <strong>install</strong> 대신에 <strong>fetch</strong>이 사용되는 것을 볼 수 있고 이 명령어는 오직 <code class=\"language-text\">pnpm-lock.yaml</code>만 필요합니다 - <em><code class=\"language-text\">pnpm fetch</code>이 <code class=\"language-text\">npm</code>을 사용하여 스크립트를 작성할 떄 <code class=\"language-text\">npm ci</code>와 동일한 역할을 한다고 판단됩니다.</em></p>\n<p><strong>pnpm</strong> 공식 문서에 따르면 <code class=\"language-text\">pnpm fetch</code>와 <code class=\"language-text\">pnpm install --offline</code>를 사용하면 많은 시간을 아낄 수 있다고 나옵니다.</p>\n<p>마지막으로 어플리케이션에서 <strong>Prisma</strong>를 사용하기 때문에 prisma 클라이언트를 생성하기 위해 <code class=\"language-text\">RUN pnpm exec prisma generate</code>를 추가해야 합니다.</p>\n<h2>Build 단계</h2>\n<p><span\n      class=\"gatsby-resp-image-wrapper\"\n      style=\"position: relative; display: block; margin-left: auto; margin-right: auto; max-width: 630px; \"\n    >\n      <a\n    class=\"gatsby-resp-image-link\"\n    href=\"/static/78f279d415af6f7fd15acad423c019af/d9b5d/build-stage.png\"\n    style=\"display: block\"\n    target=\"_blank\"\n    rel=\"noopener\"\n  >\n    <span\n    class=\"gatsby-resp-image-background-image\"\n    style=\"padding-bottom: 40.50632911392405%; position: relative; bottom: 0; left: 0; background-image: url('data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABQAAAAICAYAAAD5nd/tAAAACXBIWXMAABYlAAAWJQFJUiTwAAABG0lEQVR42pWP7U6EMBBFeQ+hZWhpS7cfsGyURdFN/OH7P9E1DKy6GhP9cdI7TXsnpzgNZ6T5EWlakKdnpJwRY4dgWyY5g7jn6D7P9f76JhgNby2UsSh8GOB8QpeOMD6AagnTEIxWMErB6lvML7NWDeqaUITWw7QOynYwXUBNDWRNkESohERZVqiqCmVZMmu+zpyFYIQQkFKgGP0R4XTG/eUNx+UVeVowzC8Y5gt8HqFtB3tIcDHDxZ6Xts6zkTZuL5IfFNFG+P6EfloQxom1tXVolAYRbTQKpDZWgxVSGjXRTRkX5jgiPTxxqfGRP1XlHW/m7Ttf8838vdCZA2zIGz6ynnYejW5/6PyF4mADXEistSqw2p7/W7YWvgOXwuSLR1uIJwAAAABJRU5ErkJggg=='); background-size: cover; display: block;\"\n  ></span>\n  <img\n        class=\"gatsby-resp-image-image\"\n        alt=\"build-stage\"\n        title=\"\"\n        src=\"/static/78f279d415af6f7fd15acad423c019af/f058b/build-stage.png\"\n        srcset=\"/static/78f279d415af6f7fd15acad423c019af/c26ae/build-stage.png 158w,\n/static/78f279d415af6f7fd15acad423c019af/6bdcf/build-stage.png 315w,\n/static/78f279d415af6f7fd15acad423c019af/f058b/build-stage.png 630w,\n/static/78f279d415af6f7fd15acad423c019af/40601/build-stage.png 945w,\n/static/78f279d415af6f7fd15acad423c019af/d9b5d/build-stage.png 1224w\"\n        sizes=\"(max-width: 630px) 100vw, 630px\"\n        style=\"width:100%;height:100%;margin:0;vertical-align:middle;position:absolute;top:0;left:0;\"\n        loading=\"lazy\"\n        decoding=\"async\"\n      />\n  </a>\n    </span></p>\n<p>이제 development 단계에서 생성한 <code class=\"language-text\">node_modules</code> 폴더를 복사할 수 있습니다. 그리고 어플리케이션 구동할 떄 필요한 정보가 담긴 <strong>.env</strong> 파일도 복사했습니다.</p>\n<p>마지막으로 빌드를 마친 후 패키지를 설치할 때 <code class=\"language-text\">--prod</code> 플래그를 사용하면 배포에 필요한 패키지만 설치가 됩니다.</p>\n<h2>Production 단계</h2>\n<p><span\n      class=\"gatsby-resp-image-wrapper\"\n      style=\"position: relative; display: block; margin-left: auto; margin-right: auto; max-width: 630px; \"\n    >\n      <a\n    class=\"gatsby-resp-image-link\"\n    href=\"/static/e99298f940617a5de8bbdbee98688ec5/681f1/production-stage.png\"\n    style=\"display: block\"\n    target=\"_blank\"\n    rel=\"noopener\"\n  >\n    <span\n    class=\"gatsby-resp-image-background-image\"\n    style=\"padding-bottom: 20.88607594936709%; position: relative; bottom: 0; left: 0; background-image: url('data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABQAAAAECAYAAACOXx+WAAAACXBIWXMAABYlAAAWJQFJUiTwAAAAyklEQVR42j2PW3KDMBAEuYdAQqCHJSSQwQabpHz/W3XKcpKPqen52K3qJpqAywmTItYHbEy40TF4Rx8c2ltk29LVCFohaNtPZNehpER2bWUpJU0JC9YF8n6yHCfp9iRe7/i0UPYv8u+e1p18PynPF/PxzfJ4EZYVFxPTdpC2R+WmhIJzF9K6M9+O2nFe8VNm3g5iueFz4ZKvld+Hb/48m+j7Hj0a9DjS64FmcgFvepIdMFoxGV052AGrRdWsSn/aQvxzVVaqatdWih8LhHS+oidIvQAAAABJRU5ErkJggg=='); background-size: cover; display: block;\"\n  ></span>\n  <img\n        class=\"gatsby-resp-image-image\"\n        alt=\"production-stage\"\n        title=\"\"\n        src=\"/static/e99298f940617a5de8bbdbee98688ec5/f058b/production-stage.png\"\n        srcset=\"/static/e99298f940617a5de8bbdbee98688ec5/c26ae/production-stage.png 158w,\n/static/e99298f940617a5de8bbdbee98688ec5/6bdcf/production-stage.png 315w,\n/static/e99298f940617a5de8bbdbee98688ec5/f058b/production-stage.png 630w,\n/static/e99298f940617a5de8bbdbee98688ec5/681f1/production-stage.png 899w\"\n        sizes=\"(max-width: 630px) 100vw, 630px\"\n        style=\"width:100%;height:100%;margin:0;vertical-align:middle;position:absolute;top:0;left:0;\"\n        loading=\"lazy\"\n        decoding=\"async\"\n      />\n  </a>\n    </span></p>\n<p>production 단계에서는 간단하게 build 단계에서 생성한 <code class=\"language-text\">node_modules</code>과 <code class=\"language-text\">dist</code> 폴더를 복사합니다.</p>\n<p>이미지를 생성하기 위해 명령어 <code class=\"language-text\">docker build -t [image-name-you-want-give] -f Dockerfile .</code>를 입력하게 되면 해당 이미지가 생성이 될 것이고 빠르고 저용량으로 만들어지는 것을 확인할 수 있습니다 - <em>multi-stage 빌드를 적용하지 않고 이미지를 생성해보면 알 수 있습니다.</em></p>\n<p><em><strong>읽어 주셔서 감사합니다. To be continued!</strong></em></p>\n<h3>참조</h3>\n<ul>\n<li><a href=\"https://pnpm.io/cli/fetch\">https://pnpm.io/cli/fetch</a></li>\n</ul>","frontmatter":{"title":"#15 pnpm으로 Dockefile에서 multi-stage 빌드하기","date":"2023년 11월 03일","description":"","tag":["Project"]},"fields":{"locale":"ko"}},"previous":{"fields":{"slug":"/nextjs-어플리케이션에-집계-데이터-보여주기"},"frontmatter":{"title":"#14 Nestjs 어플리케이션에 집계 데이터 보여주기"}},"next":{"fields":{"slug":"/docker-compose로-postgresql과-redis-어플리케이션에-연결하기"},"frontmatter":{"title":"#16 docker-compose로 PostgresQL과 redis 어플리케이션에 연결하기"}}},"pageContext":{"locale":"ko","isDefaultLang":true,"slug":"/pnpm으로-dockerfile에서-multi-stage-빌드하기","titleByLang":{"ko":"pnpm으로-dockerfile에서-multi-stage-빌드하기","en":"multi-stage-build-in-dockerfile-using-pnpm"},"dateFormat":"YYYY년 MM월 DD일","id":"af72a085-a5b0-5c13-9dd0-016f5c136636","previousPostId":"cf40a602-52f0-55d8-af2c-568c93521138","nextPostId":"8794490e-5781-5d47-935a-f3778b6b5d9a"}},"staticQueryHashes":[],"slicesMap":{}}