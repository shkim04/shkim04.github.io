{"componentChunkName":"component---src-templates-blog-post-js","path":"/crontab-실무-적용-예시/","result":{"data":{"site":{"siteMetadata":{"title":"Seunghyun's Blog"}},"markdownRemark":{"id":"cee13101-6d2a-54c3-b4b1-0056a0e0d145","excerpt":"소프트웨어 환경을 설정하고 관리하는 리눅스 사용자는 을 통해 스케줄 작업을 합니다. 반복적인 작업에 큰 도움이 됩니다. 필자가 개발하고 관리하는 어플리케이션 서버들 중 VM에 실행되고 한 포트에 2…","html":"<p><span\n      class=\"gatsby-resp-image-wrapper\"\n      style=\"position: relative; display: block; margin-left: auto; margin-right: auto; max-width: 630px; \"\n    >\n      <a\n    class=\"gatsby-resp-image-link\"\n    href=\"/static/7d7247e597f450c75a85c382daee063e/d4c13/crontab-edit.png\"\n    style=\"display: block\"\n    target=\"_blank\"\n    rel=\"noopener\"\n  >\n    <span\n    class=\"gatsby-resp-image-background-image\"\n    style=\"padding-bottom: 54.43037974683544%; position: relative; bottom: 0; left: 0; background-image: url('data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABQAAAALCAYAAAB/Ca1DAAAACXBIWXMAAAsTAAALEwEAmpwYAAABlklEQVR42n1R207CQBBdfPASRGiR0lLw1nYvWFDAP1ISE/XBKKKgId71q4+ZWSkq6sPJmcnsnDkzK8anY4yPh7g7GeHhfIK34TNehs94vXrC6/DJ8hSDR7wPHnF/doubo0uM+pe4PrzAqD/gfHIygvBWtuEvhIyq8OGJAN5CCC9Xs6A8F1gWAXzhoiYchKI8h5pwIdTGAdRGD6rRhWr0oOtd6LDDTDUd7MFU2zBeC8a3nBYSpPkIaT6eg0i8FpJKimR9lyFdA1luIik3EVdbkI6GLGnLjoZe3oZZ3GTmeGkLhvgTIqp3ENf2Eftty8GejattFozqXURhh0F1GkQDpmKZcCYYdpBUdrmZnRI865jEya1aTaAKCdRqDFlUHJvFrZnDLy4FNznGruqabPVMuEJ5E6qo2B3DS1n8V4ckaB22v7lj0HokQLd1TDaIV85Hvwvy45Kac8Zuy9YZiamizAR4xT8+RlAj34gaSxpqTTL4DPSzbpMH0u0o5lrJDtErO7MhmSAduSjtDSlek+yMHk8d/Iefgh+tiD2HVnYZeAAAAABJRU5ErkJggg=='); background-size: cover; display: block;\"\n  ></span>\n  <img\n        class=\"gatsby-resp-image-image\"\n        alt=\"crontab-edit\"\n        title=\"\"\n        src=\"/static/7d7247e597f450c75a85c382daee063e/f058b/crontab-edit.png\"\n        srcset=\"/static/7d7247e597f450c75a85c382daee063e/c26ae/crontab-edit.png 158w,\n/static/7d7247e597f450c75a85c382daee063e/6bdcf/crontab-edit.png 315w,\n/static/7d7247e597f450c75a85c382daee063e/f058b/crontab-edit.png 630w,\n/static/7d7247e597f450c75a85c382daee063e/d4c13/crontab-edit.png 825w\"\n        sizes=\"(max-width: 630px) 100vw, 630px\"\n        style=\"width:100%;height:100%;margin:0;vertical-align:middle;position:absolute;top:0;left:0;\"\n        loading=\"lazy\"\n        decoding=\"async\"\n      />\n  </a>\n    </span></p>\n<p>소프트웨어 환경을 설정하고 관리하는 리눅스 사용자는 <code class=\"language-text\">cron</code>을 통해 스케줄 작업을 합니다. 반복적인 작업에 큰 도움이 됩니다.</p>\n<p>필자가 개발하고 관리하는 어플리케이션 서버들 중 VM에 실행되고 한 포트에 24시간 열려 있어야 하는 서버가 있다. 그런데 이 서버가 가끔 종료가 되곤 했는데 <code class=\"language-text\">cron</code> 덕분에 꺼질 때마다 직접 다시 실행시킬 필요가 없었다. 구체적으로 어떤 상황이었고 <code class=\"language-text\">cron</code>을 어떻게 해결했는지 공유한다.</p>\n<h2>필수</h2>\n<ul>\n<li>Linux 환경 — <em>필자는 Ubuntu를 사용한다</em></li>\n<li>Linux에 관한 약간의 배경지식 — <em>간단한 명령어 등</em></li>\n<li>bash 스크립트에 관한 약간의 배경지식</li>\n</ul>\n<h2>실제 적용 사례</h2>\n<p>필자는 회사 앱 서비스를 위해 필요한 데이터를 수집하고 가공하는 과정을 자동화시키는 어플리케이션 서버를 개발하고 관리한다.</p>\n<p>이 작업을 위해 회사는 웹사이트를 크롤링하는 소프트웨어 상품을 매일 사용하고 있다. 크롤링 작업량이 많고 빡빡한 이유인지 작업 요청을 처리하는 중에 자주 꺼지기도 한다. 그 결과, 앱에서 충분한 데이터를 보여주지 못한 경우가 있다. 문제 해결을 위해 <em><strong>sikulix</strong></em> 라는 어플리케이션을 적용했는데 그래픽 이미지를 감지하고 감지한 이미지를 활용하도록 돕는 역할을 제공한다. 간단히 말하면 크롤링 소프트웨어가 꺼질 때마다 다시 켤 수 있게 사용하는 것이다.</p>\n<p>sikulix 서버를 실행시킨 후 처음 몇 일은 기대한 대로 잘 동작했다. 크롤링 소프트웨어가 꺼지는 것을 감지하고 자동으로 열어주는 역할을 제대로 한 것이다.</p>\n<p>하지만 sikulix 서버 자체가 어떠한 이유로 자주 꺼지게 되면서 무용지물이 되었고 이 sikulix 서버가 꺼질 때 다시 자동으로 시작할 수 있는 방법을 찾아야 했다.</p>\n<p><em><strong>이 즈음 되서 약간 약이 올랐다.</strong></em></p>\n<p>다행히도 <code class=\"language-text\">cron</code>과 shell 스크립트로 문제를 해결했다. 이에 대해 이야기를 해보겠다.</p>\n<h2>간단한 예</h2>\n<ol>\n<li><code class=\"language-text\">*/1 * * * * echo \"Hello, World\"</code></li>\n<li><code class=\"language-text\">50 1,2 * * * cd /home/cron_logs &amp; touch cron-`date +\\%F`.log</code></li>\n<li><code class=\"language-text\">0 0 1* * find /home/cron_logs -name \"*.log\" -type f -mtime +30 -delete</code></li>\n</ol>\n<p>먼저 cron에 대한 기본을 알고 넘어가자. 위 코드는 <code class=\"language-text\">cron</code>으로 실행하는 스케줄이 된 작업들이다. 명령어는 2개 부분으로 나뉘는데 하나는 시간이고 나머지는 설정한 시간에 동작할 명령어다.</p>\n<p>순서대로 어떤 작업인지 설명한다:</p>\n<ol>\n<li><em><strong>\"Hello, World\"</strong></em> 가 매 1분마다 로그에 출력된다</li>\n<li>cron_[<em>명령어가 실행된 시점</em>].log이라는 파일이 홈 경로에 있는 <strong>cron_logs</strong> 폴더 하위에 매일 오전 1:50과 2:50에 생성된다.</li>\n<li><strong>cron_logs</strong> 폴더 하위에 있고 파일 이름에 log가 있는 파일들 중 30일 이전에 생성된 파일은 매월 첫날 자정에 삭제된다</li>\n</ol>\n<h2>솔루션</h2>\n<p>문제 해결을 위한 접근 방식은 다음과 같았다. <em><strong>sikulix</strong></em> 서버가 작업을 하기 몇 분 전에 동작을 하고 있는지 확인하는 것이고 동작하지 않을 경우 재시작시키는 것이다.\r\n다음과 같은 순서로 이 시나리오를 구현했다:</p>\n<ol>\n<li>터미널을 열어 cron 에디터를 연다.</li>\n</ol>\n<div class=\"gatsby-highlight\" data-language=\"bash\"><pre class=\"language-bash\"><code class=\"language-bash\"><span class=\"token function\">crontab</span> <span class=\"token parameter variable\">-e</span>\r\n// edit <span class=\"token function\">cron</span> <span class=\"token function\">jobs</span></code></pre></div>\n<ol start=\"2\">\n<li>아래 코드를 에디터에 입력한다.</li>\n</ol>\n<div class=\"gatsby-highlight\" data-language=\"bash\"><pre class=\"language-bash\"><code class=\"language-bash\"><span class=\"token number\">50</span> <span class=\"token number\">2,5</span>,20,23 * * * /home/sikulix/handle_sikulix.sh <span class=\"token operator\">>></span> ~/cron_logs/cron-<span class=\"token variable\"><span class=\"token variable\">`</span><span class=\"token function\">date</span> +<span class=\"token punctuation\">\\</span>%F<span class=\"token variable\">`</span></span>.log <span class=\"token operator\"><span class=\"token file-descriptor important\">2</span>></span><span class=\"token file-descriptor important\">&amp;1</span></code></pre></div>\n<blockquote>\n<p>실행시킬 shell 스크립트의 절대경로를 입력했다는 것에 주목하자. Cron은 파일 이름만 덩그러니 적어주면 그 파일이 어디 있는지 알지 못한다.</p>\n</blockquote>\n<p>ctrl+x를 눌러 완료한다.</p>\n<ol start=\"3\">\n<li>cron을 재시작한다</li>\n</ol>\n<div class=\"gatsby-highlight\" data-language=\"bash\"><pre class=\"language-bash\"><code class=\"language-bash\"><span class=\"token function\">sudo</span> systemcrl restart <span class=\"token function\">cron</span></code></pre></div>\n<p>cron job이 적용이 되려면 <code class=\"language-text\">cron</code>을 재시작해야 한다.</p>\n<ol start=\"4\">\n<li>handle_sikulix.sh 생성</li>\n</ol>\n<div class=\"gatsby-highlight\" data-language=\"bash\"><pre class=\"language-bash\"><code class=\"language-bash\"><span class=\"token shebang important\">#!/bin/bash</span>\r\n\r\n<span class=\"token assign-left variable\">isRun</span><span class=\"token operator\">=</span><span class=\"token string\">\"YES\"</span>\r\n<span class=\"token variable\"><span class=\"token variable\">$(</span><span class=\"token function\">sudo</span> <span class=\"token function\">netstat</span> <span class=\"token parameter variable\">-tulpn</span> <span class=\"token operator\">|</span> <span class=\"token function\">grep</span> :<span class=\"token punctuation\">[</span>SIKULIX SERVER PORT<span class=\"token punctuation\">]</span> <span class=\"token operator\">></span> /dev/null<span class=\"token variable\">)</span></span> <span class=\"token operator\">||</span> <span class=\"token assign-left variable\">isRun</span><span class=\"token operator\">=</span><span class=\"token string\">\"\"</span>\r\n\r\n<span class=\"token keyword\">if</span> <span class=\"token punctuation\">[</span> <span class=\"token string\">\"<span class=\"token variable\">$isRun</span>\"</span> <span class=\"token operator\">=</span> <span class=\"token string\">\"YES\"</span> <span class=\"token punctuation\">]</span><span class=\"token punctuation\">;</span> <span class=\"token keyword\">then</span>\r\n    <span class=\"token builtin class-name\">echo</span> <span class=\"token string\">\"Autorun server is running\"</span>\r\n<span class=\"token keyword\">else</span>\r\n    <span class=\"token builtin class-name\">export</span> <span class=\"token assign-left variable\"><span class=\"token environment constant\">DISPLAY</span></span><span class=\"token operator\">=</span>:10.0\r\n    <span class=\"token builtin class-name\">cd</span> /home/sikulix\r\n    ./start_server.sh<span class=\"token punctuation\">;</span><span class=\"token function\">bash</span>\r\n<span class=\"token keyword\">fi</span></code></pre></div>\n<p>이 shell 스크립트의 역할은 sikulix 서버가 실행되는 포트가 사용되고 있는지 여부를 확인한다.</p>\n<p>사용되고 있다면 <strong>cron_logs</strong> 폴더 하위에 있는 한 로그 파일에 <em>\"<strong>Autorun server is running</strong>\"</em> 가 출력된다. 사용이 되고 있지 않다면 <em><strong>sikulix</strong></em> 디렉토리로 이동하여 sikulx 서버를 실행하는 스크립트인 <code class=\"language-text\">start_server.sh</code>을 실행한다.</p>\n<h2>결론</h2>\n<p><em><strong>Cron</strong></em> 은 이해하는데 크게 어려움은 없다. <code class=\"language-text\">cron</code>이가 가지고 있는 문법 혹은 명령어에 대한 규칙 등을 알맞게 적용하여 사용자의 목적에 맞게 스케줄 작업을 진행하면 된다고 생각한다.</p>\n<p><em><strong>읽어 주셔서 감사합니다. To be continued!</strong></em></p>\n<p><em>이 글은 <a href=\"https://medium.com/@shkim04/how-i-used-crontab-to-schedule-jobs-on-linux-for-my-work-1cb290847904\">Medium</a>에도 업로드 되었습니다.</em>\r\n<em>놀러 오세요!</em></p>","frontmatter":{"title":"Crontab 실무에 적용한 예","date":"2023년 02월 14일","description":"Cron은 리눅스에 내장된 스케줄링 시스템 도구입니다. 개인 경험을 통해 cron에 대한 간단하게 설명하는 내용을 담고 있습니다.","tag":["Linux"]},"fields":{"locale":"ko"}},"previous":{"fields":{"slug":"/nodejs-google-error-reporting-사용하기"},"frontmatter":{"title":"Node.js에서 Google Error Reporting 사용하기"}},"next":{"fields":{"slug":"/react-컴포넌트-밖-클릭-감지"},"frontmatter":{"title":"영역 밖에서 발생하는 클릭 감지하는 React 컴포넌트"}}},"pageContext":{"locale":"ko","isDefaultLang":true,"slug":"/crontab-실무-적용-예시","titleByLang":{"ko":"crontab-실무-적용-예시","en":"how-i-used-crontab-to-schedule-jobs-for-my-work"},"dateFormat":"YYYY년 MM월 DD일","id":"cee13101-6d2a-54c3-b4b1-0056a0e0d145","previousPostId":"e509466f-19b4-546a-809e-d8fc6ce8343f","nextPostId":"43cca934-4fb8-566f-93ee-0d5caebbe62f"}},"staticQueryHashes":[],"slicesMap":{}}